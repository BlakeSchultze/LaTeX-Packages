%*******************************************************************************************************************************%
%****************************************************** `pkgbase.sty' **********************************************************%
%*******************************************************************************************************************************%
% Establishes the most basic low-level character and control sequence definitions, those with broadest universal applicability.
% This includes:
%       (1) Defines packages required for (a) control sequence definitions in this package and (b) creation of additional package
% option commands provided by 'pkgopts.sty' and provides package loading commands used to iterately load the required packages in
% the list.
%       (1) Character definitions creating named aliases for the #s 0,1,2,...,8,16,255, improving readability
%       (2) Creation of control sequence shortcuts for temporarily changing and restoring character codes, funcioning as programming
% context environments like \makeatletter/\makeatother for (1) '|' such that |x| in math mode typesets bold 'x' and (2) '\\' changed
% to standard text character for printing control sequence name without escaping '\'.
%       (3) a set of control sequences providing a simplified usage and/or reduced character typing burden for frequently used
% commands and command sequences
%       (4) Numerous argument processing commands for controlled preexpansion of specified parameter #s and/or control sequence
% construction by name
%       (5) Creation, appending, and processing of lists of various types, particularly extensive for the parsing of comma/space
% separated and braced group values such that the corresponding values are stored and subsequently globally accessible through
% a sequence of control sequences with standardized naming scheme by type and sequential numbering
%       (6)
%
%
%
%
%-------------------------------------------------------------------------------------------------------------------------------%
%*******************************************************************************************************************************%
%********************************** Define provided package name and LaTeX/package dependencies ********************************%
%*******************************************************************************************************************************%
%-------------------------------------------------------------------------------------------------------------------------------%
\NeedsTeXFormat{LaTeX2e}[2005/12/01]
\ProvidesPackage{pkgbase}                       %
%\RequirePackage{trace}
%-------------------------------------------------------------------------------------------------------------------------------%
%*******************************************************************************************************************************%
%************************************* Package options and corresponding Boolean variables *************************************%
%*******************************************************************************************************************************%
%-------------------------------------------------------------------------------------------------------------------------------%
\DeclareOption*{\PackageWarning{pkgbase}{Unknown \CurrentOption}}
%-------------------------------------------------------------------------------------------------------------------------------%
%*******************************************************************************************************************************%
%************************************************ Processing of package options ************************************************%
%*******************************************************************************************************************************%
%-------------------------------------------------------------------------------------------------------------------------------%
\ProcessOptions\relax
%-------------------------------------------------------------------------------------------------------------------------------%
\makeatletter                                           % Change @ -> catcode'@=11 (letter) for use in macro names/definition
%-------------------------------------------------------------------------------------------------------------------------------%
%*******************************************************************************************************************************%
%*******************************************************************************************************************************%
%************************************************ Plain TeX macro definitions **************************************************%
%*******************************************************************************************************************************%
%*******************************************************************************************************************************%
%-------------------------------------------------------------------------------------------------------------------------------%
%------------------------------------------------ Register variable definitions ------------------------------------------------%
%-------------------------------------------------------------------------------------------------------------------------------%
%\def\newif#1{%
%  \ifdefined{#1}{}%
%  {\count@\escapechar \escapechar\m@ne
%    \let#1\iffalse
%    \@if#1\iftrue
%    \@if#1\iffalse
%  \escapechar\count@}}
\newcount\linecnt\linecnt=0
\newif\ifvalidated
        \validatedfalse
\newif\if@choicevals@validated
        \@choicevals@validatedfalse
\newif\if@rm@termfile@
        \@rm@termfile@true
\newread\@ifstream
\newwrite\@ofstream
%-------------------------------------------------------------------------------------------------------------------------------%
%---------------------------------------------- Base package constant definitions ----------------------------------------------%
%-------------------------------------------------------------------------------------------------------------------------------%
\def\PKGNAME{R2Labs}%
\def\PKGOPTS@PACKAGES{etoolbox,kvoptions,pgffor,ifplatform,catchfile}
%-------------------------------------------------------------------------------------------------------------------------------%
%~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~%
%~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ Plain TeX macro definitions ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~%
%~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~%
%-------------------------------------------------------------------------------------------------------------------------------%
%----------------------------------- Control sequence numbers and character code definitions -----------------------------------%
%-------------------------------------------------------------------------------------------------------------------------------%
\chardef\n@ne=0
\chardef\zer@=0
\chardef\@ne=1
\chardef\tw@=2
\chardef\thr@@=3
\chardef\f@ur=4
\chardef\e@ght=8
\chardef\sixt@@n=16
\chardef\@cclv=255
%\chardef\@mxxiv=1024                                                   % Too big; \chardef: 0-255
%-------------------------------------------------------------------------------------------------------------------------------%
\chardef\CHARZERO=0
\chardef\CHARONE=1
\chardef\CHARTWO=2
\chardef\CHARTHREE=3
\chardef\CHARFOUR=4
\chardef\CHAREIGHT=8
\chardef\CHARSIXTEEN=16
\chardef\CHARTWOFIFTYFIVE=255
%\chardef\TENTWENTYFOUR=1024                                            % Too big; \chardef: 0-255
%-------------------------------------------------------------------------------------------------------------------------------%
\def\mathon{\catcode`|=\active}
\def\mathoff{\catcode`|=12}
\def\escapeon{\catcode`\\=0}
\def\escapeoff{\catcode`\\=12}
%\def\escapeon{\catcode`\\=0\escapechar=`\\}
%\def\escapeoff{\catcode`\\=12\escapechar=`\&}
%-------------------------------------------------------------------------------------------------------------------------------%
%~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~%
%~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ Macro argument parsing/storage commands ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~%
%~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~%
%-------------------------------------------------------------------------------------------------------------------------------%
\global\let\xp\expandafter
\gdef\gxp{\xp\global\xp}
\gdef\twoxp{\xp\xp\xp}
\def\glet{\global\let}
\def\@nil{}
\def\@@empty{\@gobble\@@empty}
\def\@nilbrackets[#1]{}
\def\@identity#1{#1}
\def\fullyexpand#1{\romannumeral - `0#1}
\def\readahead#1#2{\afterassignment\@gobble\futurelet#1{#2}}
\long\def\gobblethree#1#2#3{}
\long\def\@gobblethree#1#2#3{}
\long\def\firstofone#1{#1}
\long\def\firstoftwo#1#2{#1}
\long\def\secondoftwo#1#2{#2}
\long\def\firstofthree#1#2#3{#1}
\long\def\secondofthree#1#2#3{#2}
\long\def\thirdofthree#1#2#3{#3}
\long\def\firsttwoofthree#1#2#3{#1#2}
\long\def\secondtwoofthree#1#2#3{#2#3}
%-------------------------------------------------------------------------------------------------------------------------------%
\def\@csname#1{\csname #1\endcsname}
\def\thecsname#1{\xp\secondoftwo\string#1}
\def\detok@csname#1{\xp\secondoftwo\detokenize{#1}}
%-------------------------------------------------------------------------------------------------------------------------------%
%~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~%
%~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ Macros for defining macros requiring expansion first ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~%
%~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~%
%-------------------------------------------------------------------------------------------------------------------------------%
\newcommand\csname@cmd[1]{\xp\xp\csname#1\endcsname}
\newcommand\csname@cmd@y[2]{\csname@cmd{#1}\csname#2\endcsname}
%\newcommand\csname@ny[2]{\xp#1\csname#2\endcsname}
%\newcommand\csgname@y[2]{\gxp#1\csname#2\endcsname}
%\newcommand\csname@ny[3]{\xp#1\xp#2\xp{\csname#3\endcsname}}
%
\newcommand\csname@ny[2]{\xp#1\csname#2\endcsname}
\newcommand\csname@nY[2]{\xp#1\xp{\csname#2\endcsname}}
\newcommand\csgname@ny[2]{\gxp#1\csname#2\endcsname}
\newcommand\csname@nnY[3]{\xp#1\xp#2\xp{\csname#3\endcsname}}
\newcommand\csname@nyN[3]{\xp#1\csname#2\endcsname{#3}}
%\newcommand\csname@nYY[3]{\xp\csname@ny\xp#1\xp{\csname#2\endcsname}{#3}}
\newcommand\csname@nYY[3]{\xp\xp\xp#1\xp\xp\xp{\xp\csname\xp#2\xp\endcsname\xp}\xp{\csname#3\endcsname}}
\newcommand\csname@nypN[4]{\xp#1\csname#2\endcsname#3{#4}}
\newcommand\csname@nYNN[4]{\xp#1\xp{\csname#2\endcsname}{#3}{#4}}
\newcommand\csname@nNYNN[5]{\xp#1\xp{\xp#2\xp}\xp{\csname#3\endcsname}{#4}{#5}}
\newcommand\csname@nYNNN[5]{\xp#1\xp{\csname#2\endcsname}{#3}{#4}{#5}}
\newcommand\csname@nYYNN[5]{\xp\csname@nNYNN\xp#1\xp{\csname#2\endcsname}{#3}{#4}{#5}}
\newcommand\csname@nnnny[5]{\xp\xp\xp#1\xp\xp\xp#2\xp\xp\xp#3\xp\xp\xp#4\csname#5\endcsname}
%-------------------------------------------------------------------------------------------------------------------------------%
\newcommand\xp@ny[2]{\xp#1#2}
\newcommand\xp@nY[2]{\xp#1\xp{#2}}
\newcommand\xp@nny[3]{\xp#1\xp#2#3}
\newcommand\xp@nnY[3]{\xp#1\xp#2\xp{#3}}
\newcommand\xp@nNY[3]{\xp#1\xp{\xp#2\xp}\xp{#3}}
\newcommand\xp@nyN[3]{\xp#1#2{#3}}
\newcommand\xp@nYN[3]{\xp#1\xp{#2}{#3}}
\newcommand\xp@nyy[3]{\xp\xp\xp#1\xp\xp\xp#2#3}
\newcommand\xp@nyY[3]{\xp\xp\xp#1\xp\xp\xp#2\xp{#3}}
\newcommand\xp@nyyy[4]{\xp\xp\xp\xp\xp\xp\xp#1\xp\xp\xp#2\xp#3#4}
\newcommand\xp@nyyY[4]{\xp\xp\xp\xp\xp\xp\xp#1\xp\xp\xp#2\xp#3\xp{#4}}
\newcommand\xp@nYNN[4]{\xp#1\xp{#2}{#3}{#4}}
\newcommand\xp@nnny[4]{\xp#1\xp#2\xp#3#4}
\newcommand\xp@nnyy[4]{\xp\xp\xp#1\xp\xp\xp#2\xp#3\xp#4}
\newcommand\xp@nYNNN[5]{\xp#1\xp{#2}{#3}{#4}{#5}}
\newcommand\xp@nNYNN[5]{\xp#1\xp{\xp#2\xp}\xp{#3}{#4}{#5}}
\newcommand\xp@nYYNN[5]{\xp\xp\xp#1\xp\xp\xp{\xp#2\xp}\xp{#3}{#4}{#5}}
%-------------------------------------------------------------------------------------------------------------------------------%
\newcommand\xp@nyII[2]{\xp\xp\xp#1\xp\xp\xp#2}
\newcommand\xp@csname@ny[2]{\xp\xp\xp#1\csname#2\endcsname}
\newcommand\xp@csname@nnY[3]{\xp\xp\xp#1\xp\xp\xp#2\xp\xp\xp{\csname#3\endcsname}}
\newcommand\xp@csargs[2]{\xp@csname@ny#1{#2}}
%\def\xp@def#1#2{\csname@nnY\def{#1}{#2}}
%\def\xp@gdef#1#2{\csname@nnY\gdef{#1}{#2}}
%\def\xp@edef#1#2{\csname@nnY\edef{#1}{#2}}
%\def\xp@xdef#1#2{\csname@nnY\xdef{#1}{#2}}
%-------------------------------------------------------------------------------------------------------------------------------%
%\newcommand\csname@nnY[3]{\xp#1\xp#2\xp{\csname#3\endcsname}}
%\def\defcs#1#2{\xp\def\xp#1\xp{\csname#2\endcsname}}
\def\defcs#1#2{\csname@nnY\def{#1}{#2}}
\def\gdefcs#1#2{\csname@nnY\gdef{#1}{#2}}
\def\edefcs#1#2{\csname@nnY\edef{#1}{#2}}
\def\xdefcs#1#2{\csname@nnY\xdef{#1}{#2}}
%-------------------------------------------------------------------------------------------------------------------------------%
%\newcommand\xp@nyN[3]{\xp#1#2{#3}}
%\newcommand\csname@nyN[3]{\xp#1\csname#2\endcsname{#3}}
%\def\xp@@def#1#2{\csname@nyN\def{#1}{#2}}       % \xp\def\xp#2\xp{\csname#3\endcsname}
%\def\xp@@gdef#1#2{\csname@nyN\gdef{#1}{#2}}     % \xp\gdef\csname#2\endcsname{#3}
%\def\xp@@edef#1#2{\csname@nyN\edef{#1}{#2}}
%\def\xp@@xdef#1#2{\csname@nyN\xdef{#1}{#2}}
%\def\xpdef#1#2{\xp\def#1{#2}}       % \xp\def\xp#2\xp{\csname#3\endcsname}
%\def\xpgdef#1#2{\xp\gdef#1{#2}}     % \xp\gdef\csname#2\endcsname{#3}
%\def\xpedef#1#2{\xp\edef#1{#2}}
%\def\xpxdef#1#2{\xp\xdef#1{#2}}
%-------------------------------------------------------------------------------------------------------------------------------%
%\newcommand\csname@ny[2]{\xp#1\csname#2\endcsname}
%\def\xp@newif#1{\xp\newif\csname#1\endcsname}
\def\newifcs#1{\csname@ny\newif{#1}}
%\def\xp@newif#1{\csname@ny\newif{#1}}
%\newcommand\csname@nYNN[4]{\xp#1\xp{\csname#2\endcsname}{#3}{#4}}
%\def\ifcsdefempty#1#2#3{\xp\ifdefempty\xp{\csname#1\endcsname}{#2}{#3}}
\def\ifcsdefempty#1#2#3{\csname@nYNN\ifdefempty{#1}{#2}{#3}}
%\def\xp@ifdefempty#1#2#3{\csname@nYNN\ifdefempty{#1}{#2}{#3}}
\def\xp@cmd#1#2{\xp#1\xp#2}
%-------------------------------------------------------------------------------------------------------------------------------%
\def\@csfor#1#2#3{\csname@nnnny\@for#1:={#2}\do{#3}}
%-------------------------------------------------------------------------------------------------------------------------------%
\protected@edef\keyeqval#1=#2{\edef#1{#2}}
%\edef\keyeqval#1=#2{\def#1{#2}}
%\def\keyeqval#1=#2{\def#1{#2}}
%-------------------------------------------------------------------------------------------------------------------------------%
\newcommand\scopecmd[3][\edef]%
{%
        \begingroup%
        #2%
        #1\x{\endgroup#3}\x%
}
%-------------------------------------------------------------------------------------------------------------------------------%
%\edef\x{\def\noexpand\dehandout##1\detokenize{_handout}{##1}}\x
\newcommand\scopedef[3][\protected@edef]%
{%
        \scopecmd[#1]{#2}{\noexpand#3}%%
%        \begingroup%
%        #2%
%        #1\x{\endgroup\noexpand#3}\x%
}
%-------------------------------------------------------------------------------------------------------------------------------%
\newcommand\preexpansion[3][\protected@edef]%
{%
        \def\preexpanded{#2}%
        \def\postexpanded{#3}%
        \scopedef[#1]{}{\postexpanded\preexpanded}%
        %\begingroup%
        %#1\x{\endgroup\noexpand\postexpanded\preexpanded}\x%
}
%-------------------------------------------------------------------------------------------------------------------------------%
%~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~%
%~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ Macro definition/assignment helper command definitions ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~%
%~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~%
%-------------------------------------------------------------------------------------------------------------------------------%
%----------------------------------------- Control sequence ssignment helper commands ------------------------------------------%
%-------------------------------------------------------------------------------------------------------------------------------%
\long\def\DoLongFutureLet #1#2#3#4%
{%
        \def\@FutureLetDecide%
        {%
                #1#2%
                \@FutureLetToken%
                        \def\@FutureLetNext{#3}%
                \else%
                        \def\@FutureLetNext{#4}%
                \fi%
                \@FutureLetNext%
        }%
        \futurelet\@FutureLetToken\@FutureLetDecide%
}
%-------------------------------------------------------------------------------------------------------------------------------%
\def\DoFutureLet #1#2#3#4{\DoLongFutureLet{#1}{#2}{#3}{#4}}
%-------------------------------------------------------------------------------------------------------------------------------%
%------------------------------- Control Sequence Definition Console/Document Printing Commands --------------------------------%
%-------------------------------------------------------------------------------------------------------------------------------%
\def\shown#1{\xp\show\csname\string#1\endcsname}
\def\showthen#1{\xp\showthe\csname\string#1\endcsname}
\def\don#1{\csname\string#1\endcsname}
\def\defn#1{\xp\def\csname\string#1\endcsname}
\def\qq#1\qq{\\\text{Trailing Code (Braced): \{}\texttt{\detokenize{#1}}\}}     %Print code executed after environment #1 closes
%-------------------------------------------------------------------------------------------------------------------------------%
%~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~%
%~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ List Creation/Modification/Manipulation/Print Commands ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~%
%~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~%
%-------------------------------------------------------------------------------------------------------------------------------%
%-------------------------------------------------------------------------------------------------------------------------------%
%------------------------------------------- Argument List Creation/Parsing Commands -------------------------------------------%
%-------------------------------------------------------------------------------------------------------------------------------%
\xdef\arg@default@prefix{arg}
\xdef\varg@default@prefix{varg}
\xdef\ssvarg@default@prefix{ssvarg}
\xdef\csvarg@default@prefix{csvarg}
\xdef\bsvarg@default@prefix{bsvarg}
\xdef\csnumname@default@prefix{arg}
\xdef\csvargG@default@prefix{csvargG}
\xdef\csvgroup@item@default@prefix{csvitem}
%-------------------------------------------------------------------------------------------------------------------------------%
\xdef\argdef@prefix{arg}
\xdef\varg@prefix{varg}
\xdef\ssvarg@prefix{ssvarg}
\xdef\csvarg@prefix{csvarg}
\xdef\bsvarg@prefix{bsvarg}
\xdef\csnumname@prefix{arg}
\xdef\csvargG@prefix{csvargG}
\xdef\csvgroup@item@prefix{csvitem}
\xdef\ssvargsep{ }
\xdef\csvargsep{,}
\xdef\bsvargsep{}
%-------------------------------------------------------------------------------------------------------------------------------%
\def\csvgroup@numformat{\roman}
\gdef\@xsvargs@numcmd#1{\romannumeral#1}
\gdef\xsvarg@numeral#1{\xsvarg@prefix\@xsvargs@numcmd#1}
\gdef\xsvarg@name#1{\xsvarg@prefix\@xsvargs@numformat{#1}}
\def\Romannumeral#1{\xp\uppercase\xp{\romannumeral#1\relax}}
\newcommand*{\rom}[1]{\expandafter\@slowromancap\romannumeral #1@}
\newcommand\romanarg[2][\csvarg@prefix]{\xdef\csvarg@prefix{#1}\csname\csvarg@prefix\romannumeral#2\endcsname}
\newcommand\Romanarg[2][\csvarg@prefix]{\xdef\csvarg@prefix{#1}\csname\csvarg@prefix\Romannumeral#2\endcsname}
\newcommand\lastvargcmd[1][\romannumeral]{\csuse{\csvarg@prefix#1\numexpr\narg+1\relax}}
\newcommand\lastvargcmd@def[2][\romannumeral]{\csgdef{\csvarg@prefix#1\numexpr\narg+1\relax}{#2}}
%-------------------------------------------------------------------------------------------------------------------------------%
\newcommand\setssvargs[2][\roman]{\setxsvargs[#1]{ssv}{#2}}
\newcommand\setbsvargs[2][\roman]{\setxsvargs[#1]{bsv}{#2}}
\newcommand\setcsvargs[2][\roman]{\setxsvargs[#1]{csv}{#2}}
%-------------------------------------------------------------------------------------------------------------------------------%
\newcommand\setxsvargs[3][\roman]%
{%
        \gdef\@xsvargs@numformat{#1}%
        \xp\gdef\xp\@xsvargs@numcmd@name\xp{\thecsname{#1}numeral}%
        \gdef\@xsvargs@numcmd##1{\@nameuse{\@xsvargs@numcmd@name}##1}%
        \xdef\xsvarg@prefix{\csuse{#2arg@prefix}}%
        \xdef\xsvargsep{\csuse{#2argsep}}%
        \gdef\parse@xsvBlock{\csname parse@#2Block\endcsname}%
        \if T\converttilde\def~{ }\else\catcode`~=12\fi%
        \protected@edef\the@string{#3}%
        \setcounter{arg@index}{0}%
        \preexpansion{\xsvargsep}{\lowercase{\xp\parse@xsvBlock\the@string}}\string@end%
        \let~\SaveHardspace%
        \catcode`~=13%
}
%-------------------------------------------------------------------------------------------------------------------------------%
%-------------------------------------------------------------------------------------------------------------------------------%
%-------------------------------------------------------------------------------------------------------------------------------%
\def\parse@@xsvBlock#1%
{%
        \stepcounter{arg@index}%
        \@namedef{\xsvarg@name{arg@index}}{#1}%
        \futurelet\tmp\parse@xsvBlock@%
}
%-------------------------------------------------------------------------------------------------------------------------------%
\def\parse@ssvBlock#1 {\parse@@xsvBlock{#1}}
\def\parse@csvBlock#1,{\parse@@xsvBlock{#1}}
\def\parse@bsvBlock#1{\parse@@xsvBlock{#1}}
%-------------------------------------------------------------------------------------------------------------------------------%
\def\parse@xsvBlock@%
{%
        \ifx\tmp\string@end\edef\narg{\thearg@index}\xp\@gobble%
        \else\xp\parse@xsvBlock\fi%
}
%-------------------------------------------------------------------------------------------------------------------------------%
%~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~%
%~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ Generic/universal list handling definitions ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~%
%~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~%
%-------------------------------------------------------------------------------------------------------------------------------%
\def\@create@tokenlist#1#2%
{%
        \@tfor\nextchar:=#1\do%
        {%
                \xp\@add@to@csvlist%
                \xp{\xp\string\nextchar}%
                {#2}%
        }%
}
%-------------------------------------------------------------------------------------------------------------------------------%
%---------------------------------------------------- List printing commands ---------------------------------------------------%
%-------------------------------------------------------------------------------------------------------------------------------%
\def\isinlist#1#2#3%
{%
        \def\tmp##1#2##2\end%
        {%
                \def\tmp{##2}%
                \ifx\tmp\empty \csname iffalse\xp\endcsname \else
                \csname iftrue\xp\endcsname \fi%
        }% end of \def\tmp
        \xp\tmp#1\endlistsep#2\end
}
%-------------------------------------------------------------------------------------------------------------------------------%
\def\ifmember#1#2%
{%
        \in@{#1}{#2}%
        \ifin@%
                \expandafter\@firstoftwo%
        \else%
                \expandafter\@secondoftwo%
        \fi%
}
%-------------------------------------------------------------------------------------------------------------------------------%
\def\ifcsvlistitem#1#2%
{%
        \def\csvcheckitem{#1}%
        \xp\xp\xp\in@\xp\xp\xp{\xp\csvcheckitem\xp}\xp{#2}%
        \ifin@%
                \expandafter\@firstoftwo%
        \else%
                \expandafter\@secondoftwo%
        \fi%
}
%-------------------------------------------------------------------------------------------------------------------------------%
%---------------------------------------------------- List printing commands ---------------------------------------------------%
%-------------------------------------------------------------------------------------------------------------------------------%
\long\def\@addto#1#2#3%
{%
        \ifundef{#2}%
                {#1#2{#3}}%
                {\xp#1\xp#2\xp{#2#3}}%
}
%-------------------------------------------------------------------------------------------------------------------------------%
%\long\def\addto#1#2{\xp\def\xp#1\xp{#1#2}}
\long\def\addto#1#2{\@addto\def{#1}{#2}}
\long\def\eaddto#1#2{\@addto\edef{#1}{#2}}
\long\def\gaddto#1#2{\@addto\gdef{#1}{#2}}
\long\def\xaddto#1#2{\@addto\xdef{#1}{#2}}
%\long\def\xaddto#1#2{\xdef#1{#1#2}}
%-------------------------------------------------------------------------------------------------------------------------------%
\def\addtolist#1#2{\lst@lAddTo#1{#2}}
%-------------------------------------------------------------------------------------------------------------------------------%
\def\@add@to@argslist#1#2%
{%
        %\ifx#2\@empty\undef#2\fi
        \ifundef{#2}%
                {\gdef#2{{#1}}}%
                {\gdef#2{#2 {#1}}}%
}
%-------------------------------------------------------------------------------------------------------------------------------%
\def\@add@to@csvlist#1#2%
{%
        \ifx#2\@empty\undef#2\fi%
        \ifundef{#2}%
                {\protected@xdef#2{#1}}%
                {\protected@xdef#2{#2,#1}}%
}
%-------------------------------------------------------------------------------------------------------------------------------%
\def\@uniquely@add@to@csvlist#1#2%
{%
        \ifx#2\@empty\undef#2\fi%
        \ifundef{#2}%
        {\protected@xdef#2{#1}}%
        {%
                %\ifmember{#1}{#2}{}{\protected@xdef#2{#2,#1}}%
                \def\csvcheckitem{#1}%
                \xp\xp\xp\in@\xp\xp\xp{\xp\csvcheckitem\xp}\xp{#2}%
                \ifin@\else%
                        \protected@xdef#2{#2,#1}%
                \fi%
                %\protected@xdef#2{#2,#1}
        }%
}
%-------------------------------------------------------------------------------------------------------------------------------%
%---------------------------------------------------- List ordering commands ---------------------------------------------------%
%-------------------------------------------------------------------------------------------------------------------------------%
\def\sortbycolA#1|#2|#3|#4;%
{%
        \addtolist{\@sorted@list}{#1#2,}%
        \xp\gdef\csname#1#2\endcsname{\textit{#1}&#2&#3&#4\cr\relax}%
        \lst@BubbleSort{\@sorted@list}%
}
%-------------------------------------------------------------------------------------------------------------------------------%
\def\sortbycolB#1|#2|#3|#4;%
{%
        \addtolist{\@sorted@list}{#2#1,}%
        \xp\gdef\csname#2#1\endcsname{\textit{#1}&#2&#3&#4\cr\relax}%
        \lst@BubbleSort{\@sorted@list}%
}
%-------------------------------------------------------------------------------------------------------------------------------%
%---------------------------------------------------- List printing commands ---------------------------------------------------%
%-------------------------------------------------------------------------------------------------------------------------------%
\def\printlist@addsep#1#2{\ifnumcomp{#1}{<}{#2}{,\space}{}}
%-------------------------------------------------------------------------------------------------------------------------------%
\def\@print@deflist#1%
{%
        \edef\@current@list{#1}%
        \@for\next:=\@current@list \do{\next,}%
}
%-------------------------------------------------------------------------------------------------------------------------------%
%~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~%
%~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ Console Message Printing Helper Commands ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~%
%~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~%
%-------------------------------------------------------------------------------------------------------------------------------%
\gdef\msgtext{Default message text}
\gdef\hlptext{Default help text}
\def\IndentedMessageBreak{\MessageBreak\space\space\space\space}
\def\DoubleIndentedMessageBreak{\MessageBreak\space\space\space\space\space\space\space\space}
\xdef\DoubleIndented{\space\space\space\space\space\space\space\space}
%-------------------------------------------------------------------------------------------------------------------------------%
%~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~%
%~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ Package loading commands extending '\RequirePackage' ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~%
%~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~%
%-------------------------------------------------------------------------------------------------------------------------------%
\newcommand\RequirePackageOnce[1]
{%
        \@ifpackageloaded{#1}{}%
        {%
                \RequirePackage{#1}%
                \@add@to@csvlist{#1}{\@loaded@packages}%
        }%
}
%-------------------------------------------------------------------------------------------------------------------------------%
\newcommand\RequirePackageList[1]{\@for\next:=#1\do{\xp\RequirePackageOnce\xp{\next}}}
%-------------------------------------------------------------------------------------------------------------------------------%
\newcommand\RequirePkg[2][]%
{%
        %\ifstrempty{#1}{\edef\pkgpath{\@pkg@dir}}{\edef\pkgpath{#1}}
        \IfFileExists{\@pkg@dir#2.sty}%
               {\RequirePackage[#1]{\@pkg@dir#2}}%
               {\RequirePkgWarning{#2}\RequirePackage[#1]{#2}}%
}
%-------------------------------------------------------------------------------------------------------------------------------%
\newcommand\RequirePkgOnce[2][]
{%
        \@ifpackageloaded{\@pkg@dir#2}{}%
        {%
                \IfFileExists{\@pkg@dir#2.sty}%
                       {\RequirePackage[#1]{\@pkg@dir#2}}%
                       {\RequirePkgWarning{#2}\RequirePackage[#1]{#2}}%
        }%
}
%-------------------------------------------------------------------------------------------------------------------------------%
\newcommand\RequirePkgList[1]{\@for\next:=#1\do{\xp\RequirePkg\next}}
%-------------------------------------------------------------------------------------------------------------------------------%
\newcommand\ProvidesPkg[2][]%
{%
        %\ifstrempty{#1}{\edef\pkgpath{\@pkg@dir}}{\edef\pkgpath{#1}}
        \IfFileExists{\@pkg@dir#2.sty}%
               {\RequirePackage[#1]{\@pkg@dir#2}}%
               {\RequirePkgWarning{#2}\RequirePackage[#1]{#2}}%
}
%-------------------------------------------------------------------------------------------------------------------------------%
%~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~%
%~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ Windows/Unix Shell Command Definitions ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~%
%~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~%
%-------------------------------------------------------------------------------------------------------------------------------%
\gdef\LOCAL@PKG@PREFIX{}% ./texmf/tex/latex/R2Labs/
%-------------------------------------------------------------------------------------------------------------------------------%
\def\colordefs@dirname{colordefs}
\xdef\TDS@PKG@DIR{texmf-local/tex/latex/\PKGNAME/}
\def\DROPBOX@DIRNAME{Dropbox}
\def\CNF@FILENAME{texmf.cnf}
\def\TEXMFLOCAL@dirname{texmf-local}
\def\TEXMFLOCAL@default@val{\cnf@unix@envvar{SELFAUTOGRANDPARENT}/\TEXMFLOCAL@dirname}
\def\cnf@comment#1{\@percentchar\space#1\wr@endline}
\def\cnf@keyval#1{#1\wr@endline\wr@endline}
\def\cnf@win@envvar#1{\@percentchar#1\@percentchar}
\def\cnf@unix@envvar#1{\wr@dollar#1}
%-------------------------------------------------------------------------------------------------------------------------------%
\edef\wr@hashmark{\string#}\edef\wr@lbrace{\string{}\edef\wr@rbrace{\string}}
\edef\wr@dollar{\string$}\edef\wr@lbrace{\string{}\edef\wr@rbrace{\string}}
\edef\wr@percent{\expandafter\string\%}\edef\wr@lbrace{\string{}\edef\wr@rbrace{\string}}
\edef\wr@atmark{\string @}\edef\wr@lbrace{\string{}\edef\wr@rbrace{\string}}
\edef\wr@lcarat{\string<}\edef\wr@lbrace{\string{}\edef\wr@rbrace{\string}}
\edef\wr@rcarat{\string>}\edef\wr@lbrace{\string{}\edef\wr@rbrace{\string}}
\edef\wr@circumflex{\string^}\edef\wr@lbrace{\string{}\edef\wr@rbrace{\string}}
\edef\wr@endline{\string^^J}\edef\wr@lbrace{\string{}\edef\wr@rbrace{\string}}
\def\wr@par{\string^^I}\edef\wr@lbrace{\string{}\edef\wr@rbrace{\string}}
\def\totext@langle{\catcode`\<=\active\noexpand\def<{\textlangle}}
\def\totext@rangle{\catcode`\>=\active\noexpand\def<{\textrangle}}
\def\totext@underscore{\catcode`\_=\active\noexpand\def<{\textunderscore}}
%\char92        '\'
%\char94        '^'
%\char126       '~'
%-------------------------------------------------------------------------------------------------------------------------------%
\def\MAINDOC@FNAME{\jobname.tex}
\def\STDOUT@FNAME{\jobname.stdout}
\def\SYSNFO@FNAME{\jobname.nfo}
\def\PKGOPTS@FNAME{\jobname.pkgopts}
%-------------------------------------------------------------------------------------------------------------------------------%
\def\ls@win{\immediate\write18{dir}}
\def\ls@unix{\immediate\write18{ls -a}}
\def\rm@win#1{\immediate\write18{erase #1}}
\def\rm@unix#1{\immediate\write18{rm -f -- #1}}
\def\rmdir@win#1{\immediate\write18{rmdir #1}}
\def\rmdir@unix#1{\immediate\write18{rmdir #1}}
\def\mkdir@win#1{\immediate\write18{mkdir #1}}
\def\mkdir@unix#1{\immediate\write18{mkdir -p #1}}
\def\chdir@win#1{\immediate\write18{chdir #1}}
\def\chdir@unix#1{\immediate\write18{cd #1}}
%-------------------------------------------------------------------------------------------------------------------------------%
\def\TeXcompiler{pdflatex}
\def\verflag{--version}
\def\compileTeX#1{#1}
%\def\@pdflatex@switches#1{#1}
\def\@shell@esc{--shell-escape}
\def\@shell@skip{\space\space}
%\CatchFileEdef{\stdoutB}{"|find -type d -maxdepth 1"}{\endlinechar=-1}%
%\edef\x{\endgroup\def\noexpand\TeXpath{\@@input|"which tex" }}\x
%\def\x{\endgroup\def\noexpand\TeXpath{\@@input|"dir" }}
%\begingroup\makeatletter\endlinechar=\m@ne\everyeof{\noexpand}
% --shell-escape -recorder WalkerProject-Documentation.tex
%-------------------------------------------------------------------------------------------------------------------------------%
\edef\envvar@prefix{COMPUTERNAME,ComSpec,COMSPEC,HOMEDRIVE,HOMEPATH,PDFLATEX,SHELL,SYSTEMROOT,TERM,TEXEDIT,USERPROFILE,WINDIR}
\edef\texenvvar@prefix{TEX}
\edef\sysenvvar@prefix{USER}
\edef\sysenvvar@winlist{COMPUTERNAME,ComSpec,COMSPEC,HOMEDRIVE,HOMEPATH,PDFLATEX,SHELL,SYSTEMROOT,TERM,TEXEDIT,USERPROFILE,WINDIR}
%\gdef\envvar@winlist{USERPROFILE}
\edef\texenvvar@winlist{TEXMFDIST,TEXEDIT,TEXMFHOME,TEXMFROOT,TEXMFVAR}
\edef\sysenvvar@unixlist{HOME}
%\edef\texenvvar@unixlist{\texenvvar@winlist}
%-------------------------------------------------------------------------------------------------------------------------------%
\newcommand{\fname@recorder}[1][\jobname.tex]{-recorder #1}
%-------------------------------------------------------------------------------------------------------------------------------%
\newcommand{\ifOScmd}[2][\OScmd]{\def\OScmd{\@csname{\ifOS{#2@win}{#2@unix}}}}
\newcommand{\ifOSdo}[1]{\ifOScmd{#1}\OScmd}
\newcommand{\ifOS}[2]{\ifwindows#1\else#2\fi}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             %-------------------------------------------------------------------------------------------------------------------------------%
%~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~%
%~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ Terminal Execution & File Writing Commands ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~%
%~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~%
%-------------------------------------------------------------------------------------------------------------------------------%
%cp -lRr * /drives/c/texlive/2014/texmf-dist/tex/latex/mymacros/colordefs/%\DeleteFile
%\ProvideDirectory
%-------------------------------------------------------------------------------------------------------------------------------%
\newcommand\fread[2]{\immediate\openin\@ifstream=#1 #2\immediate\closein\@ifstream}
\newcommand\fwrite[2]{\immediate\openout\@ofstream=#1 #2\immediate\closeout\@ofstream}
\newcommand\mklfile[1]{\IfFileExists{#1}{}{\fwrite{#1}}}
\newcommand\wrlfile[2]{\fwrite{#1}{\immediate\write\@ofstream{#2}}}
%-------------------------------------------------------------------------------------------------------------------------------%
\newcommand\wrpipe[2]{\immediate\write18{|"echo #2 > '#1'"}}
\newcommand\wrfile[2]{\immediate\write18{#2 > '#1'}}
\newcommand\wrline[1]{\immediate\write\@ofstream{#1}}
\newcommand\mkfile{\@ifstar{\mkfile@withstar}{\mkfile@withoutstar}}
\newcommand\mkfile@withstar[1]{\wrfile{#1}{\cr}}
\newcommand\mkfile@withoutstar[1]{\IfFileExists{#1}{}{\wrfile{#1}{\cr}}}
%-------------------------------------------------------------------------------------------------------------------------------%
\newcommand\fcontents[2][\finput]%
{
        \immediate\openin\@ifstream=\jobname.nfo
        \begingroup
        %\endlinechar=\m@ne
        %\bgroup
        %\endlinechar=-1
        \obeylines\obeyspaces
        %\catcode13=5 % ^^M
%        \catcode10=5 % lf
%        \catcode10=13 % lf
%        \catcode13=13 % lf
        %\endlinechar=10 %
        %\endlinechar=13 %
        %\catcode13=5 % ^^M
        %\catcode35=6 % #
        \catcode37=11 % %
        %\catcode64=11 % @
        %\catcode123=1 % {
        %\catcode125=2 % }
        %\obeylines\obeyspaces%
        %\def\char10{abc}
        %\def\char13{abc}
        %\def\char10{abc}
        %\catcode13=\active % ^^M
        %\def^^M{^^J}
        \loop\unless\ifeof\@ifstream
%       \@whilesw\unless\ifeof\@ifstream\fi%
%       {%
                %\obeylines\obeyspaces
                \advance\linecnt by \@ne%
                %\immediate\readline\@ifstream to \finputline
%               \ifx\@ifstream\@empty\else
%               {(\number\linecnt) \@ifstream\testtext}%
%                       \par %\newpage
%               \fi
                \immediate\read\@ifstream to \finputline
                \ifundef{\finput}
                        {\xp\gdef\xp\finput\xp{\finputline}}
                        {\xaddto\finput\finputline}
                %#1
                %\finput
                %\readline\@ifstream to \csuse{aline}
%                \read\@ifstream to #1
%                       \read\@ifstream to\expandafter\csname line\number\linecnt\endcsname
%               #1
%       }
                %\unless\ifeof\@ifstream
        \repeat
        \finput
        \endgroup
}
%-------------------------------------------------------------------------------------------------------------------------------%
%\immediate\write18{/usr/local/bin/my-shell-script.sh > scriptoutput.tex}
%\input{|"/usr/local/bin/my-shell-script.sh"}
\newcommand{\gettexenv}[2][\stdout]%
{%
      \terminal[#1]{kpsewhich --var-value #2}%
      %\terminal[#1]{set #2}%
      %\CatchFileEdef{#1}{"|set #2"}{\catcode`\\=12\endlinechar=-1}%
      %\CatchFileEdef{#1}{"|set #2"}{\@sanitize\endlinechar=-1}%
      %\CatchFileEdef{\stdout}{"|kpsewhich --var-value #2"}{\endlinechar=-1}%
      %\if\relax\detokenize{#1}\relax\stdout\else\let#1\stdout\fi%
}
%-------------------------------------------------------------------------------------------------------------------------------%
\newcommand{\getenv}[2][\stdout]%
{%
      %\CatchFileEdef{#1}{"|set TEXMFHOME=C:\Users\Blake\texmf"}{\catcode`\\=12\endlinechar=-1}%
      %\terminal[#1]{kpsewhich -expand-braces -var-value #2}%
      %\terminal[#1]{set #2}%
      %\CatchFileEdef{#1}{"|set #2"}{\catcode`\\=12\endlinechar=-1}%
      %\CatchFileEdef{#1}{"|set #2"}{\@sanitize\endlinechar=-1}%
      \CatchFileEdef{#1}{"|kpsewhich -var-value #2"}{\catcode37=11\endlinechar=-1}%-expand-var
      %\def\stdout{\input{|"kpsewhich -var-value #2"}}
      %  \begingroup\everyeof{\noexpand}
      %  \def\x{\endgroup\def\USER@TEXEDIT{\@@input|"kpsewhich --var-value #2"}}\x%
        %\edef\x{\endgroup\noexpand\zap@space\x\noexpand\@empty}\x%
      %\if\relax\detokenize{#1}\relax\stdout\else\let#1\stdout\fi%
}
%-------------------------------------------------------------------------------------------------------------------------------%
\newcommand\fullpath{%
        \begingroup\everyeof{\noexpand}\@sanitize
        \edef\x{\@@input|"find test.tex" }%
        \edef\x{\endgroup\noexpand\zap@space\x\noexpand\@empty}\x%
        \begingroup\makeatletter\endlinechar=\m@ne\obeylines\everyeof{\noexpand}\@sanitize%\obeyspaces
        %\edef\x{\endgroup\def\noexpand\TeXpath{\@@input|"which tex" }}\x
        \edef\x{\endgroup\def\noexpand\TeXpath{\@@input|"dir" }}\x
        %\edef\termoutput{\xp\xp\xp\macroname\xp\xp\xp{\input{|"dir" }}}
}
%-------------------------------------------------------------------------------------------------------------------------------%
\newcommand{\terminal}{\@ifstar{\@terminal@withstar}{\@terminal@withoutstar}}
%-------------------------------------------------------------------------------------------------------------------------------%
\newcommand{\@terminal@withoutstar}[2][\stdout]%
{%
      \CatchFileEdef{#1}{"|#2"}{\endlinechar=-1}%
}
%-------------------------------------------------------------------------------------------------------------------------------%
\newcommand{\@terminal@withstar}[2][\stdout]%
{%
        \begingroup%
                %{\catcode`\^^M13 \gdef\obeycr{\catcode`\^^M13 \def^^M{^^J}%
                %\@gobblecr}
                %\@sanitize\everyeof{\noexpand}
                %\catcode`\^^M=\active\let^^M\wr@endline%
                %\CatchFileDef{\stdout}{"|#1"}{\endlinechar=-1}%
                %\CatchFileDef{#1}{"|#2"}{\@sanitize\obeycr\obeylines}%\endlinechar=-1
                \CatchFileDef{#1}{"|#2"}{}%
                \if\relax\detokenize{#1}\relax\stdout\else\global\let#1\stdout\fi%
        \endgroup
}
%-------------------------------------------------------------------------------------------------------------------------------%
\newcommand\termexec{\@ifstar{\@rm@termfile@false\@termexec}{\@rm@termfile@true\@termexec}}
%-------------------------------------------------------------------------------------------------------------------------------%
\newcommand\@termexec[2][\stdout]%
{
        %\newread\@ifstream
        %\immediate\write18{#2 > '\STDOUT@FNAME'}
        \wrfile{\STDOUT@FNAME}{#2}%
        \immediate\openin\@ifstream=\jobname.stdout
        \bgroup
          \endlinechar=-1
          \read\@ifstream to \localline
          \global\let#1\localline
        \egroup
        \closein\@ifstream
        \if@rm@termfile@
                \ifOSdo{rm}{'\jobname.stdout'}
        \fi
        \@rm@termfile@true
}
%\def\@makeletter#1{\catcode`#111\relax}
\def\@makeletter#1{\catcode`#1=11\relax}
%-------------------------------------------------------------------------------------------------------------------------------%
\def\@cssanitize{\@makeother\\ \@makeother\$\@makeother\&\@makeother\#\@makeother\^\@makeother\_\@makeother\%\@makeother\~}
%-------------------------------------------------------------------------------------------------------------------------------%
\def\@makeactive#1{\catcode`\#1\active}
%-------------------------------------------------------------------------------------------------------------------------------%
%\begingroup\escapechar=-1\edef\x{\endgroup\string\power}\x
\newcommand\csprint[1]{\scopecmd{\escapechar=-1}{\string#1}}
%-------------------------------------------------------------------------------------------------------------------------------%
\newcommand\dosystem{\@ifstar{\@tempswafalse\do@system}{\@tempswatrue\do@system}}
%-------------------------------------------------------------------------------------------------------------------------------%
\newcommand\do@system[1]{%
  \begingroup
  \let\%\@percentchar
  \let\#\wr@hashmark
  \let\$\wr@dollar
  \let\<\wr@lcarat
  \let\>\wr@rcarat
  \let\{\wr@lbrace
  \let\}\wr@rbrace
  \if@tempswa\expandafter\immediate\fi
  \write18{#1}%
  \endgroup
}
%-------------------------------------------------------------------------------------------------------------------------------%
%*******************************************************************************************************************************%
%******************* Package loading commands extending '\RequirePackage' and package option handler commands ******************%
%*******************************************************************************************************************************%
%-------------------------------------------------------------------------------------------------------------------------------%
%-------------------------------------------------------------------------------------------------------------------------------%
%*******************************************************************************************************************************%
%*********************************************** End of 'pkgbase.sty' package **************************************************%
%*******************************************************************************************************************************%
%-------------------------------------------------------------------------------------------------------------------------------%
\makeatother
%-------------------------------------------------------------------------------------------------------------------------------%
\endinput
%-------------------------------------------------------------------------------------------------------------------------------%
%*******************************************************************************************************************************%
%*********************************************************** NOTES *************************************************************%
%*******************************************************************************************************************************%
%-------------------------------------------------------------------------------------------------------------------------------%
%\bgroup
%\obeylines\obeyspaces
%\catcode`\<=\active
%\catcode`\>=\active
%\catcode`\_=\active
%\def<{\textlangle}
%\def>{\textrangle}
%\def_{\textunderscore}
%\catcode`\!=0
%!catcode`!\=!active
%!def\{!textbackslash}
%!input{|"dir"}
%!egroup
%-------------------------------------------------------------------------------------------------------------------------------%
\def\nfss@catcodes{%
     \makeatletter
     \catcode`\ 9%
     \catcode`\^^I9%
     \catcode`\^^M9%
     \catcode`\\\z@
     \catcode`\{\@ne
     \catcode`\}\tw@
     \catcode`\#6%
     \catcode`\^7%
     \catcode`\%14%
   \@makeother\<%
   \@makeother\>%
   \@makeother\*%
   \@makeother\.%
   \@makeother\-%
   \@makeother\/%
   \@makeother\[%
   \@makeother\]%
   \@makeother\`%
   \@makeother\'%
   \@makeother\"%
}
%\def\termchars{!\,!_}
%-------------------------------------------------------------------------------------------------------------------------------%
%\newcommand\termprint[1]%
%\protected@edef\termprint#1%
\protected\def\termprint#1%
{%
        %\begingroup%
        %\bgroup
        %\noexpand{
        %\catcode`\!=0
        %\protect{
        {{
        \catcode`\!\n@ne
        \catcode`\_=11
        %!catcode`!\=11
        %!@makeletter{_}
        !@makeletter{\\}
%       !@makeletter{!\}
%       !@makeletter{!_}
!obeyspaces!obeylines
        !def!dirout{!input{|"dir"}}
%%  !xp!gdef!xp!dirout!xp{!input{|"dir"}}
%  %!xp!def!xp!dirout!xp{!input{|"dir"}}
  !dirout}}
        %#1
        %\noexpand}
        %\protect}
        %!egroup
        %!endgroup
}
\newcommand\starttermout%
%\protected@edef\starttermout%
{%
        %\bgroup
        \obeylines\obeyspaces%
        \catcode`\_=11
        \catcode`\!=0
        !@cssanitize
        !@makeletter{\\}
        !catcode`!_=11
        %!catcode`!\=11
        %!catcode`!_=11
}
\def\endtermout%
{%
        !egroup
        %!endgroup
        %!endgroup
        %\catcode`\!=12
        %\catcode`\_=8
        %\catcode`\\=0
        %\catcode`\_=12
}
