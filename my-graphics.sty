%*****************************************************************************************************************************************%
%********************************************************** `my-graphics.sty' ************************************************************%
%*****************************************************************************************************************************************%
%
%*****************************************************************************************************************************************%
%*************************************** Define provided package name and LaTeX/package dependencies *************************************%
%*****************************************************************************************************************************************%
\NeedsTeXFormat{LaTeX2e}[2005/12/01]
\ProvidesPackage{my-graphics}
%*****************************************************************************************************************************************%
%****************************************** Package options and corresponding Boolean variables ******************************************%
%*****************************************************************************************************************************************%
%-----------------------------------------------------------------------------------------------------------------------------------------%
\DeclareOption*{\PackageWarning{my-graphics}{Unknown \CurrentOption}}
%*****************************************************************************************************************************************%
%***************************************************** Processing of package options *****************************************************%
%*****************************************************************************************************************************************%
%-----------------------------------------------------------------------------------------------------------------------------------------%
\ProcessOptions\relax
%-----------------------------------------------------------------------------------------------------------------------------------------%
%\catcode`\!=12
%\makeatletter                                                  % Change @ to standard letter, \catcode'@=11 so it can be used in macro names/definition
%*****************************************************************************************************************************************%
%****************************************************** Package register variables *******************************************************%
%*****************************************************************************************************************************************%
% Three counters
\newcounter{x}
\newcounter{y}
\newcounter{z}

% The angles of x,y,z-axes
\newcommand\xaxis{210}
\newcommand\yaxis{-30}
\newcommand\zaxis{90}

\def\@default@cube@scale{1.0}
\def\@default@cube@rotation{0}
\def\@cube@rotation{\@default@cube@rotation}
%\def\@rotate@cube@around@x{0}
%\def\@rotate@cube@around@y{0}
%\def\@rotate@cube@around@z{0}
%*****************************************************************************************************************************************%
%************************************************************* Package Body **************************************************************%
%*****************************************************************************************************************************************%
%-----------------------------------------------------------------------------------------------------------------------------------------%
\def\@cube@origin@angle@x{210}
\def\@cube@origin@angle@y{-30}
\def\@cube@origin@angle@z{90}
\def\@default@cube@colors{black,yellow,red,blue}
\def\@default@bicolor@cube@colors{green,orange,cyan}
\def\@default@cube@rotate@around@xyz{0,0,0}
\def\@default@cube@sidelengths{1.0cm,1.0cm,1.0cm}
\def\@set@cube@colors(#1,#2,#3,#4)%
{%
        \def\@edge@color{#1}%
        \def\@top@face@color{#2}%
        \def\@front@face@color{#3}%
        \def\@right@face@color{#4}%
        \def\@bottom@face@color{#2}%
        \def\@back@face@color{#3}%
        \def\@left@face@color{#4}%
}
\def\@set@cube@bicolors(#1,#2,#3)%
{%
        \def\@bottom@face@color{#1}%
        \def\@back@face@color{#2}%
        \def\@left@face@color{#3}%
}
\def\@set@cube@sidelengths(#1,#2,#3)%
{%
        \def\@cube@sidelength@x{#1}%
        \def\@cube@sidelength@y{#2}%
        \def\@cube@sidelength@z{#3}%
}
\def\@set@cube@rotate@around@xyz(#1,#2,#3)%
{%
        \def\@cube@rotate@around@x{#1}%
        \def\@cube@rotate@around@y{#2}%
        \def\@cube@rotate@around@z{#3}%
}
\@init@length{@cube@side@length}[0.5cm]
%-----------------------------------------------------------------------------------------------------------------------------------------%
%\pgfmathparse{ifthenelse(\@macro@width>= \linewidth, 1, 0)}%
%                                \if\pgfmathresult 1\relax%
%                                        \vspace{-12.5mm}%
%                                        \doublespacing%
%                                        \shadowtext{\parbox{\textwidth}{\raggedright#3{#4}}}%
%                                        \vspace{1mm}%
%                                \else%
%                                        \vspace{-6mm}%
%                                        \shadowtext{\raggedright#3{#4}}%
%                                        \vspace{-4mm}%
%                                \fi%
%-----------------------------------------------------------------------------------------------------------------------------------------%
\def\xp@cmd#1#2{\expandafter#1\expandafter#2}
%-----------------------------------------------------------------------------------------------------------------------------------------%
%1                         2                                     3                             4 5
\DeclareDocumentCommand{\blockstructure}%
{D<>{\@default@cube@scale} D(){\@default@cube@rotate@around@xyz} O{\@default@cube@sidelengths} m O{\@default@cube@colors} d||}
{%{O{\@default@rotate@cube@around@xyz} D<>{\@cube@side@length} m O{black,yellow,red,blue}}
        \xp@cmd\@set@cube@rotate@around@xyz(#2)
        \xp@cmd\@set@cube@sidelengths(#3)
        \xp@cmd\@set@cube@colors(#5)
        \IfValueTF{#6}{\xp@cmd\@set@cube@bicolors(#6)}{}
        \begin{tikzpicture}
        [
                scale=#1,
                x=(\@cube@origin@angle@x:\@cube@sidelength@x),
                y=(\@cube@origin@angle@y:\@cube@sidelength@y),
                z=(\@cube@origin@angle@z:\@cube@sidelength@z),
                %scale=#1, x=#3, y=#4, z=#5,
                %rotate around x=25, rotate around y=25, rotate around z=25
                %cm={-1,0,0,-1,(0,0)},
                %cm={0,-1,1,0,(0,0)},
                %rotate=180,
                rotate around x=\@cube@rotate@around@x,
                rotate around y=\@cube@rotate@around@y,
                rotate around z=\@cube@rotate@around@z
        ]
                \foreach \m [count=\y] in {#4}
                {
                        \foreach \n [count=\x] in \m
                        {
                                \ifnum \n>0
                                        \foreach \z in {1,...,\n}
                                        {
                                                % Default:
                                               	\@bottom@cube@face{\x}{\y}{\z}{\n}
                                                \@back@cube@face{\x}{\y}{\z}{\n}
                                                \@left@cube@face{\x}{\y}{\z}{\n}
                                                \@right@cube@face{\x}{\y}{\z}{\n}
                                                \@front@cube@face{\x}{\y}{\z}{\n}
                                                \@top@cube@face{\x}{\y}{\z}{\n}
                                                % SOLVeS 2/3/5 (40,-30,0)/(0,40,-30)/(40,-30,30)
%                                                \@top@cube@face{\x}{\y}{\z}{\n}
%                                                \@back@cube@face{\x}{\y}{\z}{\n}
%                                                \@left@cube@face{\x}{\y}{\z}{\n}\@right@cube@face{\x}{\y}{\z}{\n}
%                                                \@right@cube@face{\x}{\y}{\z}{\n}\@left@cube@face{\x}{\y}{\z}{\n}
%                                                \@front@cube@face{\x}{\y}{\z}{\n}
%                                                \@bottom@cube@face{\x}{\y}{\z}{\n}
%                                                % SOLVeS 2/5 (40,-30,0)/(40,-30,30)
%                                                \@top@cube@face{\x}{\y}{\z}{\n}
%                                                \@back@cube@face{\x}{\y}{\z}{\n}
%                                                \@left@cube@face{\x}{\y}{\z}{\n}
%                                                \@front@cube@face{\x}{\y}{\z}{\n}
%                                                \@right@cube@face{\x}{\y}{\z}{\n}
%                                                \@bottom@cube@face{\x}{\y}{\z}{\n}
                                                % SOLVeS 3/4 (0,40,-30)/(40,-30,-60)
%                                                \@back@cube@face{\x}{\y}{\z}{\n}
%                                                \@right@cube@face{\x}{\y}{\z}{\n}
%                                                \@top@cube@face{\x}{\y}{\z}{\n}
%                                                \@bottom@cube@face{\x}{\y}{\z}{\n}
%                                                \@left@cube@face{\x}{\y}{\z}{\n}
%                                                \@front@cube@face{\x}{\y}{\z}{\n}
                                                % SOLVeS 4 (40,-30,-60)
%                                                \@back@cube@face{\x}{\y}{\z}{\n}
%                                                \@right@cube@face{\x}{\y}{\z}{\n}
%                                                \@bottom@cube@face{\x}{\y}{\z}{\n}
%                                                \@left@cube@face{\x}{\y}{\z}{\n}
%                                                \@front@cube@face{\x}{\y}{\z}{\n}
%                                                \@top@cube@face{\x}{\y}{\z}{\n}
                                                %\@left@cube@face{\x}{\y}{\z}{\n}
                                                %\@back@cube@face{\x}{\y}{\z}{\n}
                                                %\@front@cube@face{\x}{\y}{\z}{\n}
                                                %\node [rotate=0.9] at (\x+0.5, \y, \n -1.0) {\n};
                                        }
                                        %\node [rotate=0.9] at (\x+0.5, \y, \n -1.0) {\n};
                                        %\node [rotate=-0]at (\x+0.5, \y, \n-1.0) {\n};
                                        %\node [rotate=45]at (\x+0.5, \y, \n-1.5) {\n};
                                        %\node [rotate=-30]at (\x+0.5, \y, \n-1.4) {\n};
                                \fi
                        }
                }
        \end{tikzpicture}
%\node [rotate around x=\@cube@rotate@around@x, rotate around y=\@cube@rotate@around@y, rotate around z=\@cube@rotate@around@z] at (\x+0.5, \y, \n-1.0) {\n};
}
%-----------------------------------------------------------------------------------------------------------------------------------------%
%%-----------------------------------------------------------------------------------------------------------------------------------------%
\newkeycommand\cubestack%
[sidelengths=\@default@cube@sidelengths, primary colors=\@default@cube@colors, secondary colors=\@default@cube@colors, rotatexyz=\@default@cube@rotate@around@xyz][1]
{%
        \edef\@rotatexyz{\commandkey{rotatexyz}}%
        \edef\@cube@sidelengths{\commandkey{sidelengths}}%
        \edef\@primary@colors{\commandkey{primary colors}}%
        \edef\@secondary@colors{\commandkey{secondary colors}}%
        %\xp@cmd\@set@cube@sidelengths(\commandkey{sidelengths})
        %\xp@cmd\@set@cube@colors(\commandkey{primary colors})
        %\xp@cmd\@set@cube@rotate@around@xyz(\commandkey{rotatexyz})
        %\ifcommandkey{secondary colors}{\xp@cmd\@set@cube@bicolors(\commandkey{secondary colors})}{}%
        %\expandafter\@set@cube@rotate@around@xyz\expandafter(\expandafter\fullyexpand\expandafter{\commandkey{rotatexyz}})%
        \expandafter\@set@cube@rotate@around@xyz\expandafter(\@rotatexyz)%
        \expandafter\@set@cube@sidelengths\expandafter(\@cube@sidelengths)%
        \expandafter\@set@cube@colors\expandafter(\@primary@colors)%
        \ifcommandkey{secondary colors}{\expandafter\@set@cube@bicolors\expandafter(\@secondary@colors)}{}
        %\blockstructure{#1}
}
%-----------------------------------------------------------------------------------------------------------------------------------------%
\DeclareDocumentCommand{\@top@cube@face}{m m m m}
{%
        %\node [rotate=0.9]at (\x+0.5, \y, \n-1.4) {\n};
        \draw [fill=\@top@face@color,draw=\@edge@color] (#1,#2,#3) -- (#1+1,#2,#3) -- (#1+1, #2+1, #3) -- (#1, #2+1, #3) -- cycle;
        %\node [rotate=0] at (#1+0.5, #2, #4-1.0) {#4};
        %\node [rotate around x=0, rotate around y=0, rotate around z=0]at (\x+0.5, \y, \n-1.0) {\n};
        %\node [rotate=0.9]at (#1+0.5, #2+0.5, #4) {#4};
}
%-----------------------------------------------------------------------------------------------------------------------------------------%
\DeclareDocumentCommand{\@bottom@cube@face}{m m m m}
{%
      \draw [fill=\@bottom@face@color,draw=\@edge@color] (#1,#2,#3-1) -- (#1+1,#2,#3-1) -- (#1+1, #2+1, #3-1) -- (#1, #2+1, #3-1) -- cycle;
}
%-----------------------------------------------------------------------------------------------------------------------------------------%
\DeclareDocumentCommand{\@front@cube@face}{m m m m}
{%
        \draw [fill=\@front@face@color, draw=\@edge@color] (#1+1,#2,#3) -- (#1+1,#2+1,#3) -- (#1+1, #2+1, #3-1) -- (#1+1, #2, #3-1) -- cycle;
        %\node [rotate=-0]at (#1+0.5, #2, #4-1.4) {#4};
}
%-----------------------------------------------------------------------------------------------------------------------------------------%
\DeclareDocumentCommand{\@back@cube@face}{m m m m}
{%
        \draw [fill=\@back@face@color, draw=\@edge@color] (#1,#2,#3) -- (#1,#2+1,#3) -- (#1, #2+1, #3-1) -- (#1, #2, #3-1) -- cycle;
        %\node [rotate=0]at (#1-0.4, #2, #4-2.1) {#4};
}
%-----------------------------------------------------------------------------------------------------------------------------------------%
\DeclareDocumentCommand{\@right@cube@face}{m m m m}
{%
        \draw [fill=\@right@face@color,draw=\@edge@color] (#1,#2+1,#3) -- (#1+1,#2+1,#3) -- (#1+1, #2+1, #3-1) -- (#1, #2+1, #3-1) -- cycle;
        %\node [rotate=-0]at (#1+0.5, #2, #4-1.4) {#4};
}
%-----------------------------------------------------------------------------------------------------------------------------------------%
\DeclareDocumentCommand{\@left@cube@face}{m m m m}
{%
        \draw [fill=\@left@face@color,draw=\@edge@color] (#1,#2,#3) -- (#1+1,#2,#3) -- (#1+1, #2, #3-1) -- (#1, #2, #3-1) -- cycle;
        %\node [rotate=0]at (#1-0.4, #2, #4-2.1) {#4};
}
%-----------------------------------------------------------------------------------------------------------------------------------------%
%*****************************************************************************************************************************************%
%*************************************************** End of 'my-graphics.sty' package ****************************************************%
%*****************************************************************************************************************************************%
%-----------------------------------------------------------------------------------------------------------------------------------------%
\endinput
%\newkeycommand\cubestack%
%[sidelengths=\@default@cube@sidelengths, primary colors=\@default@cube@colors, secondary colors=\@default@cube@colors, rotatexyz=\@default@cube@rotate@around@xyz, scale=\@default@cube@scale][1]
%{%
%        \xdef\@cube@sidelengths{\commandkey{sidelengths}}%
%        \xdef\@cube@scale{\commandkey{scale}}%
%        \gdef\@rotatexyz{\commandkey{rotatexyz}}%
%        \xdef\@primary@colors{\commandkey{primary colors}}%
%        \xdef\@secondary@colors{\commandkey{secondary colors}}%
%        %\xp@cmd\@set@cube@sidelengths(\commandkey{sidelengths})
%        %\xp@cmd\@set@cube@colors(\commandkey{primary colors})
%        %\xp@cmd\@set@cube@rotate@around@xyz(\commandkey{rotatexyz})
%        %\ifcommandkey{secondary colors}{\xp@cmd\@set@cube@bicolors(\commandkey{secondary colors})}{}%
%        %\expandafter\@set@cube@rotate@around@xyz\expandafter(\expandafter\fullyexpand\expandafter{\commandkey{rotatexyz}})%
%        %\expandafter\@set@cube@rotate@around@xyz\expandafter(\@rotatexyz)%
%        %\expandafter\@set@cube@sidelengths\expandafter(\@cube@sidelengths)%
%        %\expandafter\@set@cube@colors\expandafter(\@primary@colors)%
%        %\ifcommandkey{secondary colors}{\expandafter\@set@cube@bicolors\expandafter(\@secondary@colors)}{}
%        \blockstructure{#1}
%        %\blockstructure<\@cube@scale>(\@rotatexyz)[\@cube@sidelengths]{#1}[\@primary@colors]|\@secondary@colors|
%}
%-----------------------------------------------------------------------------------------------------------------------------------------%
%\pgfmathparse{ifthenelse(\@macro@width>= \linewidth, 1, 0)}%
%                                \if\pgfmathresult 1\relax%
%                                        \vspace{-12.5mm}%
%                                        \doublespacing%
%                                        \shadowtext{\parbox{\textwidth}{\raggedright#3{#4}}}%
%                                        \vspace{1mm}%
%                                \else%
%                                        \vspace{-6mm}%
%                                        \shadowtext{\raggedright#3{#4}}%
%                                        \vspace{-4mm}%
%                                \fi%
