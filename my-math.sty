%*******************************************************************************************************************************%
%******************************************************* `my-math.sty' *********************************************************%
%*******************************************************************************************************************************%
% Defines additional math symbols, (paired) delimiters, and operators and provides macros/commands/environments for typesetting of math expressions and other math related content.
%*******************************************************************************************************************************%
%********************************** Define provided package name and LaTeX/package dependencies ********************************%
%*******************************************************************************************************************************%
\NeedsTeXFormat{LaTeX2e}[2005/12/01]
\ProvidesPackage{my-math}
%*******************************************************************************************************************************%
%************************************* Package options and corresponding Boolean variables *************************************%
%*******************************************************************************************************************************%
%-------------------------------------------------------------------------------------------------------------------------------%
\DeclareOption*{\PackageWarning{my-math}{Unknown \CurrentOption}}
%*******************************************************************************************************************************%
%************************************************ Processing of package options ************************************************%
%*******************************************************************************************************************************%
%-------------------------------------------------------------------------------------------------------------------------------%
\ProcessOptions\relax
%-------------------------------------------------------------------------------------------------------------------------------%
\makeatletter                                   % Change @ -> catcode'@=11 (letter) for use in macro names/definition
\mathon                                 % Change '|' to active character to support |...| shortcut for $\boldsymbol{...}$
%*******************************************************************************************************************************%
%******************************************************** Package Body *********************************************************%
%*******************************************************************************************************************************%
%~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~%
%~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ Define Math Operators ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~%
%~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~%
%-------------------------------------------------------------------------------------------------------------------------------%
%-------------------------------------------------------------------------------------------------------------------------------%
\def\@math@super@script#1{\kern-2.0pt\raisemath{1pt}{\@ss@style\mathsf{\mathop{#1}}}}
\def\@default@differential@var{x}
\def\@differential@var{\@default@differential@var}
\def\g@differential@var{\@default@differential@var}
\def\l@@differential@var{\@default@differential@var}
\def\thisstyle#1%
{%
        \begingroup%
        \mathcase%
                {\let\savedstyle\displaystyle}%
                {\let\savedstyle\textstyle}%
                {\let\savedstyle\scriptstyle}%
                {\let\savedstyle\scriptscriptstyle}%
                #1%
        \endgroup%
}
%\def\d#1{\kern1pt d#1}
%\def\myastb{\myast}
%\def\mymath#1ยง{$\boldsymbol{#1}$}
\def|#1|{\bmath{#1}}
%\gdef\mathdollar$#1${\[\boldsymbol{#1}\]}
%\let\mathexclam=!
%\def!#1!{hello}
%\gdef$#1${\[\mathbf{#1}\]}
%-------------------------------------------------------------------------------------------------------------------------------%
\gdef\lnodelim{.}
\gdef\rnodelim{.}
\def\@longdiv@rparen@kern{-0.425pt}
\def\@longdiv@vert@kern{-0.425pt}
\def\@delimiter@surrounding#1{\kern1pt#1\kern1pt}
\def\@numset@surrounding#1{\kern-1.0pt#1\kern-1.0pt}
%-------------------------------------------------------------------------------------------------------------------------------%
\gdef\newlinecounts{}%
\gdef\ampersandcounts{}%
\gdef\newlinemacro{\\}%
\gdef\ampersandmacro{&}%
%-------------------------------------------------------------------------------------------------------------------------------%
\newlength\@pld@tcb@width
\newlength\@pld@tcb@leftrightskip
\newlength\@pld@tcb@extrude@right
\newlength\@top@binom@height                                                            % Height of 'n' in "n choose k" environment \nchoosek
\newlength\@bottom@binom@height                                                         % Height of 'k' in "n choose k" environment \nchoosek
\newlength\@height@of@x\settoheight\@height@of@x{$\displaystyle X$}                     % Height of math character 'X' in current font
\newlength\@height@math@symbols\settoheight{\@height@math@symbols}{$\displaystyle X$}
\newlength\@height@math@comma\settoheight{\@height@math@comma}{$\displaystyle ,$}
\newlength\@paren@height\settoheight\@paren@height{$\displaystyle \rparen$}             % Height of math character 'X' in current font
\newlength\@k@height\settoheight\@k@height{$\displaystyle k$}                           % Height of math character 'X' in current font
\newlength\@vert@height\settoheight\@vert@height{$\displaystyle \vert$}                 % Height of math character 'X' in current font
\newlength\@total@heght                                                                 % Height of 'n' in "n choose k" environment \nchoosek
\newlength\@dbl@verted@shift                                                            % Height of 'n' in "n choose k" environment \nchoosek
%-------------------------------------------------------------------------------------------------------------------------------%
\newcount\gpten                                                                         % (global) power-of-ten -- tells which digit we are doing
\countdef\rtot2                                                                         % running total -- remainder so far
\countdef\LDscratch4                                                                    % scratch
\newcounter{@current@IBP@row@counter}
\@init@counter{@IBP@instances@counter}                                                  % Counter indicating # of rows added to IBP environment
\@init@counter{@IBP@rows@counter}[0]                                                    % Counter indicating # of rows added to IBP environment
\@init@counter{@IBP@nodes@counter}[1]                                                   % Node # of left column in IBP environment
\@init@counter{@left@IBP@nodes@counter}                                                 % Node # of left column in IBP environment
\@init@counter{@right@IBP@nodes@counter}[2]                                             % Node # of right column in IBP environment
%-------------------------------------------------------------------------------------------------------------------------------%
\newtoggle{@add@sub@TF}
\let\@ss@style=\scriptscriptstyle
%*******************************************************************************************************************************%
%*************************************************** Declare/Define Math Operators *********************************************%
%*******************************************************************************************************************************%
%-------------------------------------------------------------------------------------------------------------------------------%
% Define math symbols
\DeclareMathOperator{\exponentialSym}{\mathit{e}}                                       % exponential function, exp(x): \e{<arg>}
\DeclareMathOperator{\inss}{\raisemath{0.75pt}{\scriptstyle\in}}                        % scriptstyle set membership suymbol \in
\DeclareMathOperator{\ihat}{\boldsymbol{\hat{\textbf{\i}}}}                             % Directional vector for 1st dimension e1 (i.e. x-axis)
\DeclareMathOperator{\jhat}{\boldsymbol{\hat{\textbf{\j}}}}                             % Directional vector for 1st dimension e1 (i.e. y-axis)
\DeclareMathOperator{\khat}{\,\,\raisebox{2.5pt}{$\boldsymbol{\hat{\!\!}}$}\textbf{k}}  % Directional vector for 1st dimension e1 (i.e. z-axis)
\ifundef{\degrees}{\DeclareMathOperator{\degrees}{\si{\degree} \mathsf{F}}}{}                                 % Degrees symbol
\DeclareMathOperator{\dB}{\mathrm{dB}}                                                  % decibels, dB
\DeclareMathOperator{\degF}{\si{\degree} \mathsf{F}}                                    % Degrees Fahrenheit
\DeclareMathOperator{\convolutionSym}{\ast}                                             % Convolution symbol
\DeclareMathOperator{\correlationSym}{\star}                                            % Correlation symbol
\DeclareMathOperator{\hence}{\raisebox{-1.5pt}{\hstretch{1.25}{\scaleobj{1.5}{\Rightarrow}}}\;\;}
%-------------------------------------------------------------------------------------------------------------------------------%
\DeclareMathOperator{\superscriptPlus}{\raisebox{0.55pt}{\scaleobj{0.55}{\boldsymbol{+}}}}
\DeclareMathOperator{\superscriptMinus}{\raisebox{-1.25pt}{\hstretch{0.55}{\boldsymbol{--}}}}
\DeclareMathOperator{\negSign}{\scriptstyle-\kern-2.0pt}                                % negative sign
\DeclareMathOperator{\inverseSym}{\negSign\scriptscriptstyle 1}
\DeclareMathOperator{\eqdefas}{\overset{\underset{\mathsfs{def}}{}}{=}}                 % "defined as" symbol written w/ 'def' above equal sign
\DeclareMathOperator{\setor}{\mathop{\lvert}}
\DeclareMathOperator{\rectSym}{\sqcap}                                                  % Rectangular function symbol
\DeclareMathOperator{\triSym}{\wedge}                                                   % Rectangular function symbol
\DeclareMathOperator{\combSym}{\mathrmst{III}}                                           % Rectangular function symbol
\DeclareMathOperator{\meanSym}{\mu}                                                     % exponential function, exp(x): \e{<arg>}
\DeclareMathOperator{\meanSymUp}{\muup}                                                 % exponential function, exp(x): \e{<arg>}
\DeclareMathOperator{\stddevSym}{\sigma}                                                % exponential function, exp(x): \e{<arg>}
\DeclareMathOperator{\stddevSymUp}{\sigmaup}                                            % exponential function, exp(x): \e{<arg>}
\DeclareMathOperator{\identity}{\mathord{\mathalpha{\mathbbm{I}}}}                      % Identity matrix symbol
\DeclareMathOperator{\indicator}{\mathbbs{1}\kern\z@}                                   % Indicator function symbol
%-------------------------------------------------------------------------------------------------------------------------------%
% Sets and spaces
\DeclareMathOperator{\AlgnumSet}{\numset{A}}                                            % Set of Algebraic #s
\DeclareMathOperator{\NaturalSet}{\numset{N}}                                           % Set of natural #s
\DeclareMathOperator{\PosNaturalSet}{\numset{N}[\kern-0.5pt\superscriptPlus]}           % Set of positive natural #s
\DeclareMathOperator{\NegNaturalSet}{\numset{N}[\superscriptMinus]}                     % Set of negative natural #s
\DeclareMathOperator{\IntegerSet}{\numset{Z}}                                           % Set of integer #s
\DeclareMathOperator{\PosIntegerSet}{\numset{Z}[\kern-0.5pt\superscriptPlus]}           % Set of positive integer #s
\DeclareMathOperator{\NegIntegerSet}{\numset{Z}[\superscriptMinus]}                     % Set of negative integer #s
\DeclareMathOperator{\ModIntegerSet}{\numset{Z}_{\scriptstyle\kern-0.5pt\mathrm{n}}}    % Set of integer #s (mod) n, i.e., {[0], [1], [2], ...}
\DeclareMathOperator{\ComplexSet}{\numset{C}}                                           % Set of rational #s
\DeclareMathOperator{\RealSet}{\numset{R}}                                              % Set of Real #s
\DeclareMathOperator{\PosRealSet}{\numset{R}[\kern-0.5pt\superscriptPlus]}              % Set of positive Real #s
\DeclareMathOperator{\NegRealSet}{\numset{R}[\superscriptMinus]}                        % Set of negative Real #s
\DeclareMathOperator{\RationalSet}{\numset{Q}}                                          % Set of Rational #s
\DeclareMathOperator{\PosRationalSet}{\numset{Q}[\kern-0.5pt\superscriptPlus]}          % Set of positive Rational #s
\DeclareMathOperator{\NegRationalSet}{\numset{Q}[\superscriptMinus]}                    % Set of negative Rational #s
\DeclareMathOperator{\PowerSet}{\@numset@surrounding{\wp}}                              % Set of all S subsets, including empty/S; Weirstrass
\DeclareMathOperator{\AlphabetSet}{\@numset@surrounding{\bbSigma}}                      % Alphabet used to construct (formal) language words
%-------------------------------------------------------------------------------------------------------------------------------%
% Sets and spaces
\DeclareMathOperator{\Algnums}{\numset{A}}                                              % Set of Algebraic #s
\DeclareMathOperator{\Naturals}{\numset{N}}                                             % Set of natural #s
\DeclareMathOperator{\PosNaturals}{\numset{N}[\kern-0.5pt\superscriptPlus]}             % Set of positive natural #s
\DeclareMathOperator{\NegNaturals}{\numset{N}[\superscriptMinus]}                       % Set of negative natural #s
\DeclareMathOperator{\Integers}{\mathord{\numset{Z}}}                                   % Set of integer #s
\DeclareMathOperator{\PosIntegers}{\mathord{\numset{Z}[\kern-0.5pt\superscriptPlus]}}   % Set of positive integer #s
\DeclareMathOperator{\NegIntegers}{\mathord{\numset{Z}[\superscriptMinus]}}             % Set of negative integer #s
\DeclareMathOperator{\ModIntegers}{\mathord{\numset*{Z}[\scriptstyle\kern-0.5pt\mathrm{n}]}}% Set of integer #s (mod) n: {[0],[1],[2], ...}
\DeclareMathOperator{\Complexs}{\mathord{\numset{C}}}                                   % Set of rational #s
\DeclareMathOperator{\Reals}{\mathord{\numset{R}}}                                      % Set of Real #s
\DeclareMathOperator{\PosReals}{\mathord{\numset{R}[\kern-0.5pt\superscriptPlus]}}      % Set of positive Real #s
\DeclareMathOperator{\NegReals}{\mathord{\numset{R}[\superscriptMinus]}}                % Set of negative Real #s
\DeclareMathOperator{\Rationals}{\mathord{\numset{Q}}}                                  % Set of Rational #s
\DeclareMathOperator{\PosRationals}{\mathord{\numset{Q}[\kern-0.5pt\superscriptPlus]}}  % Set of positive Rational #s
\DeclareMathOperator{\NegRationals}{\mathord{\numset{Q}[\superscriptMinus]}}            % Set of negative Rational #s
\DeclareMathOperator{\Alphabet}{\mathord{\bbSigma}}                                     % Alphabet used to construct (formal) language words
\DeclareMathOperator{\Language}                                                         % (Formal) Language, built from alphabet (Sigma)
{%
        \mathord{\numset{\bbSigma}[\kern1.25pt\@math@super@script{\ast}]}%
}
\DeclareMathOperator{\ProjSpace}{\mathord{\numset{P}}}                                  % Projective space
\DeclareMathOperator{\Quaternions}{{\mathbb{H}}}                                        % Quaternions
%-------------------------------------------------------------------------------------------------------------------------------%
% Define math operators given as text
\DeclareMathOperator{\exponentialText}{exp}                                             % exponential function written as text symbol: exp(x)
\DeclareMathOperator{\trText}{Tr}                                                       % The 'trace' of a matrix
\DeclareMathOperator{\varText}{var}                                                     % 'Variance' of random variable/vector written "var A"
\DeclareMathOperator{\detText}{det}                                                     % 'Determinant' of a matrix written as "det A"
\DeclareMathOperator{\supText}{sup}                                                     % 'Determinant' of a matrix written as "det A"
\DeclareMathOperator{\infText}{inf}                                                     % 'Determinant' of a matrix written as "det A"
\DeclareMathOperator{\erfText}{erf}                                                     % 'Error function' written as "erf(x)"
\DeclareMathOperator{\erfiText}{erfi}                                                   % 'Imaginary error function' written as "erf(x)"
\DeclareMathOperator{\rectText}{rect}                                                   % Rectangular function text symbol
\DeclareMathOperator{\sincText}{sinc}                                                   % Sinc function text symbol
\DeclareMathOperator{\jincText}{jinc}                                                   % Jinc function text symbol
\DeclareMathOperator{\signumText}{signum}                                               % Signum function text symbol
\DeclareMathOperator{\signText}{sign}                                                   % Sign function text symbol
\DeclareMathOperator{\sgnText}{sgn}                                                     % Alternative sign function text symbol
\DeclareMathOperator{\lcmText}{lcm}                                                     % Lowest common multiple (LCM)
\DeclareMathOperator{\lcdText}{lcd}                                                     % Lowest common denominator (LCD)
%-------------------------------------------------------------------------------------------------------------------------------%
% Forward/Inverse linear transformation operators
\DeclareMathOperator{\Fourier}{\mathbick{F}}                                            % Fourier transform symbol
\DeclareMathOperator{\DFourier}{\Fourier\@ss@style\kern-4pt_D}                          % Discrete Fourier transform symbol
\DeclareMathOperator{\DTFourier}{\Fourier\@ss@style\kern-4pt_{DT}}                      % Discrete Time Fourier transform symbol
\DeclareMathOperator{\FourierSlant}{\mathrsfso{F}}                                      % Alternative Fourier transform symbol
\DeclareMathOperator{\FTpairSym}{\overset{\Fourier}{\longleftrightarrow}}               % Fourier transform pair symbol
\DeclareMathOperator{\Laplace}{\mathbick{L}}                                            % Laplace transform symbol
\DeclareMathOperator{\LaplaceSlant}{\mathrsfso{L}}                                      % Alternative Laplace transform symbol
\DeclareMathOperator{\Radon}{\mathbick{R}}                                              % Radon transform symbol
\DeclareMathOperator{\ZTsym}{\mathcalst{Z}}                                             % z-transform symbol
\DeclareMathOperator{\ZTpair}{\;\;\overset{\ZTsym}{\longleftrightarrow}\;\;}            % z-transform pair symbol
%-------------------------------------------------------------------------------------------------------------------------------%
\DeclareMathOperator{\iFourier}{\Fourier^{-1}}                                          % Inverse Fourier transform symbol
\DeclareMathOperator{\iLaplace}{\Laplace^{-1}}                                          % Inverse Laplace transform symbol
\DeclareMathOperator{\iDFourier}{\DFourier^{-1}}                                        % Inverse Discrete Fourier transform symbol
\DeclareMathOperator{\iDTFourier}{\DTFourier^{-1}}                                      % Inverse Discrete Time Fourier transform symbol
\DeclareMathOperator{\iRadon}{\Radon^{-1}}                                              % Inverse Radon transform symbol
\DeclareMathOperator{\iZTsym}{\ZTsym^{-1}}                                              % Inverse z-transform pair symbol
%-------------------------------------------------------------------------------------------------------------------------------%
\DeclareMathOperator{\tDFourier}{\mathsfst{DFT}}                                        % Text Symbol for Discrete Fourier transform
\DeclareMathOperator{\tDTFourier}{\mathsfst{DTFT}}                                      % Text Symbol for Discrete Time Fourier transform
\DeclareMathOperator{\tiDFourier}{\tDFourier^{-1}}                                      % Text Symbol for Inverse Discrete Fourier transform
\DeclareMathOperator{\tiDTFourier}{\tDTFourier^{-1}}                                    % Text Symbol for Inverse Discrete Time Fourier transform
%*******************************************************************************************************************************%
%**************************************************** Define Delimeter Commands ************************************************%
%*******************************************************************************************************************************%
%-------------------------------------------------------------------------------------------------------------------------------%
\DeclarePairedDelimiterX\nodelim[1]{.}{.}{\mathord{#1}}                                 % No delimiters, passed to macros expecting delimiters
\DeclarePairedDelimiterX\parenthesized[1]{\lparen}{\rparen}{\mathord{#1}\mathopen{}}    % Enclose argument in parentheses
\DeclarePairedDelimiterX\bracketed[1]{\lbrack}{\rbrack}{\mathop{#1}\mathopen{}}         % Enclose argument in square brackets
\DeclarePairedDelimiterX\braced[1]{\lbrace}{\rbrace}{\mathop{#1}\mathopen{}}            % Enclose argument in curly braces
\DeclarePairedDelimiterX\verted[1]{\lvert}{\rvert}{\mathop{#1}\mathopen{}}              % Enclose argument in vertical bars
\DeclarePairedDelimiterX\angled[1]{\langle}{\rangle}{\mathop{{#1}}\mathopen{}}          % Enclose argument in angle brackets
\DeclarePairedDelimiterX\Bra[1]{\langle}{\rvert}{\@delimiter@surrounding{\mathop{#1}}}  % 'Bra'' indicating (typically prior) quantum mechanical state
\DeclarePairedDelimiterX\Ket[1]{\lvert}{\rangle}{\,\mathop{#1}\,}                       % 'Ket'' indicating (typically next) quantum mechanical state
\DeclarePairedDelimiterX\BraKet[2]{\langle}{\rangle}{#1\,\delimsize\vert\,\mathopen{}#2\,}      % A mplitude (inner product) between 2 quantum mechanical 2 states
%-------------------------------------------------------------------------------------------------------------------------------%
\reDeclarePairedDelimiterInnerWrapper\nodelim{star}{\mathinner{#1\mathord{#2}#3}}       % Automatically scale parentheses to match argument
\reDeclarePairedDelimiterInnerWrapper\parenthesized{star}{\mathinner{#1\mathord{#2}#3}} % Automatically scale parentheses to match argument
\reDeclarePairedDelimiterInnerWrapper\bracketed{star}{\mathinner{#1#2#3}}               % Automatically scale square brackets to match argument
\reDeclarePairedDelimiterInnerWrapper\braced{star}{\mathinner{#1#2#3}}                  % Automatically scale curly braces to match argument
\reDeclarePairedDelimiterInnerWrapper\verted{star}{\mathinner{#1#2#3}}                  % Automatically scale vertical bars to match argument
\reDeclarePairedDelimiterInnerWrapper\angled{star}{\mathinner{#1#2#3}}                  % Automatically scale angle brackets to match argument
\reDeclarePairedDelimiterInnerWrapper\Bra{star}{\mathinner{#1#2#3}}                     % Automatically scale bra to match argument
\reDeclarePairedDelimiterInnerWrapper\Ket{star}{\mathinner{#1#2#3}}                     % Automatically scale ket to match argument
\reDeclarePairedDelimiterInnerWrapper\BraKet{star}{\mathinner{#1#2#3}}                  % Automatically scale braket to match argument
%-------------------------------------------------------------------------------------------------------------------------------%
% Generate p-norm delimiters with 2 closely spaced 'vert' symbols.  Automatic delimiter scaling of the standard double vert symbol (\Vert) for large arguments
% unfortunately results in an increase in the separation between the 2 vertical bars.  Hence, the double vert is constructed from 2 individual vert symbols with
% the scaling applied to each vert bar individually and their spacing remains constant for all arguments.
\DeclarePairedDelimiterXPP{\dblverted}[1]
{%
        \settoheight\@macro@height{$\displaystyle#1$}
        \setlength{\@macro@shift}{\dimexpr\@vert@height / 4 - \@macro@height / 4 + 0.25ex\relax}
        \pgfmathsetmacro\@scale@y{\@vert@height / \@macro@height + 0.5 }
        \def\@place@norm@verts
        {%
                \raisemath
                        {-\@macro@shift}
                        {\stretchrel*{\lvert}{\vstretch{\@scale@y}{#1}}}
        }
        \@place@norm@verts
        \kern-1.2pt
}
{\@place@norm@verts}
{\@place@norm@verts}
{\kern-1.2pt\@place@norm@verts}
{#1}
%-------------------------------------------------------------------------------------------------------------------------------%
\DeclareDocumentCommand{\set@lr@delimiters}{m d<>}%
{%
        \IfStrEqCase{#1}%
        {%
                {b}{\gdef\@delim@op@suffix{brack}}%
                {brack}{\gdef\@delim@op@suffix{brack}}%
                {bracketed}{\gdef\@delim@op@suffix{brack}}%
                {n}{\gdef\@delim@op@suffix{nodelim}}%
                {nodelim}{\gdef\@delim@op@suffix{nodelim}}%
                {none}{\gdef\@delim@op@suffix{nodelim}}%
                {p}{\gdef\@delim@op@suffix{paren}}%
                {paren}{\gdef\@delim@op@suffix{paren}}%
                {parenthesized}{\gdef\@delim@op@suffix{paren}}%
                {v}{\gdef\@delim@op@suffix{vert}}%
                {vert}{\gdef\@delim@op@suffix{vert}}%
                {verted}{\gdef\@delim@op@suffix{vert}}%
        }[\gdef\@delim@op@suffix{brack}]%
        \IfValueTF{#2}%
        {\@parse@split@csv@args{xdef}<the@ldelim,the@rdelim>=<#2>}%
        {%
                \gdef\the@ldelim{\csuse{l\@delim@op@suffix}}%
                \gdef\the@rdelim{\csuse{r\@delim@op@suffix}}%
        }%
}
%*******************************************************************************************************************************%
%************************ Definition of various set/symbol, operator, vector/matrix, etc. commands *****************************%
%*******************************************************************************************************************************%
%-------------------------------------------------------------------------------------------------------------------------------%
\newcommand{\raisem@th}[3]{\raisebox{#1}{$#2#3$}}                                       % Raises argument #2 by distance #1 with appropriate style (#2)
\newcommand{\raisemath}[1]{\mathpalette{\raisem@th{#1}}}                                % Wrapper for \raisem@th
%\newcommand{\bmath}[1]{$\boldsymbol{#1}$}                                              % Insertion of bold math symbol/expression inside text mode
\newcommand{\bmath}[1]{\ensuremath{\boldsymbol{#1}}}                                    % Insertion of bold math \newcommand{\abs}[1]{\verted*{#1}}                                                                             % Absolute value operator
\newcommand{\timeavg}[1]{\angled*{#1}}                                                  % Time average of random variable
\newcommand{\xoutto}[2]{\cancelto{\scriptstyle #1}{#2}}                                 % Diagonal strikethrough cancelling of terms to value (e.g. 0/1)
\newcommand{\identitymn}[2]{\identity^{\@ss@style#1\times#2}}                           % Identity matrix with dimensions included
\newcommand{\ink}[1]{\in^{#1}}                                                          % k-th order set membership symbol
\newcommand{\notink}[1]{\ni^{#1}\notin^{#1}}                                            % NOT IN k-th order set membership symbol
\newcommand{\setdef}[2]{\left\{\,#1\setor #2\,\right\}}                                 % Defines set { #1 | #2 }
\newcommand{\setmaxwd}[1]{\eqmakebox[BM-\theBMatrix][\BMalign]{$#1$}}                   % Query and set array/table column width to max argument
\newcommand\inline@dfrac[2]{\frac{\displaystyle#1}{\displaystyle#2}}
%-------------------------------------------------------------------------------------------------------------------------------%
\DeclareDocumentCommand{\query@num@newlines}{O{\newlinecounts} m}
{%
        \expandarg%
        \StrCount{#2}{\newlinemacro}[#1]%
}%
%-------------------------------------------------------------------------------------------------------------------------------%
\DeclareDocumentCommand{\query@num@ampersands}{O{\ampersandcounts} m}
{%
        \expandarg%
        \StrCount{#2}{\ampersandmacro}[#1]%
}%
%-------------------------------------------------------------------------------------------------------------------------------%
\DeclareDocumentCommand{\query@array@dims}{s m m}
{%
        \query@num@newlines{#3}%
        \query@num@ampersands{#3}%
        \IfSubBooleanTF{#2}%
        {%
                \setcounter{array@row@count}{\newlinecounts}%
                \setcounter{array@column@count}{\ampersandcounts / \newlinecounts + 1}%
        }%
        {%
                \setcounter{array@row@count}{\newlinecounts + 1}%
                \setcounter{array@column@count}{\ampersandcounts / \value{array@row@count} + 1}%
        }%
        \IfBooleanTF{#1}%
        {%
                Number of newline tokens (looking ahead): \newlinecounts\\%
                Number of table ampersands (looking ahead): \ampersandcounts\\%
                Number of desired table rows (looking ahead): \arabic{array@row@count}\\%
                Number of desired table columns (looking ahead): \arabic{array@column@count}\\%
        }{}%
}
%-------------------------------------------------------------------------------------------------------------------------------%
%-------------------------------------------------------------------------------------------------------------------------------%
%-------------------------------------------------------------------------------------------------------------------------------%
\DeclareDocumentCommand\@differential@op{s G{x} O{1}}%
{%
        \ifnumequal{#3}{1}%
                {\def\@diff@suffix{}}%
                {\def\@diff@suffix{\raisebox{4pt}{$\scriptscriptstyle#3$}}}%
        \IfBooleanTF{#1}%
                {\kern1pt\mathord{\delta#2\@diff@suffix}}%
                {\kern1pt\mathord{d#2\@diff@suffix}}%
}
%-------------------------------------------------------------------------------------------------------------------------------%
\DeclareDocumentCommand\@derivative@op{s m}%
{%
        \IfBooleanTF{#1}
        {\mathord{\partial\raisebox{4pt}{$\scriptscriptstyle#2$}}}%
        {\mathord{d\raisebox{4pt}{$\scriptscriptstyle#2$}}}%
}
%-------------------------------------------------------------------------------------------------------------------------------%
\DeclareDocumentCommand{\deriv}{s t! m m m}
{%
        \IfBooleanTF{#2}%
                {\let\@current@fraction@operator=\inline@dfrac}%
                {\let\@current@fraction@operator=\dfrac}%
        \IfBooleanTF{#1}%
        {%
                \@current@fraction@operator%
                {\@derivative@op*{#3}{#4}}%
                {\@derivative@op*{#3}{#5}}%
        }%
        {%
                \@current@fraction@operator%
                {\@derivative@op{#3}{#4}}%
                {\@derivative@op{#3}{#5}}%
        }%
}
%-------------------------------------------------------------------------------------------------------------------------------%
%Define default, bold, hat, and wide hat vectors
\newcommand{\matx}[1]{\mathord{\mathbf{#1}}}
\newcommand{\bmatx}[1]{\boldsymbol{\matx{#1}}}
%-------------------------------------------------------------------------------------------------------------------------------%
% Place symbols above/below arrows
\newcommand{\overrarrow}[1]{{\buildrel{#1}\over\longrightarrow\;}}
\newcommand{\overlarrow}[1]{{\buildrel{#1}\over\longleftarrow\;}}
\newcommand{\overdarrow}[1]{{\buildrel{#1}\over\longleftrightarrow\;}}
\newcommand{\underrarrow}[1]{{\buildrel{#1}\under\longrightarrow\;}}
\newcommand{\underlarrow}[1]{{\buildrel{#1}\under\longleftarrow\;}}
\newcommand{\underdarrow}[1]{{\buildrel{#1}\under\longleftrightarrow\;}}
%-------------------------------------------------------------------------------------------------------------------------------%
% Adjust the size of the dot on dot/ddot/dddot/ddddot commands, particularly for use with matrices
\newcommand\dotmtx[2]{\savebox{\@macro@savebox}{$\FPeval{\result}{1/#1}\scaleobj{\result}{#2}$}\scaleobj{#1}{\dot{\raisebox{0pt}[\ht\@macro@savebox]{$\FPeval{\result}{1/#1}\scaleobj{\result}{#2}$}}}}
\newcommand\ddotmtx[2]{\savebox{\@macro@savebox}{$\FPeval{\result}{1/#1}\scaleobj{\result}{#2}$}\scaleobj{#1}{\ddot{\raisebox{0pt}[\ht\@macro@savebox]{$\FPeval{\result}{1/#1}\scaleobj{\result}{#2}$}}}}
\newcommand\dddotmtx[2]{\savebox{\@macro@savebox}{$\FPeval{\result}{1/#1}\scaleobj{\result}{#2}$}\scaleobj{#1}{\dddot{\raisebox{0pt}[\ht\@macro@savebox]{$\FPeval{\result}{1/#1}\scaleobj{\result}{#2}$}}}}
\newcommand\ddddotmtx[2]{\savebox{\@macro@savebox}{$\FPeval{\result}{1/#1}\scaleobj{\result}{#2}$}\scaleobj{#1}{\ddddot{\raisebox{0pt}[\ht\@macro@savebox]{$\FPeval{\result}{1/#1}\scaleobj{\result}{#2}$}}}}
%-------------------------------------------------------------------------------------------------------------------------------%
% Fix dot placement and raised argument issues with dddot, ddddot, ...
\renewcommand{\dddot}[1]{{\mathop{\kern\z@#1}\limits^{\vbox to-1.4\ex@{\kern-\tw@\ex@\hbox{\normalfont ...}\vss}}}}
\renewcommand{\ddddot}[1]{{\mathop{\kern\z@#1}\limits^{\vbox to-1.4\ex@{\kern-\tw@\ex@\hbox{\normalfont....}\vss}}}}
\renewcommand{\ddddot}[1]{{\mathop{\kern\z@#1}\limits^{\vbox to-1.4\ex@{\kern-\tw@\ex@\hbox{\normalfont....}\vss}}}}
\renewcommand{\ddddot}[1]{{\mathop{\kern\z@#1}\limits^{\vbox to-1.4\ex@{\kern-\tw@\ex@\hbox{\normalfont....}\vss}}}}
%-------------------------------------------------------------------------------------------------------------------------------%
\DeclareDocumentCommand{\xyplane}{s}{\IfBooleanTF{#1}{\bfmseries$\boldsymbol{xy-}$plane}{$xy-$plane}\unskip}
\DeclareDocumentCommand{\axis}{s}{\IfBooleanTF{#1}{\bfmseries\ensuremath{\boldsymbol{xy-}}\text{axis}}{\ensuremath{xy-}\text{axis}}\unskip}
\DeclareDocumentCommand{\plane}{s}{\IfBooleanTF{#1}{\bfmseries\ensuremath{\boldsymbol{xy-}}\text{plane}}{\ensuremath{xy-}\text{plane}}\unskip}
%*******************************************************************************************************************************%
%************************************************ Set/symbol/measure operators *************************************************%
%*******************************************************************************************************************************%
%-------------------------------------------------------------------------------------------------------------------------------%
\DeclareRobustCommand\checkmark{\ensuremath{\checkmarkmath}}
%-------------------------------------------------------------------------------------------------------------------------------%
%\mathord \mathop \mathbin \mathrel  \mathopen \mathclose \mathpunct
%-------------------------------------------------------------------------------------------------------------------------------%
\DeclareDocumentCommand{\numset}{s O{\mathbb} m o}
{%
        \IfBooleanTF{#4}%
                {\def\@sub@or@super{_}}%
                {\def\@sub@or@super{^}}%
        \ensuremath
        {%
                \mathord
                {%
                        \IfValueTF{#4}%
                                {#2{#3}\@sub@or@super{#4}}%
                                {#2{#3}}%
                }%
        }%
}
%-------------------------------------------------------------------------------------------------------------------------------%
\DeclareDocumentCommand{\isin}{O{\mathbb} m o}
{
        \mathop
        {%
                \IfValueTF{#3}
                        {#1{#2}^{#3}}
                        {#1{#2}}
        }
}
%-------------------------------------------------------------------------------------------------------------------------------%
\DeclareDocumentCommand{\mean}{s o m}
{
        \IfBooleanTF{#1}
                {\def\@mean@arg{\meanSymUp}}
                {\def\@mean@arg{\meanSym}}
                %{\meanSymUp_{\scriptstyle\kern-0.5pt#3}}
                %{\meanSym_{\scriptstyle\kern-0.5pt#3}}
        \IfValueTF{#2}
                {#2{\@mean@arg}_{\scriptstyle\kern-0.5pt#3}}
                {\@mean@arg_{\scriptstyle\kern-0.5pt#3}}
}
%-------------------------------------------------------------------------------------------------------------------------------%
\DeclareDocumentCommand{\variance}{s m}
{
        \IfBooleanTF{#1}
                {\stddevSym_{\scriptstyle\kern-0.5pt#2}^2}
                {\stddevSymUp_{\scriptstyle\kern-0.5pt#2}^2}
}
%-------------------------------------------------------------------------------------------------------------------------------%
\DeclareDocumentCommand{\pnorm}{m o}
{
        \mathop
        {%
                \dblverted{#1}
                \settoheight\@macro@height{$\displaystyle#1$}
                \setlength{\@macro@shift}{\dimexpr\@macro@height / 4 * 5 - \@vert@height/2 - 0.25ex\relax}
                \IfValueTF{#2}
                {%
                        _{%
                                \raisemath
                                {-\@macro@shift}
                                {\scriptscriptstyle#2}
                        }
                }{}%
        }%
}
%-------------------------------------------------------------------------------------------------------------------------------%
\DeclareDocumentCommand{\e}{s m}
{
        \IfBooleanTF{#1}
                {\exp{#2}}
                {\mathop{\exponentialSym}^{\scriptstyle#2}}
}
%-------------------------------------------------------------------------------------------------------------------------------%
\DeclareDocumentCommand{\E}{s O{\bracketed} m}
        {\mathord{\mathbbm{E}\mathopen{}#2*{#3}}}
%-------------------------------------------------------------------------------------------------------------------------------%
\DeclareDocumentCommand{\inprod}{m m}
        {\angled*{#1\@set@inprod@comma@pos{#1}{#2}{,}\,#2}}
%-------------------------------------------------------------------------------------------------------------------------------%
\DeclareDocumentCommand{\tpose}{m}
        {\matx{#1}^{\@math@super@script{T}}}
%-------------------------------------------------------------------------------------------------------------------------------%
\DeclareDocumentCommand{\Herm}{m}
        {\matx{#1}^{\@math@super@script{H}}}
%-------------------------------------------------------------------------------------------------------------------------------%
\DeclareDocumentCommand{\dagmatx}{m}
        {\matx{#1}^{\@math@super@script{\dagger}}}
%-------------------------------------------------------------------------------------------------------------------------------%
%*******************************************************************************************************************************%
%******************************************************** Function operators ***************************************************%
%*******************************************************************************************************************************%
%-------------------------------------------------------------------------------------------------------------------------------%
\DeclareDocumentCommand{\mathOp}{m m m m}
        {\ensuremath{\mathop{#1}\process@sub@super#2\mathopen{}#3*{#4}}}
%-------------------------------------------------------------------------------------------------------------------------------%
\DeclareDocumentCommand{\rect}{s e{_^} O{\parenthesized} m}
        {\mathOp{\sqcap}{#2}{#3}{#4}}
\DeclareDocumentCommand{\tri}{s e{_^} O{\parenthesized} m}
        {\mathOp{\wedge}{#2}{#3}{#4}}
\DeclareDocumentCommand{\comb}{s e{_^} O{\parenthesized} m}
        {\mathversion{stix}\mathOp{\mathrmst{III}}{#2}{#3}{#4}\mathversion{normal}}
\DeclareDocumentCommand{\pdf}{s m e{_^} O{\parenthesized} m}
        {\mathOp{\mathcal{\uppercase{#2}}}{#3}{#4}{#5}}
\DeclareDocumentCommand{\normpdf}{s e{_^} O{\parenthesized} m}
        {\mathOp{\mathcal{N}}{#2}{#3}{#4}}
%-------------------------------------------------------------------------------------------------------------------------------%
% Replacement for {n\choose k} with improved usage (does not require {...}) and improved vertical placement and separation of n/k
\DeclareDocumentCommand{\nchoosek}{m m}
{
        \settoheight\@top@binom@height{$\displaystyle #1$}
        \settoheight\@bottom@binom@height{$\displaystyle #2$}
        \def\@top@arg@diff{\dimexpr\@top@binom@height-\@height@of@x\relax}
        \def\@bottom@arg@diff{\dimexpr\@bottom@binom@height-\@height@of@x\relax}
        \def\@top@rule@skip{\dimexpr\@top@arg@diff/2 + \@bottom@arg@diff/2\relax}
        \def\@the@operand%
        {%
                \begin{array}{c}
                        #1\\[2\@top@rule@skip]
                        #2
                \end{array}%
        }
        \pgfmathsetmacro\@tot@ht{1.5 * (\@top@binom@height + \@bottom@binom@height + 2\@top@rule@skip + 2mm)}
        \raisebox
                {-\dimexpr\@bottom@binom@height - 0.7mm + (\@top@binom@height - \@bottom@binom@height)/5\relax}
                {\hstretch{2.0}{\stretchto{\lparen}{\@tot@ht pt}}}
        \kern-1.95mm\@the@operand\kern-1.95mm
        \raisebox
                {-\dimexpr\@bottom@binom@height - 0.7mm + (\@top@binom@height - \@bottom@binom@height)/5\relax}
                {\hstretch{2.0}{\stretchto{\rparen}{\@tot@ht pt}}}
}
%~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~%
%~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ Text operator w/ paired delimiter options definitions ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~%
%~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~%
%\mathop{\operator@font sin}\nolimits
%-------------------------------------------------------------------------------------------------------------------------------%
\DeclareDocumentCommand{\process@sub@super}{m m}%
{%
        \IfValueTF{#1}{_{#1}}{}%
        \IfValueTF{#2}{^{#2}}{}%
}
%-------------------------------------------------------------------------------------------------------------------------------%
\DeclareDocumentCommand{\textOp}{m m m m}
        {\ensuremath{\mathop{\operator@font#1}\nolimits\process@sub@super#2\mathopen{}#3*{#4}}}
%-------------------------------------------------------------------------------------------------------------------------------%
\DeclareDocumentCommand{\erf}{s e{_^} O{\parenthesized} m}
        {\textOp{erf}{#2}{#3}{#4}}
\DeclareDocumentCommand{\erfi}{s e{_^} O{\parenthesized} m}
        {\textOp{erfi}{#2}{#3}{#4}}
\DeclareDocumentCommand{\Tr}{s e{_^} O{\parenthesized} m}
        {\textOp{Tr}{#2}{#3}{#4}}
\DeclareDocumentCommand{\var}{s e{_^} O{\braced} m}
        {\textOp{var}{#2}{#3}{#4}}
\DeclareDocumentCommand{\det}{s e{_^} O{\parenthesized} m}
        {\textOp{det}{#2}{#3}{#4}}
\DeclareDocumentCommand{\sup}{s e{_^} O{\parenthesized} m}
        {\textOp{sup}{#2}{#3}{#4}}
\DeclareDocumentCommand{\inf}{s e{_^} O{\parenthesized} m}
        {\textOp{inf}{#2}{#3}{#4}}
%-------------------------------------------------------------------------------------------------------------------------------%
\DeclareDocumentCommand{\sin}{s e{_^} O{\parenthesized} m}
        {\textOp{sin}{#2}{#3}{#4}}
\DeclareDocumentCommand{\cos}{s e{_^} O{\parenthesized} m}
        {\textOp{cos}{#2}{#3}{#4}}
\DeclareDocumentCommand{\tan}{s e{_^} O{\parenthesized} m}
        {\textOp{tan}{#2}{#3}{#4}}
\DeclareDocumentCommand{\sec}{s e{_^} O{\parenthesized} m}
        {\textOp{sec}{#2}{#3}{#4}}
\DeclareDocumentCommand{\csc}{s e{_^} O{\parenthesized} m}
        {\textOp{csc}{#2}{#3}{#4}}
\DeclareDocumentCommand{\cot}{s e{_^} O{\parenthesized} m}
        {\textOp{cot}{#2}{#3}{#4}}
\DeclareDocumentCommand{\asin}{s e{_^} O{\parenthesized} m}
        {\textOp{asin}{#2}{#3}{#4}}
\DeclareDocumentCommand{\acos}{s e{_^} O{\parenthesized} m}
        {\textOp{acos}{#2}{#3}{#4}}
\DeclareDocumentCommand{\atan}{s e{_^} O{\parenthesized} m}
        {\textOp{atan}{#2}{#3}{#4}}
\DeclareDocumentCommand{\acot}{s e{_^} O{\parenthesized} m}
        {\textOp{acot}{#2}{#3}{#4}}
%-------------------------------------------------------------------------------------------------------------------------------%
\DeclareDocumentCommand{\sinh}{s e{_^} O{\parenthesized} m}
        {\textOp{sinh}{#2}{#3}{#4}}
\DeclareDocumentCommand{\cosh}{s e{_^} O{\parenthesized} m}
        {\textOp{cosh}{#2}{#3}{#4}}
\DeclareDocumentCommand{\tanh}{s e{_^} O{\parenthesized} m}
        {\textOp{tanh}{#2}{#3}{#4}}
\DeclareDocumentCommand{\coth}{s e{_^} O{\parenthesized} m}
        {\textOp{coth}{#2}{#3}{#4}}
\DeclareDocumentCommand{\sech}{s e{_^} O{\parenthesized} m}
        {\textOp{sech}{#2}{#3}{#4}}
\DeclareDocumentCommand{\csch}{s e{_^} O{\parenthesized} m}
        {\textOp{csch}{#2}{#3}{#4}}
%-------------------------------------------------------------------------------------------------------------------------------%
\DeclareDocumentCommand{\asinh}{s e{_^} O{\parenthesized} m}
        {\textOp{asinh}{#2}{#3}{#4}}
\DeclareDocumentCommand{\acosh}{s e{_^} O{\parenthesized} m}
        {\textOp{acosh}{#2}{#3}{#4}}
\DeclareDocumentCommand{\atanh}{s e{_^} O{\parenthesized} m}
        {\textOp{atanh}{#2}{#3}{#4}}
\DeclareDocumentCommand{\acoth}{s e{_^} O{\parenthesized} m}
        {\textOp{acoth}{#2}{#3}{#4}}
\DeclareDocumentCommand{\asech}{s e{_^} O{\parenthesized} m}
        {\textOp{asech}{#2}{#3}{#4}}
\DeclareDocumentCommand{\acsch}{s e{_^} O{\parenthesized} m}
        {\textOp{acsch}{#2}{#3}{#4}}
%-------------------------------------------------------------------------------------------------------------------------------%
\DeclareDocumentCommand{\sinc}{s e{_^} O{\parenthesized} m}
        {\textOp{sinc}{#2}{#3}{#4}}
\DeclareDocumentCommand{\jinc}{s e{_^} O{\parenthesized} m}
        {\textOp{jinc}{#2}{#3}{#4}}
\DeclareDocumentCommand{\signum}{s e{_^} O{\parenthesized} m}
        {\textOp{signum}{#2}{#3}{#4}}
\DeclareDocumentCommand{\sign}{s e{_^} O{\parenthesized} m}
        {\textOp{sign}{#2}{#3}{#4}}
\DeclareDocumentCommand{\sgn}{s e{_^} O{\parenthesized} m}
        {\textOp{sgn}{#2}{#3}{#4}}
%-------------------------------------------------------------------------------------------------------------------------------%
\DeclareDocumentCommand{\exp}{s e{_^} O{\parenthesized} m}
        {\textOp{exp}{#2}{#3}{#4}}
\DeclareDocumentCommand{\log}{s e{_^} O{\parenthesized} m}
        {\textOp{log}{#2}{#3}{#4}}
\DeclareDocumentCommand{\loga}{s e{_^} O{\parenthesized} m}
        {\textOp{log}{#2}{#3}{#4}}
\DeclareDocumentCommand{\dlog}{s E{^}{{}} O{\parenthesized} m}
        {\loga_{10}^{#2}[#3]{#4}}
\DeclareDocumentCommand{\blog}{s E{^}{{}} O{\parenthesized} m}
        {\loga_{2}^{#2}[#3]{#4}}
\DeclareDocumentCommand{\elog}{s E{^}{{}} O{\parenthesized} m}
        {\loga_{e}^{#2}[#3]{#4}}
\DeclareDocumentCommand{\ln}{s e{_^} O{\parenthesized} m}
        {\textOp{ln}{#2}{#3}{#4}}
%-------------------------------------------------------------------------------------------------------------------------------%
%~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~%
%~~~~~~~~~~~~~~~~~~~~~~~ Operator w/ overset/underset expressions & paired delimiter options definitions ~~~~~~~~~~~~~~~~~~~~~~~%
%~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~%
%-------------------------------------------------------------------------------------------------------------------------------%
\DeclareDocumentCommand{\limOp}{m m m m}
        {\ensuremath{\mathop{\operator@font#1}\displaylimits\process@sub@super#2\mathopen{}#3*{#4}}}
%-------------------------------------------------------------------------------------------------------------------------------%
\DeclareDocumentCommand{\Lim}{s e{_^} O{\parenthesized} m}
        {\limOp{lim}{#2}{#3}{#4}}
%*******************************************************************************************************************************%
%*************************************************** Transform Operator Definitions ********************************************%
%*******************************************************************************************************************************%
%-------------------------------------------------------------------------------------------------------------------------------%
\DeclareDocumentCommand{\txformOp}{s m m O{} m m}
{
        \IfBooleanTF{#1}
                {\ensuremath{\mathop{\csname #2\endcsname{#3}#4}\mathopen{}#5*{#6}}}
                {\ensuremath{\mathop{\csname #2\endcsname{#3}#4}\mathopen{}#5*{#6}}}
}
%-------------------------------------------------------------------------------------------------------------------------------%
% \<op name>[*(use alt symbol?)][<override default brace delimiters>]{<argument>}
\DeclareDocumentCommand{\ft}{s O{\braced} m}
{
        \IfBooleanTF{#1}
                {\txformOp*{mathrsfso}{F}{#2}{#3}}
                {\txformOp{mathbick}{F}{#2}{#3}}
}
\DeclareDocumentCommand{\ift}{s O{\braced} m}
{
        \IfBooleanTF{#1}
                {\txformOp*{mathrsfso}{F}[^{\kern-0.5pt\inverseSym}\kern-1.5pt]{#2}{#3}}
                {\txformOp{mathbick}{F}[^{\inverseSym}\kern-1.5pt]{#2}{#3}}
}
\DeclareDocumentCommand{\dft}{s O{\braced} m}
{
        \IfBooleanTF{#1}
                {\txformOp*{mathsfst}{DFT}{#2}{#3}}
                {\txformOp{mathbick}{F}[\kern-2.5pt_\mathsfst{D}]{#2}{#3}}
}
\DeclareDocumentCommand{\idft}{s O{\braced} m}
{
        \IfBooleanTF{#1}
                {\txformOp*{mathsfst}{DFT}[^{\kern0.5pt\inverseSym}\kern-1.5pt]{#2}{#3}}
                {\txformOp{mathbick}{F}[\kern-2.75pt_\mathsfst{D}^{\kern3pt\inverseSym}\kern-1.5pt]{#2}{#3}}
}
\DeclareDocumentCommand{\dtft}{s O{\braced} m}
{
        \IfBooleanTF{#1}
                {\txformOp*{mathsfst}{DTFT}{#2}{#3}}
                {\txformOp{mathbick}{F}[\kern-2.5pt_\mathsfst{DT}]{#2}{#3}}
}
\DeclareDocumentCommand{\idtft}{s O{\braced} m}
{
        \IfBooleanTF{#1}
                {\txformOp*{mathsfst}{DTFT}[^{\kern0.5pt\inverseSym}\kern-1.5pt]{#2}{#3}}
                {\txformOp{mathbick}{F}[\kern-2.75pt_\mathsfst{DT}^{\kern3pt\inverseSym}\kern-0.5pt]{#2}{#3}}
}
\DeclareDocumentCommand{\lt}{s O{\braced} m}
{
        \IfBooleanTF{#1}
                {\txformOp*{mathrsfso}{L}{#2}{#3}}
                {\txformOp{mathbick}{L}{#2}{#3}}
}
\DeclareDocumentCommand{\ilt}{s O{\braced} m}
{
        \IfBooleanTF{#1}
                {\txformOp*{mathrsfso}{L}[^{\kern-0.5pt\inverseSym}\kern-1.5pt]{#2}{#3}}
                {\txformOp{mathbick}{L}[^{\inverseSym}\kern-1.5pt]{#2}{#3}}
}
\DeclareDocumentCommand{\zt}{s O{\braced} m}
{
        \IfBooleanTF{#1}
                {\txformOp*{mathcalst}{Z}{#2}{#3}}
                {\txformOp{mathcal}{Z}{#2}{#3}}
}
\DeclareDocumentCommand{\izt}{s O{\braced} m}
{
        \IfBooleanTF{#1}
                {\txformOp*{mathcalst}{Z}[^{\kern-0.5pt\inverseSym}\kern-1.5pt]{#2}{#3}}
                {\txformOp{mathcal}{Z}[^{\inverseSym}\kern-1.5pt]{#2}{#3}}
}
\DeclareDocumentCommand{\rt}{s O{\braced} m}
{
        \IfBooleanTF{#1}
                {\txformOp*{mathcal}{R}{#2}{#3}}
                {\txformOp{mathcalst}{R}{#2}{#3}}
}
\DeclareDocumentCommand{\irt}{s O{\braced} m}
{
        \IfBooleanTF{#1}
                {\txformOp*{mathcal}{R}[^{\kern-0.5pt\inverseSym}\kern-1.5pt]{#2}{#3}}
                {\txformOp{mathcalst}{R}[^{\inverseSym}\kern-1.5pt]{#2}{#3}}
}
%-------------------------------------------------------------------------------------------------------------------------------%
%*******************************************************************************************************************************%
%**************************************** Configuration/setup/component helper commands ****************************************%
%*******************************************************************************************************************************%
%-------------------------------------------------------------------------------------------------------------------------------%
\DeclareDocumentCommand{\SetMathVar}{t! G{\@default@differential@var} o}%
{%
        \IfValueTF{#3}{\csgdef{#3}{#2}}{}%
        \IfBooleanTF{#1}%
        {\gdef\l@differential@var{#2}}%
        {%
                \gdef\l@differential@var{#2}%
                \gdef\g@differential@var{#2}%
        }%
}
%-------------------------------------------------------------------------------------------------------------------------------%
\DeclareDocumentCommand{\@set@inprod@comma@pos}{m m m}
{
    \begingroup
        \setlength{\@macro@length}{\heightof{$\displaystyle #1#2$}}
        \setlength{\@macro@width}{\widthof{$\displaystyle #1#2$}}
        \pgfmathsetmacro{\@max@inprod@arg@height}{\@macro@length}
        \pgfmathparse{ifthenelse(\@max@inprod@arg@height>= \@height@math@symbols, 1, 0)}
        \if\pgfmathresult 1\relax
            \raisebox{\dimexpr\@height@math@symbols/2-\@height@math@comma\relax}{,}\,
        \else
            ,
        \fi
    \endgroup
}
%-------------------------------------------------------------------------------------------------------------------------------%
\DeclareDocumentCommand{\@add@IBP@node}{m}%
{%
        \tikz[overlay, remember picture, baseline] \node (#1) {};}
%-------------------------------------------------------------------------------------------------------------------------------%
\DeclareDocumentCommand{\addIBProw}{m m s}%
{%
        \IfBooleanTF{#3}
        {
                \textstyle#1\quad
                &\@add@IBP@node{Left \the\numexpr\value{@IBP@rows@counter}+1\relax}
                &\@add@IBP@node{Right \the\numexpr\value{@IBP@rows@counter}+2\relax}
                \@add@IBP@node{Right \the\numexpr\value{@IBP@rows@counter}+1\relax}
                &\textstyle#2
        }
        {
                \textstyle#1\quad
                &\@add@IBP@node{Left \the\numexpr\value{@IBP@rows@counter}+1\relax}
                &\@add@IBP@node{Right \the\numexpr\value{@IBP@rows@counter}+1\relax}
                &\textstyle#2
        }
        \stepcounter{@IBP@rows@counter}%
}
%-------------------------------------------------------------------------------------------------------------------------------%
\DeclareDocumentCommand{\@add@arrow@sign}{m}
{
        node [#1] \bgroup
        \iftoggle{@add@sub@TF}
                {$\scriptscriptstyle\fontcolor{IBPColorset-colsymbols}+\unskip$\egroup;\togglefalse{@add@sub@TF}}
                {$\scriptscriptstyle\fontcolor{IBPColorset-colsymbols}-\unskip$\egroup;\toggletrue{@add@sub@TF}}
}
%-------------------------------------------------------------------------------------------------------------------------------%
\DeclareDocumentCommand{\@draw@IBP@arrows}{}
{%
        \begin{tikzpicture}[overlay, remember picture]
                \toggletrue{@add@sub@TF}
                \forLoop{1}{\numexpr\value{@IBP@rows@counter}-1\relax}{@current@IBP@row@counter}
                {
                        \draw[IBPdiagArrows]
                                ($(Left \the\value{@current@IBP@row@counter}.west)+(\@diag@IBP@arrows@leftXShift, \@diag@IBP@arrows@leftYShift)$)
                                --
                                ($(Right \the\numexpr\value{@current@IBP@row@counter}+1\relax.east)+(-\@diag@IBP@arrows@rightXShift, \@diag@IBP@arrows@rightYShift)$)
                        \@add@arrow@sign{above, midway}
                }
                \draw[IBPhorizArrows]
                    ($(Right \the\numexpr\value{@IBP@rows@counter}+1\relax.west)+(\@horiz@IBP@arrows@rightXShift, \@horiz@IBP@arrows@yShift)$)
                    --
                    ($(Left \the\value{@IBP@rows@counter}.east)+(-\@horiz@IBP@arrows@leftXShift, \@horiz@IBP@arrows@yShift)$)
                \@add@arrow@sign{below, pos=0.41}
    \end{tikzpicture}
}
%*******************************************************************************************************************************%
%********************************************** New/Modified Cases Environments ************************************************%
%*******************************************************************************************************************************%
% Add spacing after left brace in dcases environment
\newcases{sdcases}{\quad}{%
  $\m@th\displaystyle{\;##}$\hfil}{$\m@th\displaystyle{##}$\hfil}{\lbrace}{.}
\newcases{sdcases*}{\quad}{%
  $\m@th\displaystyle{\;##}$\hfil}{{##}\hfil}{\lbrace}{.}
\renewcases{dcases}{\quad}{%
  $\m@th\displaystyle{\;##}$\hfil}{$\m@th\displaystyle{##}$\hfil}{\lbrace}{.}
\renewcases{dcases*}{\quad}{%
  $\m@th\displaystyle{\;##}$\hfil}{{##}\hfil}{\lbrace}{.}
%*******************************************************************************************************************************%
%************************************ New math environments and environment-like commands **************************************%
%*******************************************************************************************************************************%
%-------------------------------------------------------------------------------------------------------------------------------%
% Equivalent to align/align* environment but with math content automatically made bold
\DeclareDocumentEnvironment{boldAMS}{s O{alignat}}
        {\boldmath\IfBooleanTF{#1}{\csname #2*\endcsname}{\csname #2\endcsname}}
        {\IfBooleanTF{#1}{\csname end#2*\endcsname}{\csname end#2\endcsname}}
%-------------------------------------------------------------------------------------------------------------------------------%
% Equivalent to align/align* environment but with math content automatically made bold
\DeclareDocumentEnvironment{boldalign}{s}
        {\boldmath\IfBooleanTF{#1}{\csname align*\endcsname}{\align}}
        {\IfBooleanTF{#1}{\csname endalign*\endcsname}{\endalign}}
%-------------------------------------------------------------------------------------------------------------------------------%
% Equivalent to alignat/alignat* environment but with math content automatically made bold
\DeclareDocumentEnvironment{boldalignat}{s}
        {\boldmath\IfBooleanTF{#1}{\csname alignat*\endcsname{2}}{\alignat{2}}}
        {\IfBooleanTF{#1}{\csname endalignat*\endcsname}{\endalignat}}
%-------------------------------------------------------------------------------------------------------------------------------%
%\DeclareDocumentCommand{\xmatrix}{s O{nmatrix} D(){{\c@array@column@count}} m}
\DeclareDocumentCommand{\xmatrix}{s D(){nmatrix} O{} m}
{%
        \text%
        {%
                \query@array@dims{#1}{#4}%
                \ensuremath%
                {%
                        \begin{#2}{\c@array@column@count}#3%
                                #4%
                        \end{#2}%
                }%
        }%
}
\DeclareDocumentEnvironment{xxmatrix}{s}{\xmatrix\bgroup}{\egroup}
%-------------------------------------------------------------------------------------------------------------------------------%
\NewEnviron{collectMBODY}{\query@array@dims{\BooleanFalse}{\BODY}\ensuremath{\begin{Xmatrix}\BODY\end{Xmatrix}}}
%-------------------------------------------------------------------------------------------------------------------------------%
%\NewEnviron{collectMATHBODYTEXT}{\text{\begin{Xmatrix}\BODY\end{Xmatrix}}}
\NewEnviron{collectMATHBODYTEXT}{\text{\xmatrix{\BODY}}}
\NewEnviron{collectMATHBODYTEXTB}{\protect{\text{\xmatrix{\BODY}}}}
\NewEnviron{collectMATHBODYTEXTC}{\protect{\begin{collectMATHBODYTEXT}\BODY\end{collectMATHBODYTEXT}}}
%-------------------------------------------------------------------------------------------------------------------------------%
\NewEnviron{collectMATHBODY}[3][nmatrix]%
{%
        \text%
        {%
                \query@array@dims{\BooleanFalse}{\BODY}%
                \ensuremath%
                {%
                        \begin{#1}{#2}#3%
                               \BODY%
                        \end{#1}%
                }%
        }%
}
%-------------------------------------------------------------------------------------------------------------------------------%
% Problem environment box fitted to content instead of width of line, for short problem statements
\newenviron{genmatrix}[0]%[1]%[nmatrix]%
{%
        %\gdef\@@envname{#1}%
        %\protect\bgroup
        %\ensuremath\bgroup
        %\xmatrix\bgroup
        %\text\bgroup%
        %\query@array@dims{\BooleanFalse}\bgroup
        %{%\begin{Xmatrix}%\end{align*}
}
{%
        %\end{Xmatrix}%\begin{align*}%
        %\egroup\\%
        %\text%
        %{%
                \query@array@dims{\BooleanFalse}{\genmatrixbody}%
%                \ensuremath%
%                {%
%                        %\begin{#1}{#2}#3%{{\c@array@column@count}[v]}
%                        \xp\begin\xp{\@@envname}{\c@array@column@count}%#3%{{\c@array@column@count}[v]}
%                               \genmatrixbody%
%                        \xp\end\xp{\@@envname}%
%                }%
        %}%
        %\egroup%
}
%-------------------------------------------------------------------------------------------------------------------------------%
% Parse array environment content to determine the # of rows/columns
\DeclareDocumentEnvironment{Xmatrix}{s D(){nmatrix} G{\c@array@column@count} O{}}%
{%
        %\text\bgroup%
        %\collectBODY
        \collectMATHBODY[#2]{#3}{#4}
        %\collectMBODY
        %\collectMMBODY[#2]{#3}{#4}
        %\begin{collectMATHBODY}
}
{%
        %\endcollectBODY%\egroup
        %\endcollectMMBODY%\egroup
%        %\endcollectMBODY%\egroup
        \endcollectMATHBODY
%        \query@array@dims{#1}{\BODY}%
%        %\text{%
%        \ensuremath%
%        {%
%        %$%
%                \begin{#2}#3%
%                       \BODY%
%                \end{#2}%
%        %$
%        }%
%        %\egroup%
%        %}%
}
%-------------------------------------------------------------------------------------------------------------------------------%
% Row reduction array process, particularly useful w/ "xmatrix" determining array dimensions
\DeclareDocumentEnvironment{rmatrix}{m O{c}}
        {\array{@{}r |@{\hspace{3pt}} @{\,}*{#1} #2 |}}
        {\endarray}%\kern-\arraycolsep
%-------------------------------------------------------------------------------------------------------------------------------%
% Normal matrix with # columns set explicitly, particularly useful w/ "xmatrix" determining array dimensions
\DeclareDocumentEnvironment{nmatrix}{m O{c} D(){b}}%
{%
        \setcounter{@macro@counter}{#1}
        \set@lr@delimiters{#3}%
        \left\the@ldelim%
        \array{@{\,}*{#1} #2}%
}
{%
        \endarray%
        \kern-0.5\arraycolsep%
        \right\the@rdelim%
}
%-------------------------------------------------------------------------------------------------------------------------------%
\MHInternalSyntaxOn
%-------------------------------------------------------------------------------------------------------------------------------%
\DeclareDocumentEnvironment{BMatrix}{g t! O{c} D(){b}}
{%
        \def\BMalign{#3}%
        \stepcounter{BMatrix}%
        \set@lr@delimiters{#4}%
        \left\the@ldelim%
        \IfBooleanTF{#2}{}{\hskip -0.5\arraycolsep}%
        \MH_let:NwN \@ifnextchar \MH_nospace_ifnextchar:Nnn%
        \IfValueTF{#1}%
                {\def\@@colcount{#1}}%
                {\def\@@colcount{\numexpr\c@MaxMatrixCols-1}}
        \array{ #3 *{\@@colcount} {>{\collectcell\setmaxwd}#3<{\endcollectcell}}}%
}
{%
        \endarray%
        \IfBooleanTF{#2}{}{\hskip -0.5\arraycolsep}%
        \right\the@rdelim%
}
%-------------------------------------------------------------------------------------------------------------------------------%
\MHInternalSyntaxOff
%-------------------------------------------------------------------------------------------------------------------------------%
%-------------------------------------------------------------------------------------------------------------------------------%
%-------------------------------------------------------------------------------------------------------------------------------%
%-------------------------------------------------------------------------------------------------------------------------------%
% From longdiv.tex located at <TeX distribution directory>\tex\generic\genmisc\longdiv.tex
%                                   1         2            3 4 5
\DeclareDocumentCommand{\longdivop}{O{\Large} D(){\rparen} m m D;;{\@current@font}}
{%
        \let\@longdiv@open@delimiter=#2%
        %\let\@math@fontstyle=#5%
        \def\@math@fontstyle{#5}%
%        \IfDefEqCase{\@longdiv@open@delimiter}%
%        {%
%                {\rparen}{\csgdef{@longdiv@open@delimiter@kern}{\kern\@longdiv@rparen@kern}}%
%                {\vert}{\csgdef{@longdiv@open@delimiter@kern}{\kern\@longdiv@vert@kern}}%
%                {\rvert}{\csgdef{@longdiv@open@delimiter@kern}{\kern\@longdiv@vert@kern}}%
%                {\lvert}{\csgdef{@longdiv@open@delimiter@kern}{\kern\@longdiv@vert@kern}}%
%        }%
%        \ifdefstring{\rparen}{rparen}{\csgdef{@longdiv@open@delimiter@kern}{\kern\@longdiv@rparen@kern}}{}%
%        \ifdefstring{\rparen}{vert}{\csgdef{@longdiv@open@delimiter@kern}{\kern\@longdiv@vert@kern}}{}%
%        \ifdefstring{\rparen}{rvert}{\csgdef{@longdiv@open@delimiter@kern}{\kern\@longdiv@vert@kern}}{}%
%        \ifdefstring{\rparen}{lvert}{\csgdef{@longdiv@open@delimiter@kern}{\kern\@longdiv@vert@kern}}{}%
%        \IfDefStringCase{\rparen}%
%        {%
%                {rparen}{\csgdef{@longdiv@open@delimiter@kern}{\kern\@longdiv@rparen@kern}}%
%                {vert}{\csgdef{@longdiv@open@delimiter@kern}{\kern\@longdiv@vert@kern}}%
%                {rvert}{\csgdef{@longdiv@open@delimiter@kern}{\kern\@longdiv@vert@kern}}%
%                {lvert}{\csgdef{@longdiv@open@delimiter@kern}{\kern\@longdiv@vert@kern}}%
%        }%
        \IfDefEqCase{\rparen}%
        {%
                {\rparen}{\csgdef{@longdiv@open@delimiter@kern}{\kern\@longdiv@rparen@kern}}%{hello\\}%
                {\vert}{\csgdef{@longdiv@open@delimiter@kern}{\kern\@longdiv@vert@kern}}%{hello\\}%
                {\rvert}{\csgdef{@longdiv@open@delimiter@kern}{\kern\@longdiv@vert@kern}}%{hello\\}%
                {\lvert}{\csgdef{@longdiv@open@delimiter@kern}{\kern\@longdiv@vert@kern}}%{hello\\}%
        }%
        #1%
        $%
                %\@math@fontstyle%
                %{%
                #4\,%
                \overline%
                {%
                        \vphantom{\big\@longdiv@open@delimiter}%
                        \@longdiv@open@delimiter@kern%
                        \hbox%
                        {%
                                \smash%
                                {%
                                        \raise3.5\fontdimen8\textfont3%
                                        \hbox{$\big\@longdiv@open@delimiter$}%
                                }%
                        }%
                        \mkern2mu #3
                }
                %}%
        $%
}
%-------------------------------------------------------------------------------------------------------------------------------%
% From longdiv.tex located at <TeX distribution directory>\tex\generic\genmisc\longdiv.tex
%                                 1  2         3            4 5 6
\DeclareDocumentCommand{\longdiv}{t! O{\Large} D(){\rparen} m m D;;{\@current@font}}
{%
        \let\@longdiv@fontsize=#2%
        \let\@longdiv@open@delimiter=#3%
        \def\@dividend{#4}
        \def\@divisor{#5}
        \def\@longdiv@math@fontstyle{#6}%
        \vtop%
        {%
                \@longdiv@fontsize\normalbaselines \offinterlineskip
                \setbox\strutbox\hbox{\vrule height 2.1ex depth .5ex width0ex}%
                % Print/underline value subtracted from current power of 10 dividend=divisor * greatest # s.t. result > 0
                \def\showdig%
                {%
                        $\underline{\textendash\hskip1.5pt\the\LDscratch\strut}$\cr %
                        $\the\rtot$\strut\cr\noalign{\kern-.2ex}%
                }%
                \global\rtot=\@dividend\relax
                \count0=\rtot\divide\count0by\@divisor\edef\quotient{\the\count0}%
                % make list macro out of digits in quotient:
                \def\temp##1{\ifx##1\temp\else \noexpand\dodig ##1\xp\temp\fi}%
                \edef\routine{\xp\temp\quotient\temp}%
                % process list to give power-of-ten:
                \def\dodig##1{\global\multiply\gpten by10 }\global\gpten=1 \routine
                % to display effect of one digit in quotient (zero ignored):
                \def\dodig##1%
                {
                        \global\divide\gpten by10
                        \LDscratch =\gpten
                        \multiply\LDscratch  by##1%
                        \multiply\LDscratch  by\@divisor
                        \global\advance\rtot-\LDscratch \relax
                        % Print current dividend = previous dividend - (divisor * greatest # s.t. result > 0)
                        \ifnum\LDscratch>0 \showdig \fi % must hide \cr in a macro to skip it
                }
                \tabskip=0pt
                \halign
                {
                        \hfil##\cr % \halign for entire division problem
                        % Print quotient result above line of dividend/divisor and long division operator
                        $\quotient$\strut\cr%
                        % Construct top line with divisor and dividend inside division operator symbol/overline
                        \longdivop[\@longdiv@fontsize](\@longdiv@open@delimiter){\@dividend}{\@divisor};\@longdiv@math@fontstyle;%
                        \cr\cr\noalign{\kern-.2ex}%
                        % Print long division process, suppressed if xparse Boolean '!' given in call
                        \IfBooleanTF{#1}{}{\routine \cr }% do each digit in quotient
                }%
        }%
        \normalsize%
}
%-------------------------------------------------------------------------------------------------------------------------------%
% From longdiv.tex located at <TeX distribution directory>\tex\generic\genmisc\longdiv.tex
%                                    1  2         3            4 5 6                                             7
\DeclareDocumentCommand{\tcblongdiv}{t! O{\Large} D(){\rparen} m m D::{\BreakableShadowText*!:\@tcb@title@font:} D;;{\shadowmath*!}}
{
        \@set@current@tcb@colors{LDColorset}%
        \stepcounters{table,LDtable}%
        \def\@tcblongdiv@title@text@fontstyle{#6}%
        \def\@tcblongdiv@title@math@fontstyle{#7}%
        \savebox{\@tcb@mathbox@content@box}{\longdiv[#2](#3){#4}{#5}}%
        \setlength\@env@BODY@width{\maxof{\wd\@tcb@mathbox@content@box}{\@tcb@mathbox@min@setwidth}}%
        \IfBooleanTF{#1}%
                {\def\@LDtable@title@sep{}}%
                {\def\@LDtable@title@sep{\@tcb@title@sep}}%
        \def\@longdiv@text@title@content%
        {%
                \@tcblongdiv@title@text@fontstyle%
                {\LDtableLongName\unskipspacing}%
                \@LDtable@title@sep%
        }%
        \def\@longdiv@math@title@content{\longdivop[#2](#3){#4}{#5};#7;}%
        \setlength\@tcb@mathbox@text@title@width{\widthof{\@longdiv@text@title@content}}%
        \cftLDtable@bookmark!%
        \begin{tcolorbox}[PLDStyle, title={}, width={\@env@BODY@width + 2.5cm}]%
        \begin{tcolorbox}%
        [
                mathboxContentStyle, width=\@env@BODY@width,
                title=%
                {%
                        \bookmarkX@hypertarget{LDtable}%
                        \cftLDtable@contentsline{}%
                        \cftLDtable@hyperblend*%
                        '\@tcbPLD@text@font'%
                        {\@LDtable@title@sep\;\@longdiv@math@title@content}%
                }
        ]%
                \usebox{\@tcb@mathbox@content@box}%
        \end{tcolorbox}%
        \end{tcolorbox}%
}
%-------------------------------------------------------------------------------------------------------------------------------%
\DeclareDocumentCommand{\tcbmathbox@dimensions}{s o m m}
{%\tcbIBP*<newline before text>!<no text>(text entry)[math entry]{u term}{dv term}{wrt variable}
        \toggletrue{@in@tcbenclosure}%
        \@set@current@tcb@colors{tcbBlueScheme}%
        \savebox{\@tcb@mathbox@left@content@box}{\begin{usecollectedBODY}#3\\[-2.5em]\end{usecollectedBODY}}%
        \savebox{\@tcb@mathbox@right@content@box}{\begin{usecollectedBODY}#4\\[-2.5em]\end{usecollectedBODY}}%
        \@tcb@mathbox@right@content@box
        %\deflength{hlengthi}{hglue expressioni}
        \setlength{\@env@BODY@width}{\wd\@tcb@mathbox@left@content@box + \wd\@tcb@mathbox@right@content@box + 14mm}%
        \setlength{\@tcb@mathbox@leftcontent@width}{\wd\@tcb@mathbox@left@content@box}%
        \setlength{\@tcb@mathbox@rightcontent@width}{\wd\@tcb@mathbox@right@content@box}%
        \setlength{\@macro@length@diff}{\wd\@tcb@mathbox@left@content@box - \wd\@tcb@mathbox@right@content@box}%
        \setlength{\@macro@shift}{(\linewidth - \@env@BODY@width)/2}%
}
%-------------------------------------------------------------------------------------------------------------------------------%
\DeclareDocumentCommand{\tcbmathbox}{s O{} m m}
{%\tcbIBP*<newline before text>!<no text>(text entry)[math entry]{u term}{dv term}{wrt variable}
        \toggletrue{@in@tcbenclosure}%
        \savebox{\@tcb@mathbox@left@content@box}{\begin{usecollectedBODY}#3\\[-2.5em]\end{usecollectedBODY}}%
        \savebox{\@tcb@mathbox@right@content@box}{\begin{usecollectedBODY}#4\\[-2.5em]\end{usecollectedBODY}}%
        \setlength{\@env@BODY@width}{\wd\@tcb@mathbox@left@content@box + \wd\@tcb@mathbox@right@content@box + 14mm}%
        \setlength{\@tcb@mathbox@leftcontent@width}{\wd\@tcb@mathbox@left@content@box}%
        \setlength{\@tcb@mathbox@rightcontent@width}{\wd\@tcb@mathbox@right@content@box}%
        \setlength{\@macro@length@diff}{\wd\@tcb@mathbox@left@content@box - \wd\@tcb@mathbox@right@content@box}%
        \setlength{\@macro@shift}{(\linewidth - \@env@BODY@width)/2}%
        \@set@current@tcb@colors{tcbBlueScheme}%
        \xp\ifstrempty\xp{#2}{\togglefalse{tcbtitle@included}}{\toggletrue{tcbtitle@included}}
        \tcbset{title={#2}}%
        \IfBooleanTF{#1}%
                {\tcbsidebyside[dualIBPtable, width=\@env@BODY@width, sidebyside adapt=both, lefttitle=3mm, left skip=\@macro@shift, leftupper=4mm]}%
                {\tcbsidebyside[dualIBPtable, leftupper=-8mm, sidebyside gap=-5mm, lefttitle=3mm]}%%
        {\unskipspacing\centering\usebox{\@tcb@mathbox@left@content@box}}%
        {\unskipspacing\centering\usebox{\@tcb@mathbox@right@content@box}}%
        \togglefalse{@in@tcbenclosure}%
        \tcbset{reset}%,empty
        \tcbsetforeverylayer{title={},notitle}%
}
%-------------------------------------------------------------------------------------------------------------------------------%
%% Generates table for the 'tabular method' of 'integration by parts' (IBP), arrows are added on 2nd pass
%                                   1 2  3  4   5 6 7 8
\DeclareDocumentEnvironment{tcbIBP}{t! s t+ d() o m m G{\@default@differential@var} }
{%\tcbIBP<!=label only title><*=newline before title text/math>(text entry)[math entry]{u term}{dv term}{wrt variable}
        \IBPlinespacing%
        \@set@current@tcb@colors{IBPColorset}%
        \resetcounter{@IBP@rows@counter}%
        \stepcounter{IBPtable}%\stepcounter{table}%
        \SetMathVar!{#8}%
        \global\let\@tcb@mathbox@title@newline@skip\@tcb@IBPtable@title@newline@skip%
        \IfValueTF{#5}%
                {\def\@tcbIBP@math@expression{#5}}%
                {\def\@tcbIBP@math@expression{\int #6#7\@differential@op{\l@differential@var}}}%
        \forwardBooleanList{\@set@tcb@mathbox@title}%
                {#1/!,#2/*,#3/+}%
                {\IBPtableName}%
                :{\BreakableShadowText*:\cftX@tcbtitle@fontfamily:}:[#4]%
                ;\shadowmath*!;(\@tcbIBP@math@expression)%
        \savebox{\@tcb@mathbox@math@title@box}{\@tcb@mathbox@title@content}%
        \savebox{\@tcb@mathbox@text@title@box}{\@tcb@mathbox@listentry@content}%
        \setlength{\@tcb@mathbox@math@title@width}{\wd\@tcb@mathbox@math@title@box}%
        \setlength{\@tcb@mathbox@text@title@width}{\wd\@tcb@mathbox@text@title@box}%
        \centering%
        \@set@conditional@tcb@settings(@conditional@tcb@settings){@in@tcbenclosure}{bottom=4.0mm}{bottom=2.0mm}%
        \setlength{\parindent}{0em}%
        \IBPtable{>{$}c<{$} c @{\hspace{\@tcb@mathbox@column@sep}} c  >{$}c<{$}}%
                [\@tcb@mathbox@title@sep]%
                (\@tcb@mathbox@title@suffix)%
                {\@tcb@mathbox@title@content}%
                {\@tcb@mathbox@listentry@content}({#6}{#7})%
}{%
        \endIBPtable%
        \@draw@IBP@arrows\\%
        \tcbset{reset}%,empty
        \tcbsetforeverylayer{title={},notitle}%
}
%-------------------------------------------------------------------------------------------------------------------------------%
%                                                     1 2  3  4  5
\DeclareDocumentCommand{\tcbPLD@parse@booleans}{s t! t- t+ t>}
{%
        \@parse@boolean{#1}{@include@PLD@zero@coefficients@}%\@include@PLD@zero@coefficients@TF
        \@parse@boolean{#2}{@supress@PLD@title@}%\@supress@PLD@title@TF
        \@parse@boolean{#3}{@ignore@PLD@math@title@}%\@ignore@PLD@math@title@TF
        \@parse@boolean{#4}{@include@PLD@conclusion@}%\@include@PLD@conclusion@TF
        \@parse@boolean{#5}{@PLD@sidebyside@}%\@PLD@sidebyside@title@TF
}
%-------------------------------------------------------------------------------------------------------------------------------%
\DeclareDocumentCommand{\tcbPLD@dimensions}{}
{%
        \def\@maxof@savebox@widths{\maxof{\@pld@solution@box@width}{\@pld@conclusion@box@width}}%
        \def\@minof@savebox@widths{\minof{\@pld@solution@box@width}{\@pld@conclusion@box@width}}%
        \ifx\pld@remainder\@empty%
                \setlength{\@pld@tcb@width}{\@maxof@savebox@widths}%
                \setlength{\@pld@tcb@extrude@right}{2.5mm}%
                \addtolength{\@pld@tcb@width}{6.5mm}%
        \else%
                \setlength{\@pld@tcb@width}{\@maxof@savebox@widths}%
                \addtolength{\@pld@tcb@width}{13mm}%
                \setlength{\@pld@tcb@extrude@right}{6.5mm}%
        \fi%
        \setlength{\@tcb@mathbox@leftright@skip}%
                {(\@pld@tcb@width + \@pld@tcb@extrude@right - \@minof@savebox@widths) / 2}%
}
%-------------------------------------------------------------------------------------------------------------------------------%
\DeclareDocumentCommand{\tcbPLD@settings}{m}
{%
        \PLDlinespacing%
        \if@include@PLD@zero@coefficients@%
                \toggletrue{@pld@print@zero@coefficients}%
        \else%
                \togglefalse{@pld@print@zero@coefficients}%
        \fi%
        \let\@pld@open@delimiter=#1%
        \@set@current@tcb@colors{PLDColorset}%
        \gdef\@tcbPLD@fontcolor{stdblue}
        \setulsettings{uline}[depth={\@PLD@ul@depth}, thickness={\@PLD@ul@thickness}]%
        \stepcounters{PLDtable}%
}
%-------------------------------------------------------------------------------------------------------------------------------%
%        1  2 3  4 5                                             6 7                  8
\DeclareDocumentCommand{\@set@tcb@mathbox@title}%
        {t! s t+ m D::{\BreakableShadowText*!:\@tcb@title@font:} o D;;{\shadowmath*!} d()}
{%
        \gdef\@tcb@mathbox@label{#4}%
        \gdef\@tcb@mathbox@text@content{}%
        \gdef\@tcb@mathbox@math@content{}%
        \gdef\@tcb@mathbox@title@content{}%
        \gdef\@tcb@mathbox@listentry@content{}%
        \gdef\@tcb@mathbox@title@sep{}%
        \gdef\@tcb@mathbox@title@suffix{}%
        %\gdef\@tcb@mathbox@listentry@sep{}%
        %\gdef\@tcb@mathbox@text@content@font{#5}%
        \IfValueTF{#6}%
        {%
                \gdef\@tcb@mathbox@text@content{\protect#5{#6}}%
                \gdef\@tcb@mathbox@listentry@content{\@tcb@title@sep#6}%
        }%
        {%
                \gdef\@tcb@mathbox@text@content{}%
                \gdef\@tcb@mathbox@listentry@content{}%
        }%
        \IfValueTF{#8}%
                {\gdef\@tcb@mathbox@math@content{\protect#7{#8}}}%
                {\gdef\@tcb@mathbox@math@content{}}%
        \IfBooleanTF{#1}%
        {%
                \gdef\@tcb@mathbox@title@content{}%
                %\togglefalse{tcbtitle@included}%
        }%
        {%
                %\toggletrue{tcbtitle@included}%
                \IfBooleanTF{#2}%
                {%
                        \IfBooleanTF{#3}%
                                {\gdef\@tcb@mathbox@title@suffix{\@tcb@mathbox@title@newline}}{}%
                        \gdef\@tcb@mathbox@title@content{\@tcb@mathbox@text@content\@tcb@mathbox@math@content}%
                }%
                {\gdef\@tcb@mathbox@title@content{\@tcb@mathbox@text@content}}%
        }%
        \ifdefempty{\@tcb@mathbox@title@content}%
                {\gdef\@tcb@mathbox@title@sep{}}%
                {\gdef\@tcb@mathbox@title@sep{\@tcb@title@sep}}%
}
%-------------------------------------------------------------------------------------------------------------------------------%
%                                1     2 3            4 5 6   7
\DeclareDocumentCommand{\tcbPLD@content}{s}
{%
                \begin{tcolorbox}[mathboxContentStyle, title={}, width=\@pld@tcb@width]%
                        \usebox{\@pld@computation@box}%
                        \ifx\pld@remainder\@empty%
                        \else%
                                \usebox{\@pld@remainder@box}%
                        \fi\\%
                \end{tcolorbox}%
                \if@include@PLD@conclusion@%
                        \tcblower%
                        \begin{tcolorbox}%
                        [
                                mathboxContentStyle, width=\@pld@tcb@width,
                                title={\BreakableShadowText*!:\@tcb@title@font:{PLD Result}\@tcb@title@sep}
                        ]%
                                \usebox{\@pld@conclusion@box}%
                        \end{tcolorbox}%
                \fi%
}
%-------------------------------------------------------------------------------------------------------------------------------%
%                                1     2 3            4 5 6   7
\DeclareDocumentCommand{\tcbPLD}{D(){} o D''{\rparen} m m d() O{}}
{%
        \gdef\@tcbPLD@fontcolor{stdblue}
        \tcbPLD@parse@booleans#1%
        \tcbPLD@settings{#3}%
        \IfValueTF{#6}{\polyset{#6}}{}%
        \polylongdiv{#4}{#5}%
        \setulsettings{uline}[depth={2.0pt}, thickness={1.0pt}]%
        \global\let\@tcb@mathbox@title@newline@skip\@tcb@PLDtable@title@newline@skip%
        \def\@tcbPLD@math@expression{f(x)=\dfrac{#4}{#5}}%
        \forwardBooleanList{\@set@tcb@mathbox@title}%
                {\@supress@PLD@title@TF/!,\@ignore@PLD@math@title@FT/*,\@ignore@PLD@math@title@FT/+}%
                {\PLDtableName}%
                :{\BreakableShadowText*:\cftX@tcbtitle@fontfamily:}:[#2]%
                ;\large\shadowmath*!;(\@tcbPLD@math@expression)%
        \tcbPLD@dimensions%
        \if@PLD@sidebyside@
                \def\@PLD@tcb@options{PLDStyle, sidebyside, title={}, #7}%
        \else
                \def\@PLD@tcb@options%
                {%
                        PLDStyle, width=\@pld@tcb@width + 2\@tcb@boxrule@linewidth, title={},
                        extrude left by=\@tcb@mathbox@leftright@skip, extrude right by=\@tcb@mathbox@leftright@skip, #7%
                }%
        \fi%
        \begin{PLDtable}%
                [\@tcb@mathbox@title@sep]%
                (\@tcb@mathbox@title@suffix)%
                {\Large\@tcb@mathbox@title@content}%
                {\@tcb@mathbox@listentry@content}%
                [\@PLD@tcb@options]%
                %-------------------------------------------------------------
                \tcbPLD@content%
        \end{PLDtable}
        \setulsettings[reset=true]%
}
%-------------------------------------------------------------------------------------------------------------------------------%
\DeclareDocumentCommand{\tcbPLDbox}{s O{} m m}
{%\tcbIBP*<newline before text>!<no text>(text entry)[math entry]{u term}{dv term}{wrt variable}
        \toggletrue{@in@tcbenclosure}%
        \savebox{\@tcb@mathbox@left@content@box}{\begin{usecollectedBODY}#3\\[-2.5em]\end{usecollectedBODY}}%
        \savebox{\@tcb@mathbox@right@content@box}{\begin{usecollectedBODY}#4\\[-2.5em]\end{usecollectedBODY}}%
        \setlength{\@env@BODY@width}{\wd\@tcb@mathbox@left@content@box + \wd\@tcb@mathbox@right@content@box + 14mm}%
        \setlength{\@tcb@mathbox@leftcontent@width}{\wd\@tcb@mathbox@left@content@box}%
        \setlength{\@tcb@mathbox@rightcontent@width}{\wd\@tcb@mathbox@right@content@box}%
        \setlength{\@macro@length@diff}{\wd\@tcb@mathbox@left@content@box - \wd\@tcb@mathbox@right@content@box}%
        \setlength{\@macro@shift}{(\linewidth - \@env@BODY@width)/2}%
        \@set@current@tcb@colors{tcbBlueScheme}%
        \xp\ifstrempty\xp{#2}{\togglefalse{tcbtitle@included}}{\toggletrue{tcbtitle@included}}
        \tcbset{title={#2}}%
        \IfBooleanTF{#1}%
                {\tcbsidebyside[dualPLDtable, leftupper=-0.5\linewidth,width=\@tcb@mathbox@leftcontent@width, sidebyside gap=-0.5\@tcb@mathbox@leftcontent@width]}%, sidebyside adapt=none, sidebyside adapt=both, left skip=\@macro@shift,width=\@env@BODY@width, width=\linewidth,
                {\tcbsidebyside[dualPLDtable, leftupper=-0.5\linewidth, sidebyside gap=-0.5\@tcb@mathbox@leftcontent@width]}%%width=\linewidth,
        {\unskipspacing\centering\usebox{\@tcb@mathbox@left@content@box}}%
        {\unskipspacing\centering\usebox{\@tcb@mathbox@right@content@box}}%
        \togglefalse{@in@tcbenclosure}%
}
%*******************************************************************************************************************************%
%~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~%
%~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ PGF assisted math expression parsing/evaluation commands ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~%
%~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~%
%*******************************************************************************************************************************%
\DeclareDocumentCommand{\toint}{m o}
{%
        \tikzmath%
        {
                integer \x;
                \x = #1;
        }%
        \IfValueTF{#2}{\let#2\pgfmathresult}{}
}
%-------------------------------------------------------------------------------------------------------------------------------%
\DeclareDocumentCommand{\stripunits}{m o}
{%
        \pgfmathsetmacro\@unitless{#1}%
        \let\pgfmathresult\@unitless%
        \IfValueTF{#2}{\let#2\@unitless}{}%
}
%-------------------------------------------------------------------------------------------------------------------------------%
\DeclareDocumentCommand{\iflength}{m m m m m}
{%
        \pgfmathparse{ifthenelse(#1 #2 #3, 1, 0)}
        \if\pgfmathresult 1\relax
                #4%
        \else
                #5%
        \fi
}
%-------------------------------------------------------------------------------------------------------------------------------%
%\def\moduloInt#1#2%
%width("x")
%\pgfmathwidth{"x"}
%height("x")
%\pgfmathheight{"x"}
%depth("x")
%\pgfmathdepth{"x"}
%-------------------------------------------------------------------------------------------------------------------------------%
\DeclareDocumentCommand{\moduloInt}{m m d()}
{%
        \pgfmathparse{int(Mod(#2,#1))}%\pgfmathresult%
        \IfValueTF{#3}{\csxdef{#3}{\pgfmathresult}}{}%
}
%%-------------------------------------------------------------------------------------------------------------------------------%
%\DeclareDocumentCommand{\pgfmathpluseq}{s m m d()}
%{%
%       \ifismacro
%        \IfBooleanTF{#1}%
%               {\pgfmathparse{int(add(#1,#2))}}%
%               {\pgfmathparse{int(add(#1,#2))}}%
%       \pgfmathparse{int(add(#1,#2))} \pgfmathresult
%        \pgfmathadd{int(Mod(#2,#1))}%\pgfmathresult%
%        \IfValueTF{#3}{\csxdef{#3}{\pgfmathresult}}{}
%        \pgfmathsetcount{hcount register i}{hexpressioni}
%       \pgfmathaddtocount{hcount register i}{hexpressioni}
%}
%%-------------------------------------------------------------------------------------------------------------------------------%
%\DeclareDocumentCommand{\@plus@equals}{s m o D(){50} t+ t-}
%{%
%        \numdef\@temp}
%        \IfBooleanTF{#1}%
%                {}%
%                {}%
%}
%-------------------------------------------------------------------------------------------------------------------------------%
%-------------------------------------------------------------------------------------------------------------------------------%
%-------------------------------------------------------------------------------------------------------------------------------%
\global\let\tcboxmathtable\tcbmathbox
\global\let\tcbmathtable\tcbmathbox
\global\let\intbyparts\tcbIBP
\global\let\intbypartsbox\tcbIBP
\global\let\tcbpolylongdiv\tcbPLD
\global\let\equationtcbox\tcbequation
\global\let\tcboxequation\tcbequation
\global\let\tcbeqbox\tcbequation
%*******************************************************************************************************************************%
%************************************************** End of 'my-math.sty' package ***********************************************%
%*******************************************************************************************************************************%
% Restore @ -> \catcode'@=12 (active), peventing user access to macro names containing @ character
\makeatother
\mathoff                                        % Restore '|' to standard 'other' character
\endinput
