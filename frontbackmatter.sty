%*****************************************************************************************************************************************%
%********************************************************** `frontbackmatter.sty' ********************************************************%
%*****************************************************************************************************************************************%
% This is an adaptation of the 'glossaries' package's 'glossary-hypernav.sty' component implementing the 'indexhypergroup' glossary style selected using the
% \setglossarystyle{indexhypergroup} command
%*****************************************************************************************************************************************%
%*************************************** Define provided package name and LaTeX/package dependencies *************************************%
%*****************************************************************************************************************************************%
\NeedsTeXFormat{LaTeX2e}[1994/06/01]
\ProvidesPackage{frontbackmatter}
%*****************************************************************************************************************************************%
%****************************************** Package options and corresponding Boolean variables ******************************************%
%*****************************************************************************************************************************************%
%-----------------------------------------------------------------------------------------------------------------------------------------%
\DeclareOption*{\PackageWarning{frontbackmatter}{Unknown `\CurrentOption'}}
%*****************************************************************************************************************************************%
%***************************************************** Processing of package options *****************************************************%
%*****************************************************************************************************************************************%
\ProcessOptions\relax
%-----------------------------------------------------------------------------------------------------------------------------------------%
\makeatletter						% Change @ to standard letter, \catcode'@=11 so it can be used in macro names/definition
\catcode`|=12
%\catcode`\!=12
%*****************************************************************************************************************************************%
%************************************************************* Package Body **************************************************************%
%*****************************************************************************************************************************************%
%%\captionsetup[longtable]{labelfont=bf,textfont=it,labelsep=newline}
%\contentsuse{name}{ext}
%\indexsetup{level=\section*,toclevel=section,noclearpage}
\tocloftpagestyle{empty}
\def\@gls@glossary@style{alttreehypergroup}			% Glossary style selection, defined in my-glossary-tree.sty Alternative: Indexhypergroup
%\def\@gls@glossary@style{indexhypergroup}
\setglossarystyle{\@gls@glossary@style}
%\setStyleFile{my-glossaries}
%\def\istfilename{my-glossaries.ist}	%-----------------------------------------------------------------------------------------------------------------------------------------%
%-----------------------------------------------------------------------------------------------------------------------------------------%
%-----------------------------------------------------------------------------------------------------------------------------------------%
%figbox
%figboxfigure
%Matlablisting
%Terminallisting
%Chapter
%Section
%Subsection
%Topic
%fig
%figbox
%figboxfigure
%problems
%subproblems
%problemparts
%subproblems
%problempartssubproblems
%subproblemparts
%listings
%-----------------------------------------------------------------------------------------------------------------------------------------%
\newlistentry{Chapter}{toc}{0}
\newlistentry[Chapter]{Section}{toc}{1}
\newlistentry[Section]{Subsection}{toc}{2}
\newlistentry{Topic}{toc}{0}
\newlistof{problems}{probs}{\listproblemsname}
\newlistentry[problems]{subproblems}{probs}{2}
\newlistentry[problems]{problemparts}{probs}{2}
\newlistentry[problemparts]{problempartssubproblems}{probs}{3}
\newlistentry[subproblems]{subproblemparts}{probs}{3}
\begingroup\let\newcounter\@gobble\let\setcounter\@gobbletwo
	\globaldefs\@ne \let\c@loldepth\@ne
  	\newlistof{listings}{lol}{\lstlistlistingname}
\endgroup
%\newlistentry{Matlablisting}{lol}{0}
%\newlistentry{Terminallisting}{lol}{0}
%\newlistentry{IBPtable}{lot}{0}
%\newlistentry{figbox}{lof}{0}
%\newlistentry[figbox]{figboxfigure}{lof}{1}
\setcounter{tocdepth}{4}
\setcounter{lofdepth}{4}
\setcounter{probsdepth}{4}
%-----------------------------------------------------------------------------------------------------------------------------------------%
%-----------------------------------------------------------------------------------------------------------------------------------------%
\renewcommand{\@cfttocfinish}{\if@cfthaschapter\if@restonecol\twocolumn\fi\fi\setcounter{page}{0}}
%-----------------------------------------------------------------------------------------------------------------------------------------%
\newcommand{\cftXnamenum}[2]%
{%	
	\expandafter\newcommand\expandafter{\csname cft#1name\endcsname}{#2}%
	\expandafter\newcommand\expandafter{\csname cft#1namenum\endcsname}%
	{%
		\expandafter\expandonce%
		\csname cft#1name\endcsname%
		\space%
		\csname the#1\endcsname%
	}%
}
%-----------------------------------------------------------------------------------------------------------------------------------------%
\newcommand{\cftXnumberline}[2]%
{%	
	\expandafter\newcommand\csname cft#2numberline\endcsname[1]
	{
		\raisebox{10pt}%
		{%figbox\thefigbox
			\expandafter\protect\expandafter\hypertarget{#2\csname the#2\endcsname}{}%
		}%
		\protect\numberline{\csname the#2\endcsname}%
		\csname #2name\endcsname\space\csname the#2\endcsname##1%
		\ignorespaces%\xspace
	}
}
\cftXnumberline{lof}{figbox}
%-----------------------------------------------------------------------------------------------------------------------------------------%
\newcommand{\cftXhypertitle}[1]
{%
	%                                                                                1                     2        3          4 5
	\expandafter\DeclareDocumentCommand\expandafter{\csname cft#1hypertitle\endcsname}{D||{\@tcb@title@font} O{white} D(){black} m m }
	{
		\edef\@this@title@cft@name{\csname #1name\endcsname\space\csname the#1\endcsname}
		\expandafter\hyperlink\expandafter%
			{#1\csname the#1\endcsname}%
			{\BreakableShadowText{##1}[##2](##3){\@this@title@cft@name##4##5}}%
	}
}
\cftXhypertitle{figbox}	
%\cftXtcbtitle{figbox}	
%-----------------------------------------------------------------------------------------------------------------------------------------%
\newcommand{\cftXcontentsline}[2]%
{%	
	\expandafter\newcommand\csname cft#2contentsline\endcsname[1]
		{\expandafter\phantomsection\expandafter\addcontentsline{#1}{#2}{\cftfigboxnumberline{##1}}\ignorespaces}
		%{\phantomsection\addcontentsline{#1}{#2}{\cftfigboxnumberline{##1}}\ignorespaces}
}
\cftXcontentsline{lof}{figbox}
%-----------------------------------------------------------------------------------------------------------------------------------------%
\newcommand{\cftXtcbtitle}[1]%
{%	
	%\DeclareExpandableDocumentCommand
	\expandafter\newcommand\expandafter{\csname cft#1tcbtitle\endcsname}[2]
	{%
		\csname cft#1contentsline\endcsname{##1##2}%
		\csname cft#1hypertitle\endcsname{##1}{##2}
	}
}

%\cftfigboxcontentsline{\@title@sep#2}\cftfigboxhypertitle{\@title@sep}{#2}
%-----------------------------------------------------------------------------------------------------------------------------------------%
\DeclareDocumentCommand{\cftXcreate}{o m m m m}%
{%	
	\IfValueTF{#1}%
		{\newlistentry[#1]{#2}{#3}{#4}}%
		{\newlistentry{#2}{#3}{#4}}%
	\cftXnamenum{#2}{#5}%
}
%-----------------------------------------------------------------------------------------------------------------------------------------%
\cftXcreate{testlist}{toc}{0}{testlistname}
\cftXcreate{figbox}{lof}{0}{Figbox}
\cftXcreate[figbox]{figboxfigure}{lof}{1}{Figure}
\cftXcreate{Matlablisting}{lol}{0}{Matlab Listing}
\cftXcreate{Terminallisting}{lol}{0}{Terminal Listing}
\cftXcreate{IBPtable}{lot}{0}{IBP Table}
%\cftXnamenum{figbox}{Figbox}
%\cftXnamenum{figboxfigure}{Figbox Figure}
%-----------------------------------------------------------------------------------------------------------------------------------------%
\newcommand{\figboxname}{\FigboxName}								% Figure toc title
\newcommand{\figboxfigurename}{\FigboxFigureName}								% Figure toc title
\newcommand{\Matlablistingname}{\MatlabListingName}								% Figure toc title
\newcommand{\Terminallistingname}{\TerminalListingName}								% Figure toc title
\newcommand{\IBPtablename}{\IBPtableName}								% Figure toc title
%-----------------------------------------------------------------------------------------------------------------------------------------%
%\newcommand{\figbox}[1]%
%{%
%	\refstepcounter{figbox}%
%	%\gdef\@currently@inside{figbox}%
%	\phantomsection\addcontentsline{lof}{figbox}%
%	{%
%		\protect\numberline{\thefigbox}%
%		\raisebox{\f@size pt}{%
%			\protect\hypertarget{figbox\thefigbox}{}%
%		}%
%		\figboxname\ \thefigbox#1%
%	}%
%	\ignorespaces%\xspace
%}
%-----------------------------------------------------------------------------------------------------------------------------------------%
%\newcommand{\figboxfigure}[1]%
%{%
%	\refstepcounter{figboxfigure}%
%	\gdef\@currently@inside{figboxfigure}%
%	\phantomsection\addcontentsline{lof}{figboxfigure}{\protect\numberline{\thefigboxfigure}#1}%
%	\ignorespaces%\xspace
%}
%-----------------------------------------------------------------------------------------------------------------------------------------%
%-----------------------------------------------------------------------------------------------------------------------------------------%
%-----------------------------------------------------------------------------------------------------------------------------------------%



\renewcommand{\cftaftertoctitle}{}
\renewcommand{\cftafterloftitle}{}
\renewcommand{\cftafterlottitle}{}
\renewcommand{\cftafterloltitle}{}
%-----------------------------------------------------------------------------------------------------------------------------------------%
\renewcommand{\cfttoctitlefont}{\anttmcap18pt}
\renewcommand{\cftloftitlefont}{\anttmcap14pt }
\renewcommand{\cftlottitlefont}{\anttmcap14pt }
\renewcommand{\cftloltitlefont}{\anttmcap14pt }
\renewcommand{\cftlistingsfont}{\anttmcap14pt }
\renewcommand{\cftprobstitlefont}{\anttmcap14pt }
\renewcommand{\cftproblemsfont}{\normalsize\bfseries}
\renewcommand{\cftproblempartssubproblemsfont}{\normalsize\bfseries}
\renewcommand{\cftsubproblempartsfont}{\normalsize\bfseries}
\renewcommand{\cftsubproblemsfont}{\normalsize\bfseries}
\renewcommand{\cftChapterfont}{\normalsize\bfseries}
\renewcommand{\cftSectionfont}{\normalsize\bfseries}
\renewcommand{\cftSubsectionfont}{\normalsize\bfseries}
\renewcommand{\cftTopicfont}{\normalsize\bfseries}
\renewcommand{\cftfigboxfont}{\normalsize\bfseries}
\renewcommand{\cftfigfont}{\normalsize\bfseries}
\renewcommand{\cfttabfont}{\LARGE\bfseries}
\renewcommand{\cftfigboxfigurefont}{\normalsize\bfseries}
\renewcommand{\cftMatlablistingfont}{\normalsize\bfseries}
\renewcommand{\cftTerminallistingfont}{\normalsize\bfseries}
%-----------------------------------------------------------------------------------------------------------------------------------------%
\renewcommand\cftparskip{1.5mm}								% Vertical skip before Table of Contents title
\renewcommand\cftparfillskip{1mm}								% Vertical skip before Table of Contents title
\setlength\cftbeforetoctitleskip{-5mm}							% Vertical skip before Table of Contents title
\setlength\cftbeforeloftitleskip{5.0mm}							% Vertical skip before Table of Contents title
\setlength\cftbeforelottitleskip{5.0mm}							% Vertical skip before Table of Contents title
\setlength\cftbeforeloltitleskip{5.0mm}							% Vertical skip before Table of Contents title
\setlength\cftbeforeprobstitleskip{5.0mm}							% Vertical skip before Table of Contents title
\setlength\cftbeforeChapterskip{2.5mm}							% Vertical skip before Table of Contents title
\setlength\cftaftertoctitleskip{-5mm}							% Vertical skip before Table of Contents title
\setlength\cftafterloftitleskip{2.5mm}							% Vertical skip before Table of Contents title
\setlength\cftafterlottitleskip{2.5mm}							% Vertical skip before Table of Contents title
\setlength\cftafterloltitleskip{2.5mm}							% Vertical skip before Table of Contents title
\setlength\cftafterprobstitleskip{2.5mm}							% Vertical skip before Table of Contents title
\newcommand*{\@Chapter@finish@skip}{\par\bigskip\bigskip}				% Vertical skip before Table of Contents title
\newcommand*{\@Section@finish@skip}{\par\bigskip}
\newcommand*{\@Subsection@finish@skip}{\par\bigskip}
\newcommand*{\@Topic@finish@skip}{\par\bigskip\bigskip}
%-----------------------------------------------------------------------------------------------------------------------------------------%
\setlength\cftChapterindent{0.0em}
\setlength\cftSectionindent{2.0em}
\setlength\cftSubsectionindent{4.0em}
\setlength\cftTopicindent{0.0em}
\setlength\cftfigindent{1.5em}
\setlength\cftfigboxindent{1.5em}
\setlength\cftfigboxfigureindent{3.0em}
\setlength\cftproblemsindent{1.5em}
\setlength\cftsubproblemsindent{3.0em}
\setlength\cftproblempartsindent{3.0em}
\setlength\cftsubproblemsindent{3.0em}
\setlength\cftproblempartssubproblemsindent{4.5em}
\setlength\cftsubproblempartsindent{4.5em}
\setlength\cftlistingsindent{1.5em}
\setlength\cftMatlablistingindent{1.5em}
\setlength\cftTerminallistingindent{1.5em}
%-----------------------------------------------------------------------------------------------------------------------------------------%
\renewcommand{\cftTopicdotsep}{4.5}
\renewcommand{\cftChapterdotsep}{\cftnodots}
%-----------------------------------------------------------------------------------------------------------------------------------------%
\renewcommand{\cftTopicleader}{\nobreak\cftdotfill{\cftTopicdotsep}\ }
\renewcommand{\cftChapterleader}{\nobreak\cftdotfill{\cftChapterdotsep}\ }
%-----------------------------------------------------------------------------------------------------------------------------------------%
%-----------------------------------------------------------------------------------------------------------------------------------------%
%-----------------------------------------------------------------------------------------------------------------------------------------%
\renewcommand{\contentsname}{\TOCName}
\renewcommand{\listtablename}{\LOTName}
\renewcommand{\listfigurename}{\LOFName}
\renewcommand{\nomname}{\AbbreviationsName}				% was \large
\renewcommand{\lstlistoflistings}{\listoflistings}					% ? print list of listings, defined to be an alias for \listoflistings (minted)
\renewcommand{\lstlistlistingname}{\LOLName} 			% The header name for the list of listings.
\newcommand{\listproblemsname}{\LOPName}				% List of homework problems/solutions
\renewcommand{\indexname}{\IndexName}
\renewcommand{\tablename}{\IBPtableName}							% Table toc title
\renewcommand{\figurename}{\FigureName}								% Figure toc title
\renewcommand\bibname{\BibName}								% Bibliography toc title
\renewcommand\partname{\PartName}									% Part toc title
\renewcommand\chaptername{\ChapterName}								% Chapter toc title		
\renewcommand\appendixname{\AppendixName}							% Appendix toc title
\renewcommand\abstractname{\AbstractName}							% Abstract toc title
%\renewcommand{\indexname}{Index}								% Index toc title
%\renewcommand{\tablename}{IBP Table}							% Table toc title
%\renewcommand{\figurename}{Figure}								% Figure toc title
%\renewcommand\bibname{Bibliography}								% Bibliography toc title
%\renewcommand\partname{Part}									% Part toc title
%\renewcommand\chaptername{Chapter}								% Chapter toc title		
%\renewcommand\appendixname{Appendix}							% Appendix toc title
%\renewcommand\abstractname{Abstract}							% Abstract toc title
\renewcommand{\lstlistingname}{\CodeListingName}  				% The caption label for listings.
%-----------------------------------------------------------------------------------------------------------------------------------------%
\ifcsdef{listoflistingscaption}								% Caption of listing float entry in ToC (minted)
	{\renewcommand{\listoflistingscaption}{\LOLName}}	%
	{\newcommand{\listoflistingscaption}{\LOLName}}		%	
\ifcsdef{listingscaption}									% Caption of listing float entry (minted)
	{\renewcommand{\listingscaption}{\CodeListingName}}			%
	{\newcommand{\listingscaption}{\CodeListingName}}			%
%-----------------------------------------------------------------------------------------------------------------------------------------%
\newcommand{\thelstlisting}{\arabic{lstlisting}} 					% prints the running number of the caption.
%\renewcommand{\thefigbox}{\arabic{@tcb@figbox@counter}}
%-----------------------------------------------------------------------------------------------------------------------------------------%
\renewcommand*{\indexspace}{\par\vspace{0pt plus 0pt minus 0pt}}			% \par\vspace{20pt plus 6pt minus 4pt}
\newcommand*{\IndexDotfill}{\nobreak\dotfill\ \nobreak}
%\renewcommand*{\glsgroupskip}{}
%\newcommand*{\glspostdescription}{%
%  \ifglsnopostdot\else.\spacefactor\sfcode`\. \fi
%}
\renewcommand{\glsnamefont}[1]{\textbfsf{#1}\normalfont}
\newcommand*{\@gls@navhyperlink@font}{\anttbcap12pt}
%-----------------------------------------------------------------------------------------------------------------------------------------%
\renewcommand*\tableofcontents
{%
    \if@twocolumn\@restonecoltrue\onecolumn
    \else\@restonecolfalse\fi
    \chapter*{\contentsname\@mkboth{\contentsname}{\contentsname}}%
    \@starttoc{toc}%
    \if@restonecol\twocolumn\fi
}
%*************************************************************************************************%
%********************************************************** Document sectioning command definitions **********************************************************%
%*************************************************************************************************%
%-----------------------------------------------------------------------------------------------------------------------------------------%
%                                 1 2  3 4 5
\DeclareDocumentCommand{\Chapter}{s t! o m d()}
{%*<clear page>!<add vskip after>[overwrite toc title]{Chapter title}(hypertarget label prefix)
	\IfBooleanTF{#1}{}{\clearpage}%
	\refstepcounter{Chapter}%
	\def\currentChaptername{#4}%
	\IfValueTF{#5}%
		{\hypertarget{\@Chapter@link@name#5}{}}%
		{\hypertarget{\@Chapter@link@name#4}{}}%
	\IfValueTF{#3}%
		{\phantomsection\addcontentsline{toc}{Chapter}{\protect\numberline{\theChapter}#3}}%
		{\phantomsection\addcontentsline{toc}{Chapter}{\protect\numberline{\theChapter}#4}}%
	\begin{tikzpicture}[remember picture, overlay]%
	    	\node[xshift=\@Chapter@heading@xshift, yshift=\@Chapter@heading@yshift] at (current page.north west)%
	      {%
	      	\begin{tikzpicture}[remember picture, overlay]%
	      		\draw[fill=chapterHeading-colback, line width=\@Chapter@heading@linewidth, draw=black]
					(0,0) rectangle (\@Chapter@heading@width, \@Chapter@heading@height);%
	      		\node%
	      		[%
	      			anchor=east, xshift=\@Chapter@heading@title@xshift, rectangle, fill=chapterHeading-colbacktitle, inner sep=\@Chapter@heading@inner@sep,
					rounded corners=\@Chapter@heading@rounded@corners, line width=\@Chapter@heading@title@linewidth, draw=chapterHeading-coldraw
				]	
				{\color{chapterHeading-coltitle}\sffamily\LARGE\bfseries\theChapter\ #4};%
	       	\end{tikzpicture}%
	     	 };%
	\end{tikzpicture}%
	%\begin{tikzpicture}[chapterFormatCode=#4]\end{tikzpicture}%\tikzset{chapterFormatCode=#4}%
	\IfBooleanTF{#2}{}{\@Chapter@finish@skip}%
	%\par\bigskip\bigskip\xspace%
}
%-----------------------------------------------------------------------------------------------------------------------------------------%
%                                 1 2  3 4   5
\DeclareDocumentCommand{\Section}{s t! m d() o}
{%*<clear page>!<add vskip after>{Section title}(hypertarget label prefix)[description text]
	\IfBooleanTF{#1}{\clearpage}{}%
	\refstepcounter{Section}%
	\def\currentSectionname{#3}%
	\IfValueTF{#4}%
		{\hypertarget{\@Section@link@name#4}{}}%
		{\hypertarget{\@Section@link@name#3}{}}%
	\IfValueTF{#4}%
		{\phantomsection\addcontentsline{toc}{Section}{\protect\numberline{\theSection}#4}}%
		{\phantomsection\addcontentsline{toc}{Section}{\protect\numberline{\theSection}#3}}%
	\IfValueTF{#5}%
		{\begin{tcbsection}{\tcbhyperlink[stddkblue]{PAGE0}{\shadowcolor{black}\shadowtext{\theSection\ : #3}}}[after skip=\@Section@after@skip]#5\end{tcbsection}}%
		{\begin{tcbsection}{\tcbhyperlink[stddkblue]{PAGE0}{\shadowcolor{black}\shadowtext{\theSection\ : #3}}}[bottom=0mm, after skip=\@Section@after@skip]\end{tcbsection}}%
	\fancyhead[L]{\@lhead@font\theSection\; \currentChaptername : #3}\xspace%
	\IfBooleanTF{#2}{}{\@Section@finish@skip}%
	%\ignorespaces\par\bigskip%\@Section@finish@skip
}
%-----------------------------------------------------------------------------------------------------------------------------------------%
%                                    1 2  3                  4 5   6
\DeclareDocumentCommand{\Subsection}{s t! D''{tcbBlueScheme} m d() o}
{%*<clear page>!<add vskip after>'color scheme'{Subsection title}(hypertarget label prefix)[description text]
	\tcbsetcurrentcolors{#3}%   	
	\IfBooleanTF{#1}{\par\bigskip}{}%
	\refstepcounter{Subsection}%
	\def\currentSubsectionname{#4}%
	\IfValueTF{#5}%
		{\hypertarget{\@Subsection@link@name#5}{}}%
		{\hypertarget{\@Subsection@link@name#4}{}}%
	\phantomsection\addcontentsline{toc}{Subsection}{\protect\numberline{\theSubsection}#4}%
	\savebox{\@frontbackmatter@savebox@}{\anttmcap14pt\theSubsection\ \ #4\hspace{2mm}}%
	\begin{tcolorbox}[tcbSubsectionStyle]%
		\usebox{\@frontbackmatter@savebox@}%
	\end{tcolorbox}%
	\fancyhead[L]{\@lhead@font\theSubsection\; \currentChaptername :  \currentSectionname, #4}%
	\IfBooleanTF{#2}{}{\@Subsection@finish@skip}%
	%\ignorespaces\par\bigskip\xspace%
}
%-----------------------------------------------------------------------------------------------------------------------------------------%
\DeclareDocumentCommand{\Topic}{s t! m d() o}
{%
	\IfBooleanTF{#1}{}{\clearpage}%
	\refstepcounter{Topic}%
	\def\currentChaptername{#4}%
	\IfValueTF{#5}%
		{\hypertarget{\@Topic@link@name#5}{}}%
		{\hypertarget{\@Topic@link@name#4}{}}%
	\IfValueTF{#3}%
		{\phantomsection\addcontentsline{toc}{Topic}{\protect\numberline{\theChapter}#3}}%
		{\phantomsection\addcontentsline{toc}{Topic}{\protect\numberline{\theChapter}#4}}%
	\begin{tikzpicture}[remember picture, overlay]%
	    	\node[xshift=\@Chapter@heading@xshift, yshift=\@Chapter@heading@yshift] at (current page.north west)%
	      {%
	      	\begin{tikzpicture}[remember picture, overlay]%
	      		\draw[fill=chapterHeading-colback, line width=\@Chapter@heading@linewidth, draw=black]
					(0,0) rectangle (\@Chapter@heading@width, \@Chapter@heading@height);%
	      		\node%
	      		[%
	      			anchor=east, xshift=\@Chapter@heading@title@xshift, rectangle, fill=chapterHeading-colbacktitle, inner sep=\@Chapter@heading@inner@sep,
					rounded corners=\@Chapter@heading@rounded@corners, line width=\@Chapter@heading@title@linewidth, draw=chapterHeading-coldraw
				]	
				{\color{chapterHeading-coltitle}\sffamily\LARGE\bfseries\scshape\theTopic\ #3};%
	       	\end{tikzpicture}%
	     	 };%
	\end{tikzpicture}%
	\IfBooleanTF{#2}{}{\@Topic@finish@skip}%
	%\par\bigskip\bigskip\xspace%
}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% Index/Glossary/Acronyms/Nomenclature style file generation %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newcommand{\problems}[1]%
{%
	\refstepcounter{problems}%
	%\gdef\@currently@inside{problems}%
	\phantomsection\addcontentsline{probs}{problems}{\protect\numberline{\theproblems}#1}%
	\ignorespaces%\xspace
}
%-----------------------------------------------------------------------------------------------------------------------------------------%
\newcommand{\subproblems}[1]
{%
	\refstepcounter{subproblems}%
	%\gdef\@currently@inside{subproblems}%
	\phantomsection\addcontentsline{probs}{subproblems}{\protect\numberline{\thesubproblems}#1}%
	\ignorespaces%\xspace
}
%-----------------------------------------------------------------------------------------------------------------------------------------%
\newcommand{\problemparts}[1]%
{%
	\refstepcounter{problemparts}%
	%\gdef\@currently@inside{problemparts}%
	\phantomsection\addcontentsline{probs}{problemparts}{\protect\numberline{\theproblemparts}#1}%
	\ignorespaces%\xspace
}
%-----------------------------------------------------------------------------------------------------------------------------------------%
\newcommand{\problempartssubproblems}[1]%
{%
	\refstepcounter{problempartssubproblems}%
	%\gdef\@currently@inside{problempartssubproblems}%	
	\phantomsection\addcontentsline{probs}{problempartssubproblems}%
	{%
		\protect\numberline{\theproblempartssubproblems}#1%
	}
	\ignorespaces%\xspace
}
%-----------------------------------------------------------------------------------------------------------------------------------------%
\newcommand{\subproblemparts}[1]%
{%
	\refstepcounter{subproblemparts}%
	%\gdef\@currently@inside{subproblemparts}%
	\phantomsection\addcontentsline{probs}{subproblemparts}{\protect\numberline{\thesubproblemparts}#1}%
	\ignorespaces%\xspace
}
%-----------------------------------------------------------------------------------------------------------------------------------------%
%*************************************************************************************************%
%***************************************************** make/add/print back matter definitions/commands  ******************************************************%
%*************************************************************************************************%
%-----------------------------------------------------------------------------------------------------------------------------------------%
%-----------------------------------------------------------------------------------------------------------------------------------------%
%-----------------------------------------------------------------------------------------------------------------------------------------%
%-----------------------------------------------------------------------------------------------------------------------------------------%
\DeclareDocumentCommand{\@automake@nomenclature}{G{my-nomencl.ist}}
{%makeindex -s my-nomencl.ist -t pCT_Data_Organization_Format.nlg  -o pCT_Data_Organization_Format.nls  pCT_Data_Organization_Format.nlo
	\edef\@gls@dothiswrite%
	{%
		\noexpand\write18%
		{%
			makeindex %
				-s my-nomencl.ist\space%
		       	-t \jobname.nlg\space%
		       	-o \jobname.nls\space%
		       	\jobname.nlo%
		}%
	}%
	\@gls@dothiswrite
}

\DeclareDocumentCommand{\makeFrontbackMatter}{}
{
  	\makenomenclature
	\@automake@nomenclature
	\makeglossaries\glsaddall
	\makeindex[title={\@index@toctitle}, columns=2, columnseprule=true, intoc, options= -s my-index.mst]
}
%-----------------------------------------------------------------------------------------------------------------------------------------%
\DeclareDocumentCommand{\addTOC}{}
{
	\tableofcontents
	\addtocontents{toc}{~\hfill\textbf{Page}\par}
	%\addcontentsline{toc}{chapter}{Bibliography}
	%\addcontentsline{toc}{subsection}{Preface}		
}
\DeclareDocumentCommand{\addFrontbackMatter}{}
{
	\iftotalfigures\listoffigures\fi
	\iftotaltables\listoftables\fi
	\iftotallstlistings\lstlistoflistings\fi						%\listoflistings	% minted
	\iftotal@count@problems\listofproblems\fi
	\clearpage\hypertarget{\@page@one@target@name}{}%			
}
%-----------------------------------------------------------------------------------------------------------------------------------------%
\DeclareDocumentCommand{\printFrontbackMatter}{}
{
	%\clearpage
	\cleardoublepage
	\setcounter{page}{0}
	\if@roman@backmatter@option@
		\pagenumbering{roman}
	\fi			
	%-----------------------------------------------------------------------------------------------------------------------------------%
	\clearpage
	\printsymbols[title={\@listof@symbols@toctitle}, toctitle={\@listof@symbols@toctitle}]
	%\printglossary[type=symbols,title={\@listof@symbols@toctitle}, toctitle={\@listof@symbols@toctitle}]
%-----------------------------------------------------------------------------------------------------------------------------------%
	\clearpage
	\printacronyms[title={\@listof@acronyms@toctitle}, toctitle={\@listof@acronyms@toctitle}]
	\clearpage
	\printnomenclature	
	%-----------------------------------------------------------------------------------------------------------------------------------%
	\clearpage
	\printglossary[type=\glsdefaulttype, title={\@glossary@toctitle},toctitle={\@glossary@toctitle}]					
	%-----------------------------------------------------------------------------------------------------------------------------------%
	\clearpage
	\printindex%
}
%-----------------------------------------------------------------------------------------------------------------------------------------%
%-----------------------------------------------------------------------------------------------------------------------------------------%
%-----------------------------------------------------------------------------------------------------------------------------------------%
\DeclareDocumentCommand{\IndexHeading}{m}
{%	
	\setlength{\@macro@skip}{\baselineskip}
	\setlength{\baselineskip}{\@idx@baseline@skip}
	\thispagestyle{fancy}%
	\par\vskip\@idx@before@group@label@skip%
	\ifnumcomp{\value{@index@entry@counter}}{>}{0}%
	{%
		\hspace{-7.0mm}%
		\tikz\node%
		[%
			rounded corners=5pt, draw=tcbIndexStyle-coldraw, fill=tcbIndexStyle-colfill, inner sep=5pt,
			line width=1pt, align=center, font=\sffamily\bfseries\large, minimum width=\linewidth-\pgflinewidth%
		] {#1};%
	}%
      {%
      	\tikz\node%
      	[%
      		rounded corners=5pt, draw=tcbIndexStyle-coldraw, fill=tcbIndexStyle-colfill, inner sep=5pt, xshift=4mm,
		    line width=1pt, align=center, font=\sffamily\bfseries\large, minimum width=\linewidth-\pgflinewidth%
		] {#1};%
	}%
  	\par\vskip\@idx@after@group@label@skip%
  	\fancyhead[L]{\@lhead@font\@index@lhead@title\xspace}%
	\addtocounter{@index@entry@counter}{1}%	
}
%-----------------------------------------------------------------------------------------------------------------------------------------%
%*************************************************************************************************%
%************************************************ Index/Glossary/Acronyms/Nomenclature style file generation *************************************************%
%*************************************************************************************************%
%-----------------------------------------------------------------------------------------------------------------------------------------%
%\catcode`!=12 title={\\linkedindextitle\\anttmcap18pt\\IndexName}
%\catcode`\$=\active
\catcode`|=12
%\IfFileExists{my-index.mst}{}
%{%\toctitletarget
\begin{filecontents*}{my-index.mst}
	preamble "\\begin{tcolorbox}[indexStyle, title={\\linkedindextitle\\anttmcap18pt\\IndexName}, before=\\par\\smallskip, after=\\par\\smallskip, fonttitle=\\Large\\bfseries]
			\\begin{theindex}"
	postamble "\\end{theindex}\\end{tcolorbox}"
	delim_0 "\\space\\IndexDotfill "
	delim_1 "\\space\\IndexDotfill "
	headings_flag 1
	heading_prefix "  \\addtocounter{@index@entry@counter}{-1}\\IndexHeading{"
	heading_suffix "}\n"
\end{filecontents*}
%}
%-----------------------------------------------------------------------------------------------------------------------------------------%
%-----------------------------------------------------------------------------------------------------------------------------------------%
%-----------------------------------------------------------------------------------------------------------------------------------------%
\begin{filecontents*}{my-glossaries.ist}
	actual '?'
	encap '|'
	level '!'
	quote '"'
	keyword "\\glossaryentry"
	preamble "\\glossarypreamble\n\\begin{tcolorbox}[glossariesStyle, before=\\par\\smallskip, after=\\par\\smallskip, fonttitle=\\Large\\bfseries,
		fontupper=\\normalsize\\normalfont, title={\\phantomsection\\glossarysection[\\glossarytoctitle]{\\linkedglossarytitle\\anttmcap18pt\\glossarytitle}}]
		\\begin{theglossary}\\glossaryheader\n"
	postamble "\%\n\\end{theglossary}\\end{tcolorbox}\\glossarypostamble\n"
	group_skip "\\glsgroupskip\n"
	item_0 "\%\n"
	item_1 "\%\n"
	item_2 "\%\n"
	item_01 "\%\n"
	item_x1 "\\relax \\glsresetentrylist\n"
	item_12 "\%\n"
	item_x2 "\\relax \\glsresetentrylist\n"
	delim_0 " \{\\glossaryentrynumbers\{\\relax "
	delim_1 " \{\\glossaryentrynumbers\{\\relax "
	delim_2 " \{\\glossaryentrynumbers\{\\relax "
	delim_t "\}\}"
	delim_n "\\delimN "
	delim_r "\\delimR "
	headings_flag 1
	heading_prefix "  \\glsgroupheading\{"
	heading_suffix "\}\n\\relax\\glsresetentrylist"
	symhead_positive "glssymbols"
	numhead_positive "glsnumbers"
	page_compositor "."
	suffix_2p ""
	suffix_3p ""
\end{filecontents*}
%-----------------------------------------------------------------------------------------------------------------------------------------%
%-----------------------------------------------------------------------------------------------------------------------------------------%
%-----------------------------------------------------------------------------------------------------------------------------------------%
%\IfFileExists{my-nomencl.ist}{}
%{%
\begin{filecontents*}{my-nomencl.ist}
%% ---- for input file ----
keyword    "\\nomenclatureentry"
%% Germans might want to change this and delete the two %% quote '"'
%% ---- for output file ----
preamble   "\\begin{tcolorbox}[nomenclatureStyle, title={\\nomhypertitle\\anttmcap18pt\\nomname}, before=\\par\\smallskip, after=\\par\\smallskip, fonttitle=\\Large\\bfseries]%
		\\begin{thenomenclature} \n"%
postamble  "\n\n\\end{thenomenclature}\\end{tcolorbox}\n"
group_skip "\n"
delim_0    ""
delim_1    ""
delim_2    ""
%% The next lines will produce some warnings when running Makeindex as they try to cover two different versions of the program:
%lethead_prefix "\n \\nomgroup{"
%lethead_suffix "}\n"
%lethead_flag   1
heading_prefix "\n \\nomgroup{"
heading_suffix "}\n"
headings_flag  1
\end{filecontents*}
%}
%-----------------------------------------------------------------------------------------------------------------------------------------%
%*************************************************************************************************%
%************************************************* End of 'frontbackmatter.sty' package **************************************************%
%*************************************************************************************************%
% Change @ character back to \catcode'@=12, i.e. a non letter character, so it can be used in macro names/definitions
\catcode`|=\active
\makeatother
\endinput
%-----------------------------------------------------------------------------------------------------------------------------------------%
