%******************************************************************************************************************************%
%********************************************************** `frontbackmatter.sty' ********************************************************%
%******************************************************************************************************************************%
% Provides macros/commands for adding, configuring, and printing the Table of Contents and back matter material (e.g. index, glossary, acronym/symbol/abbreviation lists, etc.).  The entries added to the Table of Contents and its settings/appearance are configured using the 'tocloft' package and additional supplemental macros/commands designed to interact/interface with the package.  The back matter material is added, configured, and printed using the 'my-glossaries', 'my-imakeidx', and 'my-nomencl' packages (where each 'my-X' package is an adaptation of the 'X' package) as well as the definitions/macros/commands which these packages depend/rely on.
%******************************************************************************************************************************%
%********************************** Define provided package name and LaTeX/package dependencies *******************************%
%******************************************************************************************************************************%
\NeedsTeXFormat{LaTeX2e}[2005/12/01]
\ProvidesPackage{frontbackmatter}
%******************************************************************************************************************************%
%************************************* Package options and corresponding Boolean variables ************************************%
%******************************************************************************************************************************%
%------------------------------------------------------------------------------------------------------------------------------%
\DeclareOption*{\PackageWarning{frontbackmatter}{Unknown `\CurrentOption'}}
%******************************************************************************************************************************%
%************************************************ Processing of package options ***********************************************%
%******************************************************************************************************************************%
\ProcessOptions\relax
%------------------------------------------------------------------------------------------------------------------------------%
\makeatletter                                   % Change @ to standard letter, \catcode'@=11 so it can be used in macro names/definition
\catcode`|=12
%\catcode`\!=12
%******************************************************************************************************************************%
%******************************************************** Package Body ********************************************************%
%******************************************************************************************************************************%
%%\captionsetup[longtable]{labelfont=bf,textfont=it,labelsep=newline}
%\contentsuse{name}{ext}
%\indexsetup{level=\section*,toclevel=section,noclearpage}
\tocloftpagestyle{empty}
\renewcommand{\@cfttocfinish}{\thispagestyle{empty}\if@cfthaschapter\if@restonecol\twocolumn\fi\fi\setcounter{page}{0}}
\def\@gls@glossary@style{alttreehypergroup}                     % Glossary style (my-glossary-tree.sty) Alternative: Indexhypergroup
%\def\@gls@glossary@style{indexhypergroup}
\setglossarystyle{\@gls@glossary@style}
%\setStyleFile{my-glossaries}
%\def\istfilename{my-glossaries.ist}    %------------------------------------------------------------------------------------------------------------------------------%
\newcommand{\tocnumbersoff}[1]
{
	\IfStrEqCase{#1}%
        {%
                {chapter}{\setcounter{chapnumdepth}{0}}%
                {section}{\setcounter{secnumdepth}{0}}%
                {subsection}{\setcounter{subsecnumdepth}{0}}%
                {subsubsection}{\setcounter{subsubsecnumdepth}{0}}%
                {paragraph}{\setcounter{paranumdepth}{0}}%
                {subparagraph}{\setcounter{subparanumdepth}{0}}%
                {figure}{\setcounter{fignumdepth}{0}}%
                {subfigure}{\setcounter{subfignumdepth}{0}}%
                {table}{\setcounter{tabnumdepth}{0}}%
                {subtable}{\setcounter{subtabnumdepth}{0}}%
        }%
        [{\setcounter{#1numdepth}{0}}]%
}
\setcounter{tocdepth}{4}
\setcounter{lofdepth}{4}
%\setcounter{loldepth}{4}
\setcounter{probsdepth}{4}
%\tocnumbersoff{section}
%\setcounter{secnumdepth}{0}
%------------------------------------------------------------------------------------------------------------------------------%
%------------------------------------------------------------------------------------------------------------------------------%
%------------------------------------------------------------------------------------------------------------------------------%
\renewcommand{\cftaftertoctitle}{}
\renewcommand{\cftafterloftitle}{}
\renewcommand{\cftafterlottitle}{}
\renewcommand{\cftafterloltitle}{}
%------------------------------------------------------------------------------------------------------------------------------%
\renewcommand{\cfttoctitlefont}{\cftbigfont}
\renewcommand{\cftloftitlefont}{\cftmedfont}
\renewcommand{\cftlottitlefont}{\cftmedfont}
\renewcommand{\cftloltitlefont}{\cftmedfont}
\renewcommand{\cftprobstitlefont}{\cftmedfont}
%------------------------------------------------------------------------------------------------------------------------------%
\renewcommand{\cftlistingsfont}{\normalsize\bfseries}
\renewcommand{\cftproblemsfont}{\normalsize\bfseries}
\renewcommand{\cftchapterproblemsfont}{\normalsize\bfseries}
\renewcommand{\cftproblempartssubproblemsfont}{\normalsize\bfseries}
\renewcommand{\cftsubproblempartsfont}{\normalsize\bfseries}
\renewcommand{\cftsubproblemsfont}{\normalsize\bfseries}
\renewcommand{\cftfigfont}{\normalsize\bfseries}
\renewcommand{\cfttabfont}{\normalsize\bfseries}%{\LARGE\bfseries}
%------------------------------------------------------------------------------------------------------------------------------%
\renewcommand\cftparskip{1.5mm}                                                  % Vertical skip before Table of Contents title
\renewcommand\cftparfillskip{1mm}                                              % Vertical skip before Table of Contents title
\setlength\cftbeforetoctitleskip{-5mm}                                    % Vertical skip before Table of Contents title
\setlength\cftaftertoctitleskip{-5mm}                                      % Vertical skip before Table of Contents title
\setlength\cftbeforeloftitleskip{5.0mm}                                      % Vertical skip before Table of Contents title
\setlength\cftbeforelottitleskip{5.0mm}                                     % Vertical skip before Table of Contents title
\setlength\cftbeforeloltitleskip{5.0mm}                                       % Vertical skip before Table of Contents title
\setlength\cftbeforeprobstitleskip{5.0mm}                                   % Vertical skip before Table of Contents title
\setlength\cftafterloftitleskip{2.5mm}                                     % Vertical skip before Table of Contents title
\setlength\cftafterlottitleskip{2.5mm}                                     % Vertical skip before Table of Contents title
\setlength\cftafterloltitleskip{2.5mm}                                  % Vertical skip before Table of Contents title
\setlength\cftafterprobstitleskip{2.5mm}                                  % Vertical skip before Table of Contents title
%------------------------------------------------------------------------------------------------------------------------------%
\setlength\cftbeforeChapterskip{2.5mm}                                       % Vertical skip before Table of Contents title
\setlength\cftbeforechapskip{2.5mm}                                       % Vertical skip before Table of Contents title
\setlength\cftbeforePartskip{2.5mm}                                       % Vertical skip before Table of Contents title
\setlength\cftbeforeTopicskip{2.5mm}                                       % Vertical skip before Table of Contents title
%------------------------------------------------------------------------------------------------------------------------------%
%\setlength\cftchapindent{1.5em}
%\setlength\cftsecindent{3.0em}
\setlength\cftfigindent{1.5em}
\setlength\cftproblemsindent{0em}
\setlength\cftchapterproblemsindent{0em}
\setlength\cftsubproblemsindent{1.5em}
\setlength\cftproblempartsindent{1.5em}
\setlength\cftproblempartssubproblemsindent{3.0em}
\setlength\cftsubproblempartsindent{3.0em}
\setlength\cftlistingsindent{1.5em}
%------------------------------------------------------------------------------------------------------------------------------%
\renewcommand{\cftPartdotsep}{\cftnodots}
\renewcommand{\cftTopicdotsep}{\cftnodots}
%\renewcommand{\cftChapterdotsep}{\cftnodots}
%------------------------------------------------------------------------------------------------------------------------------%
\renewcommand{\cftPartleader}{\nobreak\cftdotfill{\cftPartdotsep}\space}
\renewcommand{\cftTopicleader}{\nobreak\cftdotfill{\cftTopicdotsep}\space}
\renewcommand{\cftChapterleader}{\nobreak\cftdotfill{\cftChapterdotsep}\space}
%------------------------------------------------------------------------------------------------------------------------------%
%\setlength{\cftchapterproblemsnumwidth}{2.0em}
%\setlength{\cftproblemsnumwidth}{2.0em}
%\setlength{\cftfigboxfigurenumwidth}{40.5em}
%\addtolength{\cftfigboxfigurenumwidth}{5.5em}
%\setlength{\cftPartnumwidth}{4.0em}
%\setlength{\cftTopicnumwidth}{4.0em}
%------------------------------------------------------------------------------------------------------------------------------%
%------------------------------------------------------------------------------------------------------------------------------%
%------------------------------------------------------------------------------------------------------------------------------%
\renewcommand{\contentsname}{\TOCName}
\renewcommand{\listtablename}{\LOTName}
\renewcommand{\listfigurename}{\LOFName}
\renewcommand{\nomname}{\AbbreviationsName}                     % was \large
\renewcommand{\lstlistoflistings}{\listoflistings}              % ? print list of listings, defined to be an alias for \listoflistings (minted)
\renewcommand{\lstlistlistingname}{\LOLName}                    % The header name for the list of listings.
\newcommand{\listproblemsname}{\LOPName}                        % List of homework problems/solutions
\newcommand{\listfunctionsname}{\LODName}                        % List of homework problems/solutions
\renewcommand{\indexname}{\IndexName}
%\renewcommand{\indexname}{}
%------------------------------------------------------------------------------------------------------------------------------%
\renewcommand\bibname{\BibName}                                 % Bibliography toc title
\renewcommand\appendixname{\AppendixName}                       % Appendix toc title
\renewcommand\abstractname{\AbstractName}                       % Abstract toc title
%------------------------------------------------------------------------------------------------------------------------------%
\ifcsdef{listoflistingscaption}                                 % Caption of listing float entry in ToC (minted)
        {\renewcommand{\listoflistingscaption}{\LOLName}}       %
        {\newcommand{\listoflistingscaption}{\LOLName}}         %
\ifcsdef{listingscaption}                                       % Caption of listing float entry (minted)
        {\renewcommand{\listingscaption}{\CodeListingName}}     %
        {\newcommand{\listingscaption}{\CodeListingName}}       %
%------------------------------------------------------------------------------------------------------------------------------%
\newrobustcmd{\toctitletarget}[1]%
{%
        \phantomsection\addcontentsline{toc}{chapter}{#1}\cftbigfont #1%
}
\renewcommand*{\indexspace}{\par\vspace{0pt plus 0pt minus 0pt}}        % \par\vspace{20pt plus 6pt minus 4pt}
\newcommand*{\IndexDotfill}{\nobreak\dotfill\ \nobreak}
\newcommand \Dotfill {\leavevmode \cleaders \hb@xt@ .33em{\hss .\hss }\hfill \kern \z@}
\renewcommand{\glsnamefont}[1]{\textbfmsf{#1}\normalfont}
\newcommand*{\@gls@navhyperlink@font}{\navhyperlinkfont}
\newcommand*{\fbm@dotfill}{\nobreak\,\dotfill\space\nobreak}%
\newcommand*{\fbm@nofill}{,\space}%
%------------------------------------------------------------------------------------------------------------------------------%
\renewcommand*\tableofcontents
{%
    \pagestyle{empty}\if@twocolumn\@restonecoltrue\onecolumn
    \else\@restonecolfalse\fi
    \chapter*{\contentsname\@mkboth{\contentsname}{\contentsname}}%
    \@starttoc{toc}%
    \pagestyle{empty}\if@restonecol\twocolumn\fi
}
%------------------------------------------------------------------------------------------------------------------------------%
%~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~%
%~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ Document sectioning command definitions ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~%
%~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~%
%------------------------------------------------------------------------------------------------------------------------------%
%------------------------------------------------------------------------------------------------------------------------------%
%------------------------------------------------------------------------------------------------------------------------------%
%------------------------------------------------------------------------------------------------------------------------------%
%------------------------------------------------------------------------------------------------------------------------------%
\DeclareDocumentCommand{\@backmatter@group@label@node}{m}
{%
        \tikz\node%
        [%
                rounded corners=5pt, draw=tcbIndexColorset-coldraw, fill=tcbIndexColorset-colfill, inner sep=5pt,%
                line width=1pt, align=center, font=\@frontbackmatter@group@label@font, minimum width=\linewidth+\pgflinewidth%
        ]%
        {#1};%
}
%------------------------------------------------------------------------------------------------------------------------------%
\DeclareDocumentCommand{\IndexHeading}{m}
{%
        \setlength{\@macro@skip}{\baselineskip}
        \setlength{\baselineskip}{\@idx@baseline@skip}
        \par\vskip\@idx@before@group@label@skip%
        \ifnumcomp{\value{@index@entry@counter}}{>}{0}%
                {\hspace{-7.0mm}\@backmatter@group@label@node{#1}}%
                {\@backmatter@group@label@node{#1}}%
        \par\vskip\@idx@after@group@label@skip%
        \thispagestyle{fancy}\fancyhead[L]{\@lhead@font\@index@lhead@title}%
        \addtocounter{@index@entry@counter}{1}%
}
%------------------------------------------------------------------------------------------------------------------------------%
%******************************************************************************************************************************%
%******************************************* make/add/print back matter definitions/commands  ********************************************%
%******************************************************************************************************************************%
\DeclareDocumentCommand{\@automake@nomenclature}{G{my-nomencl.ist}}
{%makeindex -s my-nomencl.ist -t pCT_Data_Organization_Format.nlg  -o pCT_Data_Organization_Format.nls  pCT_Data_Organization_Format.nlo
        \edef\@gls@dothiswrite%
        {%
                \noexpand\write18%
                {%
                        makeindex %
                                -s my-nomencl.ist\space%
                        -t \jobname.nlg\space%
                        -o \jobname.nls\space%
                        \jobname.nlo%
                }%
        }%
        \@gls@dothiswrite
}

\DeclareDocumentCommand{\makeFrontbackMatter}{}
{
        \makenomenclature
        \@automake@nomenclature
        \makeglossaries\glsaddall
        \makeindex[title={\@index@toctitle}, columns=2, columnseprule=true, intoc, options= -s my-index.mst]
}
%------------------------------------------------------------------------------------------------------------------------------%
\DeclareDocumentCommand{\addTOC}{}
{
        \tableofcontents
        \addtocontents{toc}{~\hfill\textbf{Page}\par}
        %\addcontentsline{toc}{chapter}{Bibliography}
        %\addcontentsline{toc}{subsection}{Preface}
}
\DeclareDocumentCommand{\addFrontbackMatter}{}
{
        \iftotalfigures\listoffigures\fi
        \iftotaltables\listoftables\fi
        \iftotallstlistings\lstlistoflistings\fi                                                %\listoflistings        % minted
        \iftotal@count@problems\listofproblems\fi
        \clearpage\hypertarget{\@page@one@target@name}{}%
}
%------------------------------------------------------------------------------------------------------------------------------%
\DeclareDocumentCommand{\printFrontbackMatter}{}
{
        \ifmylatex@fncychap\remove@fncychap\fi
        %\clearpage
        \cleardoublepage
        \setcounter{page}{1}
        \ifmylatex@backpagenumbering\pagenumbering{\mylatex@backpagenumbering}\fi
        %-----------------------------------------------------------------------------------------------------------------------------------%
        \clearpage
        \printsymbols[title={\@listof@symbols@toctitle}, toctitle={\@listof@symbols@toctitle}]
        %\printglossary[type=symbols,title={\@listof@symbols@toctitle}, toctitle={\@listof@symbols@toctitle}]
%-----------------------------------------------------------------------------------------------------------------------------------%
        \clearpage
        \printacronyms[title={\@listof@acronyms@toctitle}, toctitle={\@listof@acronyms@toctitle}]
        \clearpage
        \printnomenclature
        %-----------------------------------------------------------------------------------------------------------------------------------%
        \clearpage
        \printglossary[type=\glsdefaulttype, title={\@glossary@toctitle},toctitle={\@glossary@toctitle}]
        %-----------------------------------------------------------------------------------------------------------------------------------%
        %\clearpage
        \printindex%
}
%******************************************************************************************************************************%
%************************************** Index/Glossary/Acronyms/Nomenclature style file generation ***************************************%
%******************************************************************************************************************************%
%------------------------------------------------------------------------------------------------------------------------------%
%\catcode`!=12
%\catcode`\$=\active
\catcode`|=12
%\IfFileExists{my-index.mst}{}
%{
\begin{filecontents*}{my-index.mst}
        preamble "\\begin{tcolorbox}[indexStyle, title={\\raggedright\\toctitletarget{\\IndexName}}, before=\\par\\smallskip, after=\\par\\smallskip, fonttitle=\\Large\\bfseries]
                        \\begin{theindex}"
        postamble "\\end{theindex}\\end{tcolorbox}"
        delim_0 "\\space\\IndexDotfill "
        delim_1 "\\space\\IndexDotfill "
        headings_flag 1
        heading_prefix "  \\addtocounter{@index@entry@counter}{-1}\\IndexHeading{"
        heading_suffix "}\n"
\end{filecontents*}
%}
%------------------------------------------------------------------------------------------------------------------------------%
%------------------------------------------------------------------------------------------------------------------------------%
%------------------------------------------------------------------------------------------------------------------------------%
\begin{filecontents*}{my-glossaries.ist}
        actual '?'
        encap '|'
        level '!'
        quote '"'
        keyword "\\glossaryentry"
        preamble "\\glossarypreamble\n%
                \\begin{tcolorbox}%
                [%
                        glossariesStyle, before=\\par\\smallskip, after=\\par\\smallskip,
                        fonttitle=\\Large\\bfseries, fontupper=\\normalsize\\normalfont,
                        title={\\phantomsection\\glossarysection[\\glossarytoctitle]{\\linkedglossarytitle\\cftbigfont\\glossarytitle}}%
                ]
                \\begin{theglossary}\\glossaryheader\n"
        postamble "\%\n\\end{theglossary}\\end{tcolorbox}\\glossarypostamble\n"
        group_skip "\\glsgroupskip\n"
        item_0 "\%\n"
        item_1 "\%\n"
        item_2 "\%\n"
        item_01 "\%\n"
        item_x1 "\\relax \\glsresetentrylist\n"
        item_12 "\%\n"
        item_x2 "\\relax \\glsresetentrylist\n"
        delim_0 " \{\\glossaryentrynumbers\{\\relax "
        delim_1 " \{\\glossaryentrynumbers\{\\relax "
        delim_2 " \{\\glossaryentrynumbers\{\\relax "
        delim_t "\}\}"
        delim_n "\\delimN "
        delim_r "\\delimR "
        headings_flag 1
        heading_prefix "  \\glsgroupheading\{"
        heading_suffix "\}\n\\relax\\glsresetentrylist"
        symhead_positive "glssymbols"
        numhead_positive "glsnumbers"
        page_compositor "."
        suffix_2p ""
        suffix_3p ""
\end{filecontents*}
%------------------------------------------------------------------------------------------------------------------------------%
%------------------------------------------------------------------------------------------------------------------------------%
%------------------------------------------------------------------------------------------------------------------------------%
%\IfFileExists{my-nomencl.ist}{}
%{%
\begin{filecontents*}{my-nomencl.ist}
        keyword    "\\nomenclatureentry"
        preamble   "\\begin{tcolorbox}[nomenclatureStyle, title={\\toctitletarget{\\nomname}}, before=\\par\\smallskip, after=\\par\\smallskip, fonttitle=\\Large\\bfseries]%
                        \\begin{thenomenclature} \n"%
        postamble  "\n\n\\end{thenomenclature}\\end{tcolorbox}\n"
        group_skip "\n"
        delim_0    ""
        delim_1    ""
        delim_2    ""
        %% The next lines will produce some warnings when running Makeindex as they try to cover two different versions of the program:
        %lethead_prefix "\n \\nomgroup{"
        %lethead_suffix "}\n"
        %lethead_flag   1
        heading_prefix "\n \\nomgroup{"
        heading_suffix "}\n"
        headings_flag  1
\end{filecontents*}
%}
%------------------------------------------------------------------------------------------------------------------------------%
%******************************************************************************************************************************%
%************************************************* End of 'frontbackmatter.sty' package **************************************************%
%******************************************************************************************************************************%
% Change @ character back to \catcode'@=12, i.e. a non letter character, so it can be used in macro names/definitions
\catcode`|=\active
\makeatother
\endinput
%------------------------------------------------------------------------------------------------------------------------------%
