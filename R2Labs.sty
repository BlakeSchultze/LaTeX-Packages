%*******************************************************************************************************************************%
%******************************************************* `my-latex.sty' ********************************************************%
%*******************************************************************************************************************************%
% Top level "super package" encapsulating the various component (sub)packages, each being responsible for a particular aspect/application, and providing access to the \documentclass and (sub)package options through corresponding 'my-latex' package options: adding "\RequirePackage[option list]{my-latex}" to a LaTeX document loads 'my-latex' and its component (sub)packages and the options specified in the "option list" are then forwarded to the relevant (sub)packages.  The package options corresponding to \documentclass and component package options are then applied directly, while those associated with lower level (sub)packages are propagated to the corresponding (sub)packages, either (1) directly as an explicit package option at the point where they're loaded or (2) indirectly through appropriate register variables (typically Booleans) and/or control sequence definitions. This hierarchal design is a convenient mechanism for providing centralized control over various options/settings and because the register variables and control sequences used to propagate package options have global scope, a low-level subpackage can access these directly without requiring they be passed explicitly through each level of the (sub)package hierarchy as additional package options.
%
% A similar structural scheme is used to provide centralized control over the behavior/appearance of content generated by various (sub)package macros/commands/environments, most notably environments containing 'tcolorbox' and/or 'tikz'/'pgf' content and the front/back matter content generated as part of the Table of Contents and associated glossary/acronym/symbol/index entry lists.  The corresponding register variables and general/universal macros, commands, and other global definitions/settings (e.g. those associated with lists, links, graphics/floats, etc.) used to control behavior/appearance are defined/implemented in the high-level 'my-definitions' component package.  Separating these from their application provides centralized control of nearly all settings/behavior/appearance through a single package, making it much easier to locate and modify the register variable or control sequence controlling the setting/property of interest, but it also improves the organizational scheme of the other (sub)packages.
%
% Note that the order in which the /documentclass related options/properties are applied and the order in which the component packages are loaded here is important; although there is some flexibility in this ordering, the dependencies between these component packages imposes a strict load order on most of these packages and this ordering should not be modified.  There are some unexpected dependencies on the 'my-glossaries' package which have yet to be identified but as long as the current ordering is maintained, this does not cause a problem.
%*******************************************************************************************************************************%
%******************************** Define provided package name and LaTeX/package dependencies **********************************%
%*******************************************************************************************************************************%
\NeedsTeXFormat{LaTeX2e}[2005/12/01]
\ProvidesPackage{R2Labs}
\RequirePackage{pkgbase}                                % Defines two new "for" loop commands: \foreach and \breakforeach
\RequirePackage{pkgopts}                                % Defines two new "for" loop commands: \foreach and \breakforeach
%-------------------------------------------------------------------------------------------------------------------------------%
\makeatletter                                           % Change @ -> catcode'@=11 (letter) for use in macro names/definition
%-------------------------------------------------------------------------------------------------------------------------------%
\pkgload@font                                           % Load default font: Computer Modern Roman (cmr)
\RequirePackageList{\@pkgopts@packages}                 % Load min set of packages needed to define/process package user options
%-------------------------------------------------------------------------------------------------------------------------------%
%*******************************************************************************************************************************%
%*********************** Package option definitions/initializations and corresponding Boolean variables ************************%
%*******************************************************************************************************************************%
%-------------------------------------------------------------------------------------------------------------------------------%
\SetupKeyvalOptions{family=mylatex, prefix=mylatex@}
%-------------------------------------------------------------------------------------------------------------------------------%
\DeclareBoolOption{report}
\DeclareBoolOption{article}%
\DeclareBoolOption{isorot}
\DeclareBoolOption[false]{countinchaps}
\DeclareBoolOption[false]{localpkg}
%-------------------------------------------------------------------------------------------------------------------------------%
\DeclareComplementaryOption{rotating}{isorot}
\DeclareComplementaryOption{libpkg}{localpkg}
%-------------------------------------------------------------------------------------------------------------------------------%
\DeclareBoolOptionPair[false]{pkgtest}
\DeclareBoolOptionPair[false]{crop}
\DeclareBoolOptionPair[false]{landscape}
\DeclareBoolOptionPair[false]{twocolumn}
\DeclareBoolOptionPair[true]{standalone}
\DeclareBoolOptionPair[true]{coverpage}
\DeclareBoolOptionPair[true]{toc}
\DeclareBoolOptionPair[true]{frontbackmatter}
\DeclareBoolOptionPair[true]{automake}
\DeclareBoolOptionPair[true]{FBM@dotfill}
\DeclareBoolOptionPair[false]{FBM@clearpage}
%-------------------------------------------------------------------------------------------------------------------------------%
\DeclareVoidOption{xindy}{\PassOptionsToPackage{xindy}{imakeidx-patched}}
\DeclareVoidOption{texindy}{\PassOptionsToPackage{texindy}{imakeidx-patched}}
\DeclareVoidOption{truexindy}{\PassOptionsToPackage{truexindy}{imakeidx-patched}}
\DeclareVoidOption{makeindex}{\PassOptionsToPackage{makeindex}{imakeidx-patched}}
\DeclareVoidOption{noautomatic}{\PassOptionsToPackage{noautomatic}{imakeidx-patched}}
\DeclareVoidOption{nonewpage}{\PassOptionsToPackage{nonewpage}{imakeidx-patched}}
\DeclareVoidOption{splitindex}{\PassOptionsToPackage{splitindex}{imakeidx-patched}}
\DeclareVoidOption{original}{\PassOptionsToPackage{original}{imakeidx-patched}}
\DeclareVoidOption{quiet}{\PassOptionsToPackage{quiet}{imakeidx-patched}}
%-------------------------------------------------------------------------------------------------------------------------------%
\DeclareStringOption[glsentries]{glsdefsfile}[glsentries]
\DeclareStringOption{documentclass}[report]
%\DeclareStringOption{fontfamily}[cmr]
\DeclareStringOption[10]{fontsize}[10]
\DeclareStringOption{font}
%\DeclareStringOption[(OT1,cmr,m,n,10)]{font}[(OT1,cmr,m,n,10)]
\DeclareStringOption[]{pkgdir}[.]
%-------------------------------------------------------------------------------------------------------------------------------%
\DeclareChoiceOption{sizeXclo}[10]{\@known@size@clo@defs}
\DeclareChoiceOption{fontencoding}[OT1]{\@supported@font@encodings}
\DeclareChoiceOption{fontseries}[m]{\@known@font@series}
\DeclareChoiceOption{fontshape}[n]{\@known@font@shapes}
\DeclareChoiceOption{frontpagenumbering}[Roman]{\@supported@page@numbering}
\DeclareChoiceOption{docpagenumbering}[arabic]{\@supported@page@numbering}
\DeclareChoiceOption{backpagenumbering}[roman]{\@supported@page@numbering}
\DeclareChoiceOption{footpagelabeling}[thepage]{\@supported@page@labeling}
\DeclareChoiceOption{fncychap}[Lenny]{\@supported@chaphead@styles}
\DeclareChoiceOption{choiceopttest}[choicetwo]{\choicetestoptions}
%-------------------------------------------------------------------------------------------------------------------------------%
\DeclareChoiceArrayOption{1}{fontname}[Computer Modern Roman]{\@known@fontname@fontcode@pairs}%Latin Modern Roman
\DeclareChoiceArrayOption{2}{fontfamily}[cmr]{\@known@fontname@fontcode@pairs}
%\DeclareChoiceArrayOption{mathfontname}[Computer Modern Roman]{\@known@fontname@fontcode@pairs}
%\DeclareChoiceArrayOption{mathfontfamily}[Computer Modern Roman]{\@known@fontname@fontcode@pairs}
%-------------------------------------------------------------------------------------------------------------------------------%
\DeclareDefaultOption{\PackageWarning{my-latex}{Unknown \CurrentOption}}
%-------------------------------------------------------------------------------------------------------------------------------%
%*******************************************************************************************************************************%
%****************************************** Processing/forwarding of package options *******************************************%
%*******************************************************************************************************************************%
%-------------------------------------------------------------------------------------------------------------------------------%
%\ExecuteOptions{splitindex,nonewpage}
\ProcessPackageOptions
%-------------------------------------------------------------------------------------------------------------------------------%
\ifmylatex@landscape
        \PassOptionsToClass{landscape}{article}
        \PassOptionsToClass{landscape}{report}
\fi
%-------------------------------------------------------------------------------------------------------------------------------%
\ifmylatex@crop
        \PassOptionsToClass{crop}{article}
        \PassOptionsToClass{crop}{report}
\fi
%-------------------------------------------------------------------------------------------------------------------------------%
\ifmylatex@twocolumn
        \PassOptionsToClass{twocolumn}{article}
        \PassOptionsToClass{twocolumn}{report}
\fi
%-------------------------------------------------------------------------------------------------------------------------------%
\ifmylatex@FBM@clearpage
\else
        \PassOptionsToPackage{nonewpage}{imakeidx-patched}
\fi
%-------------------------------------------------------------------------------------------------------------------------------%
\ifmylatex@automake
        \PassOptionsToPackage{automake}{my-glossaries}
        \PassOptionsToPackage{makeindex}{imakeidx-patched}
\fi
%-------------------------------------------------------------------------------------------------------------------------------%
%*******************************************************************************************************************************%
%****************************************** Application of 'my-latex' package options ******************************************%
%*******************************************************************************************************************************%
\SetPkgSource
\SetFBMsettings
\SetDocFontSettings
\SetDocumentClass
%-------------------------------------------------------------------------------------------------------------------------------%
%*******************************************************************************************************************************%
%************************************** Loading 'my-latex' component packages/subpackages **************************************%
%*******************************************************************************************************************************%
%-------------------------------------------------------------------------------------------------------------------------------%
\RequirePackage{imakeidx-patched}               % options: xindy
\RequirePkg{my-packages}%
\RequirePkg{my-colorsets}                   % Custom colorset definitions loaded
\RequirePkg{my-colors}                      % Custom color definitions and mixed color variables
\RequirePkg{my-color-schemes}               % Color set defs (\colorlet{<scheme name>Scheme-<property>}) for pgf/tcb/tikz/etc.
\RequirePkg{my-definitions}                 % Low-level \def,\numdef,\dimdef,key definitions
\RequirePkg{my-regvars}                     % Register variable creation w/ initialization values typically from my-definitions
\RequirePkg{my-commands}                    % Lower-level tools/helper cmds used directly & in composite cm construction
\RequirePkg{my-patches}                   % Modifies/adds reg variables + control sequences/environments to existing packages
\RequirePkg{my-fonts}                     % Custom assignment of fonts and math alphabets to established and new font names
\RequirePkg{my-symbols}                   % Custom assignment of fonts and math alphabets to established and new font names
\RequirePkg{arrowsnew}                      % Custom color definition/naming and visual settings
\RequirePkg{my-styles}                      % Custom color definition/naming and visual settings
\RequirePackage[acronyms,symbols,makeindex,automake,toc]% Adapts 'glossaries' for glossary/acronym/symbol entry lists w/ links to occurences
        {my-glossaries}                         % Options: automake, xindy/makeindex, section=, nopostdot/main/nonumberlist
\RequirePkg[intoc]{my-nomencl}              % Nomenclature/abbreviations list similar to acronms/glossary
\RequirePkg{mainmatter}                     %
\RequirePkg{frontbackmatter}                % ToC: List of Tables/Figures/Acronyms/Symbols/Abbreviations, Glossary,Index,etc.
\RequirePkg{my-math}                        % Custom math chars/syms, delimiters, operators, control sequences, and environments
\RequirePkg{my-polynom}                     % Adapted 'polynom' package: polynomial long div, factoring, +,-,*,/ etc.
\RequirePkg{my-lstautogobble}               % Adapted 'lstautogobble' package, auto sets 'listings' package's 'gobble=#' value
\RequirePkg{my-listings}                    % Adapted 'listings' package configuring code listing languages/settings/appearance
%\RequirePkg{my-minted}                     % Adapted 'minted' package configuring code listing languages/settings/appearance
\RequirePkg{my-macros}                      % Higher-level composite commands/environments combining lower-level components
\RequirePkg{my-keyvals}                     % Custom key/value commands/environments
\RequirePkg{my-graphics}                    % Custom Tikz/PGF/etc. graphics commands/environments
\RequirePkg{my-latex-development}           % Test/development content maintained separately
\RequirePkg{my-config}                      % Set doc & package options/settings & define preamble/doc/page/auxout hooks & patches
%-------------------------------------------------------------------------------------------------------------------------------%
%*******************************************************************************************************************************%
%*************************************** End of 'my-latex.sty' top level parent package ****************************************%
%*******************************************************************************************************************************%
% Restore @ -> \catcode'@=12 (active), peventing user access to macro names containing @ character
\makeatother
%-------------------------------------------------------------------------------------------------------------------------------%
\endinput
%-------------------------------------------------------------------------------------------------------------------------------%
%*******************************************************************************************************************************%
%*********************************************************** NOTES *************************************************************%
%*******************************************************************************************************************************%
%-------------------------------------------------------------------------------------------------------------------------------%
