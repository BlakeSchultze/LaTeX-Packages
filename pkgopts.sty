%*****************************************************************************************************************************************%
%*********************************************************** `pkgopts.sty' ***************************************************************%
%*****************************************************************************************************************************************%
% Expands upon the 'kvoptions' package to add another '\DeclareXOption' package option key type and associated definition/management commands corresponding to a 'X=Choice' type key, analagous to a key defined using the 'define@choicekey' command of the 'keyval' package, thereby providing key/value package option equivalents to each of the primary key types defined by the 'keyval' package.  This package also
%*****************************************************************************************************************************************%
%*************************************** Define provided package name and LaTeX/package dependencies *************************************%
%*****************************************************************************************************************************************%
\NeedsTeXFormat{LaTeX2e}[2005/12/01]
\ProvidesPackage{pkgopts}                       %
%-----------------------------------------------------------------------------------------------------------------------------------------%
%*****************************************************************************************************************************************%
%****************************************** Package options and corresponding Boolean variables ******************************************%
%*****************************************************************************************************************************************%
%-----------------------------------------------------------------------------------------------------------------------------------------%
\DeclareOption*{\PackageWarning{pkgopts}{Unknown \CurrentOption}}
%*****************************************************************************************************************************************%
%***************************************************** Processing of package options *****************************************************%
%*****************************************************************************************************************************************%
%-----------------------------------------------------------------------------------------------------------------------------------------%
\ProcessOptions\relax
%-----------------------------------------------------------------------------------------------------------------------------------------%
%\catcode`\!=12
%\makeatletter                          % Change @ to standard letter, \catcode'@=11 so it can be used in macro names/definition
%*****************************************************************************************************************************************%
%************************************************************* Package Body **************************************************************%
%*****************************************************************************************************************************************%
%-----------------------------------------------------------------------------------------------------------------------------------------%
\def\fullyexpand#1{\romannumeral - `0#1}
\def\xp@cmd#1#2{\expandafter#1\expandafter#2}
\def\shown#1{\expandafter\show\csname\string#1\endcsname}
\def\showthen#1{\expandafter\showthe\csname\string#1\endcsname}
\def\don#1{\csname\string#1\endcsname}
\def\defn#1{\expandafter\def\csname\string#1\endcsname}
\def\@nil{}
\long\def\firstofone#1{#1}
\long\def\firstoftwo#1#2{#1}
\long\def\secondoftwo#1#2{#2}
\def\@csname#1{\csname #1\endcsname}
\def\thecsname#1{\expandafter\secondoftwo\string#1}
%-----------------------------------------------------------------------------------------------------------------------------------------%
\def\IndentedMessageBreak{\MessageBreak\space\space\space\space}
\def\DoubleIndentedMessageBreak{\MessageBreak\space\space\space\space\space\space\space\space}
\xdef\DoubleIndented{\space\space\space\space\space\space\space\space}
\def\pkgname{my-latex}%
\newcommand\@pkgopts@packages{etoolbox,kvoptions}
\def\minispace{\space\!}
%*****************************************************************************************************************************************%
%************************************************************* Package Body **************************************************************%
%*****************************************************************************************************************************************%
%-----------------------------------------------------------------------------------------------------------------------------------------%
\newcommand\RequirePackageOnce[1]
{%
        \@ifpackageloaded{#1}{}%
        {%
                \RequirePackage{#1}%
                \ifdefined\@loaded@packages%
                        \edef\@loaded@packages{\@loaded@packages,#1}%
                \else%
                        \edef\@loaded@packages{#1}%
                \fi
        }%
}
%-----------------------------------------------------------------------------------------------------------------------------------------%
\newcommand\RequirePackageList[1]{\@for\next:=#1\do{\expandafter\RequirePackageOnce\expandafter{\next}}}
%*****************************************************************************************************************************************%
%************************************************************* Package Body **************************************************************%
%*****************************************************************************************************************************************%
%-----------------------------------------------------------------------------------------------------------------------------------------%
\newcommand\DeclareChoiceOptionMessage[2][\KVO@prefix]%
{%\DeclareChoiceOptionMessage[<prefix>]{<key>}
        \gdef\msgtext{\string\DeclareChoiceOption\space Error%
        \MessageBreak Invalid choice '#1#2\space=\space\csname #1#2\endcsname'}%
}
%-----------------------------------------------------------------------------------------------------------------------------------------%
\newcommand\DeclareChoiceOptionHelp[2][\KVO@prefix]%
{%\DeclareChoiceOptionHelp[<prefix>]{<key>}
        \gdef\hlptext{\string\DeclareChoiceOption\space Help:%
        \IndentedMessageBreak Valid '#1#2' Options:%
        \MessageBreak\IndentedMessageBreak #2\space=\space{\csname @#1valid@#2@choice@options\endcsname}}%
}
%-----------------------------------------------------------------------------------------------------------------------------------------%
\newcommand\DeclareChoiceOptionError[2][\KVO@prefix]%
{%\DeclareChoiceOptionError[<prefix>]{<key>}
        \DeclareChoiceOptionMessage[#1]{#2}%
        \DeclareChoiceOptionHelp[#1]{#2}%
        \@PackageError\pkgname\msgtext\hlptext%
}
%-----------------------------------------------------------------------------------------------------------------------------------------%
\def\DeclareChoiceOption{\@ifnextchar(\@DeclareChoiceOption\@DeclareChoiceOption(\KVO@prefix)}%
%-----------------------------------------------------------------------------------------------------------------------------------------%
\def\@DeclareChoiceOption(#1)#2[#3]#4%
{%\DeclareChoiceOption<*>(<prefix>){<key>}[<default>]{<valid key values>}
        \ifstrempty{#1}
                {\def\@current@prefix{\KVO@prefix}}%
                {\def\@current@prefix{#1}}%
        \ifstrempty{#3}
                {\DeclareStringOption{#2}}%
                {\DeclareStringOption{#2}[#3]}%
        \ifundef{\@defined@Choice@Options}%
                {\edef\@defined@Choice@Options{#2}}%
                {\edef\@defined@Choice@Options{\@defined@Choice@Options,#2}}%
        \expandafter\newif\csname if\@current@prefix#2\endcsname%->\if<prefix><key>
        \expandafter\gdef\csname @\@current@prefix valid@#2@choice@options\endcsname{#4}%
        \expandafter\xdef\csname @#2@prefix\endcsname{\@current@prefix}%
}
%-----------------------------------------------------------------------------------------------------------------------------------------%
\newcommand\DeclareBoolOptionPair[2][false]%
{%\DeclareBoolOptionPair[<init>]{<key>}
        \DeclareBoolOption[#1]{#2}
        \DeclareComplementaryOption{#2off}{#2}
        \DeclareComplementaryOption{no#2}{#2}
}
%-----------------------------------------------------------------------------------------------------------------------------------------%
\newcommand\ProcessChoiceOption[2][\KVO@prefix]%
{%\ProcessChoiceOption[<prefix>]{<key>}
        \expandafter\ifdefempty\expandafter{\csname#1#2\endcsname}%
                {}{\csname #1#2true\endcsname}%
        \expandafter\csname if\csname @\next @prefix\endcsname\next\endcsname\relax%
                \xdef\@valid@choice@options{\csname @#1valid@#2@choice@options\endcsname}%
                \@for\@valid@option:=\@valid@choice@options\do%
                        {\expandafter\ifx\expandafter\@valid@option\csname #1#2\endcsname\def\@validated{true}\fi}%
                \ifdefined\@validated\else\DeclareChoiceOptionError[#1]{#2}\fi
        \fi%
}
%-----------------------------------------------------------------------------------------------------------------------------------------%
\newcommand\ProcessChoiceOptions{\@for\next:=\@defined@Choice@Options\do{\ProcessChoiceOption[\csname @\next @prefix\endcsname]{\next}}}
%-----------------------------------------------------------------------------------------------------------------------------------------%
\newcommand\ProcessPackageOptions[1][]%
{%\ProcessPackageOptions[family]
        \ifstrempty{#1}%
                {\ProcessKeyvalOptions*}%
                {\ProcessKeyvalOptions{#1}}%
        \ProcessChoiceOptions%
}
%-----------------------------------------------------------------------------------------------------------------------------------------%
%-----------------------------------------------------------------------------------------------------------------------------------------%
%-----------------------------------------------------------------------------------------------------------------------------------------%
\newcommand\PrintChoiceInfo[2][]%
{%\ProcessChoiceOption[<prefix>]{<key>}
        \ifstrempty{#1}
                {\def\@choicekey@prefix{\csname @#2@prefix\endcsname}}
                {\def\@choicekey@prefix{#1}}
        \indent \underline{Choice key (family@key)} : \@choicekey@prefix#2\\
        \expandafter\csname if\@choicekey@prefix#2\endcsname\relax%
                \indent\indent \underline{Provided} = true\\%
                \indent\indent \underline{Acceptable Choices} = %
                \fullyexpand{\csname @\@choicekey@prefix valid@#2@choice@options\endcsname}\\%
                \indent\indent \underline{Selected Choice} = \expandafter\csname\@choicekey@prefix#2\endcsname\\
        \else%
                \indent\indent \underline{Provided} = false\\%
        \fi%
}
%-----------------------------------------------------------------------------------------------------------------------------------------%
\newcommand\PrintChoicesInfo%
{%
        \noindent \underline{Defined Choice Keys} : \@defined@Choice@Options\\%
        \@for\next:=\@defined@Choice@Options%
                \do{\PrintChoiceInfo[\csname @\next @prefix\endcsname]{\next}}%
}
%-----------------------------------------------------------------------------------------------------------------------------------------%
\newcommand\PrintPackageList{\noindent \underline{Loaded Packages} : \@loaded@packages}
%*****************************************************************************************************************************************%
%************************************************************* Package Body **************************************************************%
%*****************************************************************************************************************************************%
\newcommand\SetDocumentClass[1][\KVO@prefix]%
{%\SetDocumentClass[<prefix>]
        \ifstrempty{\csname #1documentclass\endcsname}
                {\def\thedocumentclass{report}}%
                {\def\thedocumentclass{\csname #1documentclass\endcsname}}%
        \ifmylatex@article
                \def\thedocumentclass{article}
        \fi
        \ifmylatex@report
                \def\thedocumentclass{report}
        \fi
        \ifmylatex@standalone
                \documentclass[class=\thedocumentclass, crop=false]{standalone}
        \else
                \documentclass{\thedocumentclass}
        \fi
}
%-----------------------------------------------------------------------------------------------------------------------------------------%
%*****************************************************************************************************************************************%
%***************************************************** End of 'pkgopts.sty' package ******************************************************%
%*****************************************************************************************************************************************%
%-----------------------------------------------------------------------------------------------------------------------------------------%
\endinput 