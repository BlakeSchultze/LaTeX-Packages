%******************************************************************************************************************************%
%****************************************************** `pkgopts.sty' *********************************************************%
%******************************************************************************************************************************%
% Expands upon the 'kvoptions' package to add another '\DeclareXOption' package option key type and associated definition/management commands corresponding to a 'X=Choice' type key, analagous to a key defined using the 'define@choicekey' command of the 'keyval' package, thereby providing key/value package option equivalents to each of the primary key types defined by the 'keyval' package.  This package also
%******************************************************************************************************************************%
%********************************** Define provided package name and LaTeX/package dependencies *******************************%
%******************************************************************************************************************************%
\NeedsTeXFormat{LaTeX2e}[2005/12/01]
\ProvidesPackage{pkgopts}                       %
%------------------------------------------------------------------------------------------------------------------------------%
%******************************************************************************************************************************%
%************************************* Package options and corresponding Boolean variables ************************************%
%******************************************************************************************************************************%
%------------------------------------------------------------------------------------------------------------------------------%
\DeclareOption*{\PackageWarning{pkgopts}{Unknown \CurrentOption}}
%******************************************************************************************************************************%
%************************************************ Processing of package options ***********************************************%
%******************************************************************************************************************************%
%------------------------------------------------------------------------------------------------------------------------------%
\ProcessOptions\relax
%------------------------------------------------------------------------------------------------------------------------------%
\makeatletter                          % Change @ to standard letter, \catcode'@=11 so it can be used in macro names/definition
%******************************************************************************************************************************%
%******************************************************** Package Body ********************************************************%
%******************************************************************************************************************************%
%\newtoggle{validated}
\newif\ifvalidated\validatedfalse
\newif\if@choicevals@validated\@choicevals@validatedfalse
%******************************************************************************************************************************%
%************************************************ Plain TeX macro definitions *************************************************%
%******************************************************************************************************************************%
%~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~%
%~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ Generic/universal/helper macro definitions ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~%
%~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~%
%------------------------------------------------------------------------------------------------------------------------------%
\def\shown#1{\expandafter\show\csname\string#1\endcsname}
\def\showthen#1{\expandafter\showthe\csname\string#1\endcsname}
\def\don#1{\csname\string#1\endcsname}
\def\defn#1{\expandafter\def\csname\string#1\endcsname}
%------------------------------------------------------------------------------------------------------------------------------%
\def\IndentedMessageBreak{\MessageBreak\space\space\space\space}
\def\DoubleIndentedMessageBreak{\MessageBreak\space\space\space\space\space\space\space\space}
\xdef\DoubleIndented{\space\space\space\space\space\space\space\space}
\def\minispace{\space\!}
\def\tinyspace{\space\!\!}
%------------------------------------------------------------------------------------------------------------------------------%
\def\@add@to@deflist#1#2%
{
        \ifx#2\@empty\undef#2\fi
        \ifundef{#2}%
                {\xdef#2{#1}}%
                {\xdef#2{#2,#1}}%
}
%------------------------------------------------------------------------------------------------------------------------------%
\def\@add@to@argslist#1#2%
{
        %\ifx#2\@empty\undef#2\fi
        \ifundef{#2}%
                {\gdef#2{{#1}}}%
                {\gdef#2{#2 {#1}}}%
}
%~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~%
%~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ Macros for defining macros requiring expansion first ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~%
%~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~%
%@@xpdef base
%xpdef none
%xp@@def both
%@xpdef 1st
%xp@def 2nd
\def\xp{\expandafter}
\def\@xp@def{\expandafter\def}
\def\@xp@edef{\expandafter\edef}
\def\@xp@gdef{\expandafter\gdef}
\def\@xp@xdef{\expandafter\xdef}
\def\@xp@numdef{\expandafter\numdef}
\def\@xp@dimdef{\expandafter\dimdef}
\def\@xp@newcommand{\expandafter\newcommand}
\def\@xp@renewcommand{\expandafter\renewcommand}
\def\@xp@setlength{\expandafter\setlength}
\def\@xp@set#1{\expandafter\csname set#1\endcsname}
%------------------------------------------------------------------------------------------------------------------------------%
\def\xp@def#1#2{\@xp@def\csname#1\endcsname{#2}}
\def\xp@edef#1#2{\@xp@edef\csname#1\endcsname{#2}}
\def\xp@gdef#1#2{\@xp@gdef\csname#1\endcsname{#2}}
\def\xp@xdef#1#2{\@xp@xdef\csname#1\endcsname{#2}}
\def\xp@numdef#1#2{\@xp@numdef\csname#1\endcsname{#2}}
\def\xp@dimdef#1#2{\@xp@dimdef\csname#1\endcsname{#2}}
\def\xp@newcommand#1#2{\@xp@newcommand\csname#1\endcsname{#2}}
\def\xp@renewcommand#1#2{\@xp@renewcommand\csname#1\endcsname{#2}}
\def\xp@setlength#1#2{\@xp@setlength\csname#1\endcsname{#2}}%{\@nameuse{cft\@connect@to\Z}}}
\def\xp@set#1#2#3{\@xp@set{#1}\csname#2\endcsname{#3}}
%------------------------------------------------------------------------------------------------------------------------------%
\def\xp@def@#1#2{\xp@def{#1}{\csname#2\endcsname}}
\def\xp@edef@#1#2{\xp@edef{#1}{\csname#2\endcsname}}
\def\xp@gdef@#1#2{\xp@gdef{#1}{\csname#2\endcsname}}
\def\xp@xdef@#1#2{\xp@xdef{#1}{\csname#2\endcsname}}
\def\xp@numdef@#1#2{\xp@numdef{#1}{\csname#2\endcsname}}
\def\xp@dimdef@#1#2{\xp@dimdef{#1}{\csname#2\endcsname}}
\def\xp@newcommand@#1#2{\xp@newcommand{#1}{\csname#2\endcsname}}
\def\xp@renewcommand@#1#2{\xp@renewcommand{#1}{\csname#2\endcsname}}
\def\xp@setlength@#1#2{\xp@setlength{#1}{\csname#2\endcsname}}%}
\def\xp@set@#1#2#3{\xp@set{#1}{#2}{#3}}
%  \xp@set@{length}{@macro@length}{5pt}
%------------------------------------------------------------------------------------------------------------------------------%
\def\xp@@def#1#2{\@xp@def\expandafter#1\expandafter{\csname#2\endcsname}}
\def\xp@@edef#1#2{\@xp@edef\expandafter#1\expandafter{\csname#2\endcsname}}
\def\xp@@gdef#1#2{\@xp@gdef\\expandafter#1\expandafter{\csname#2\endcsname}}
\def\xp@@xdef#1#2{\@xp@xdef\expandafter#1\expandafter{\csname#2\endcsname}}
\def\xp@@newcommand#1#2{\@xp@newcommand\expandafter#1\expandafter{\csname#2\endcsname}}
\def\xp@@renewcommand#1#2{\@xp@renewcommand\expandafter#1\expandafter{\csname#2\endcsname}}
\def\xp@@setlength#1#2{\@xp@setlength#1{\csname#2\endcsname}}
\def\xp@@set#1#2#3{\@xp@set{#1}#2{\csname#3\endcsname}}
%------------------------------------------------------------------------------------------------------------------------------%
\def\xpdef#1#2{\@xp@def\expandafter#1\expandafter{#2}}
\def\xpedef#1#2{\@xp@edef\expandafter#1\expandafter{#2}}
\def\xpgdef#1#2{\@xp@gdef\\expandafter#1\expandafter{#2}}
\def\xpxdef#1#2{\@xp@xdef\expandafter#1\expandafter{#2}}
\def\xpnewcommand#1#2{\@xp@newcommand\expandafter#1\expandafter{#2}}
\def\xprenewcommand#1#2{\@xp@renewcommand\expandafter#1\expandafter{#2}}
\def\xpsetlength#1#2{\@xp@setlength#1{#2}}
\def\xpset#1#2#3{\@xp@set{#1}#2{#3}}
%------------------------------------------------------------------------------------------------------------------------------%
\def\xp@cmd#1#2{\expandafter#1\expandafter#2}
\def\xp@newif#1{\expandafter\newif\csname#1\endcsname}
\def\xp@ifnum#1{\expandafter\ifnum\csname#1\endcsname}
\def\xp@ifx#1#2{\expandafter\ifx\expandafter#1\expandafter\csname#2\endcsname}
\def\xp@ifdefempty#1#2#3%
{%
        \expandafter\ifdefempty\expandafter{\csname#1\endcsname}%
                {#2}{#3}%
}
\def\xp@ifstrempty#1#2#3%
{%
        \expandafter\ifstrempty\expandafter{\fullyexpand{#1}}%
                {#2}{#3}%
}
%------------------------------------------------------------------------------------------------------------------------------%
\def\@csname#1{\csname #1\endcsname}
\def\thecsname#1{\expandafter\secondoftwo\string#1}
\def\detok@csname#1{\expandafter\secondoftwo\detokenize{#1}}
\def\scopedef#1#2%
{%
	\begingroup#1%
     	\edef\x{\endgroup\noexpand#2}\x%
}
%\def\x%
%{%
%	\endgroup
%    	\expandafter\edef\csname etexcmds@AtEnd\endcsname%
%    	{%
%      		\endlinechar=\the\endlinechar\relax
%      		\catcode13=\the\catcode13\relax
%      		\catcode32=\the\catcode32\relax
%      		\catcode35=\the\catcode35\relax
%      		\catcode61=\the\catcode61\relax
%      		\catcode64=\the\catcode64\relax
%      		\catcode123=\the\catcode123\relax
%      		\catcode125=\the\catcode125\relax
%    	}%
%}%
%~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~%
%~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ Macro argument parsing/storage commands  ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~%
%~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~%
%------------------------------------------------------------------------------------------------------------------------------%
\def\fullyexpand#1{\romannumeral - `0#1}
\def\@nil{}
\def\@nilbrackets[#1]{}
\def\@identity#1{#1}
\long\def\@gobblethree#1#2#3{}
\long\def\firstofone#1{#1}
\long\def\firstoftwo#1#2{#1}
\long\def\secondoftwo#1#2{#2}
\long\def\firstofthree#1#2#3{#1}
\long\def\secondofthree#1#2#3{#2}
\long\def\thirdofthree#1#2#3{#3}
\long\def\firsttwoofthree#1#2#3{#1#2}
\long\def\secondtwoofthree#1#2#3{#2#3}
%------------------------------------------------------------------------------------------------------------------------------%
\def\rarg#1{\csname arg\romannumeral#1\endcsname}
\def\largdef#1{\@namedef{arg\romannumeral\numexpr\narg+1\relax}{#1}}
\def\larg{\csname arg\romannumeral\numexpr\narg+1\relax\endcsname}
%------------------------------------------------------------------------------------------------------------------------------%
\newcommand\getcsvargs[2][\roman]%
{%
        \def\@csvargs@numformat{#1}%
        \if T\converttilde\def~{ }\else\catcode`~=12\fi
        \protected@edef\the@string{#2}%
        \setcounter{arg@index}{0}%
        \lowercase{\expandafter\parse@csvBlock\the@string},\string@end
        \let~\SaveHardspace%
        \catcode`~=13
}
%------------------------------------------------------------------------------------------------------------------------------%
%\def\getvargs#1%
\newcommand\getvargs[2][\roman]%
{%
        \def\@vargs@numformat{#1}%
        \if T\converttilde\def~{ }\else\catcode`~=12\fi
        \protected@edef\the@string{#2}%
        \setcounter{arg@index}{0}%
        \lowercase{\expandafter\parse@vBlock\the@string}\string@end
        \let~\SaveHardspace%
        \catcode`~=13
}
%------------------------------------------------------------------------------------------------------------------------------%
\def\parse@csvBlock#1,%
{%
        \stepcounter{arg@index}%
        \@namedef{arg\@csvargs@numformat{arg@index}}{#1}%
        \futurelet\tmp\parse@csvBlock@%
}
%------------------------------------------------------------------------------------------------------------------------------%
\def\parse@csvBlock@%
{%
        \ifx\tmp\string@end\edef\narg{\thearg@index}\expandafter\@gobble
        \else\expandafter\parse@csvBlock\fi%
}
%------------------------------------------------------------------------------------------------------------------------------%
\def\parse@vBlock#1%
{%
        \stepcounter{arg@index}%
        \@namedef{arg\@vargs@numformat{arg@index}}{#1}%
        \futurelet\tmp\parse@vBlock@%
}
%------------------------------------------------------------------------------------------------------------------------------%
\def\parse@vBlock@%
{%
        \ifx\tmp\string@end\edef\narg{\thearg@index}\expandafter\@gobble
        \else\expandafter\parse@vBlock\fi%
}
%------------------------------------------------------------------------------------------------------------------------------%
\def\listprintsep#1#2#3#4%
{%
        \ifnumcomp{#1}{<}{#2}{#3}{#4}%
}
%------------------------------------------------------------------------------------------------------------------------------%
\def\printargsC#1%
{%
        \getargsC{#1}%
        \setcounter{argindex}{0}%
        \whiledo{\theargindex < \narg}%
        {%
                \stepcounter{argindex}%
                \csname arg\romannumeral\theargindex\endcsname%
                \listprintsep{\theargindex}{\narg}{,\space}{}%
        }\\%
}
%------------------------------------------------------------------------------------------------------------------------------%
\def\printvargs#1%
{%
        \getvargs{#1}%
        \setcounter{argindex}{0}%
        \whiledo{\theargindex < \narg}%
        {%
                \stepcounter{argindex}%
                \csname arg\romannumeral\theargindex\endcsname%
                \listprintsep{\theargindex}{\narg}{,\space}{}%
        }\\%
}
%------------------------------------------------------------------------------------------------------------------------------%
\def\printcsvargs#1%
{%
        \getcsvargs{#1}%
        \setcounter{argindex}{0}%
        \whiledo{\theargindex < \narg}%
        {%
                \stepcounter{argindex}%
                \csname arg\romannumeral\theargindex\endcsname%
                \listprintsep{\theargindex}{\narg}{,\space}{}%
        }\\%
}
%------------------------------------------------------------------------------------------------------------------------------%
\def\@create@tokenlist#1#2%
{%
        \@tfor\next:=#1\do%
        {%
                \expandafter\@add@to@deflist%
                \expandafter{\expandafter\string\next}%
                {#2}
        }%
}
%------------------------------------------------------------------------------------------------------------------------------%
\def\@print@deflist#1%
{
        \edef\@current@list{#1}
        \@for\next:=\@current@list%
                \do{\next,}%
}
\def\isinlist#1#2#3%
{%
        \def\tmp##1#2##2\end%
        {%
                \def\tmp{##2}%
                \ifx\tmp\empty \csname iffalse\expandafter\endcsname \else
                  \csname iftrue\expandafter\endcsname \fi%
        }% end of \def\tmp
        \expandafter\tmp#1\endlistsep#2\end
}
\def\convertto#1#2{\strip@pt\dimexpr 1#1*65536/\number\dimexpr 1#2}     % Convert value of #1 to units of #2
\long\def\addto#1#2{\expandafter\def\expandafter#1\expandafter{#1#2}}
\def\addtolist#1#2{\lst@lAddTo#1{#2}}
%------------------------------------------------------------------------------------------------------------------------------%
\def\RA#1|#2|#3|#4;%
{%
        \addtolist{\alist}{#1#2,}%
        \expandafter\gdef\csname#1#2\endcsname{\textit{#1}&#2&#3&#4\cr\relax}
        \lst@BubbleSort{\alist}
}
%------------------------------------------------------------------------------------------------------------------------------%
\def\RB#1|#2|#3|#4;%
{%
        \addtolist{\alist}{#2#1,}%
        \expandafter\gdef\csname#2#1\endcsname{\textit{#1}&#2&#3&#4\cr\relax}
        \lst@BubbleSort{\alist}
}
\def\qq#1\qq{\\\text{Trailing Code (Braced): \{}\texttt{\detokenize{#1}}\}}     %Print code executed after environment #1 closes
%------------------------------------------------------------------------------------------------------------------------------%
%------------------------------------------------------------------------------------------------------------------------------%
%------------------------------------------------------------------------------------------------------------------------------%
%------------------------------------------------------------------------------------------------------------------------------%
%------------------------------------------------------------------------------------------------------------------------------%
\def\pkgname{my-latex}%
\def\pkgload@font{\fontfamily{cmr}\selectfont}%
\newcommand\@pkgopts@packages{etoolbox,kvoptions,pgffor}
\gdef\choicetestoptions{choiceone,choicetwo,choicethree}
\gdef\@supported@page@numbering{arabic,roman,Roman,alph,Alph,fnsymbol}
\gdef\@supported@page@labeling{thepage,oftotal,ofsector,rawpage}
\gdef\@supported@chaphead@styles{Sonny,Lenny,Glenn,Conny,Rejne,Bjarne,Bjornstrup,PetersLenny}
\gdef\@known@documentclasses{report,article,journal,proceedings}
%\gdef\@imakeidx@options{}
%------------------------------------------------------------------------------------------------------------------------------%
\gdef\@known@fontname@fontcode@pairs%
{
        {Adobe Courier}/pcr,
        {Adobe Helvetica}/phv,
        {Adobe New Century Schoolbok}/pnc,
        {Adobe Palatino}/ppt,
        {Adobe Times Roman}/ptr,
        {Avant Garde}/pag,
        {Bera Sans}/fvs,
        {Bera Serif}/fve,
        {Bookman}/pbk,
        {Charter}/bch,
        {CM Bright}/cmbr,
        {CM Roman}/cmr,
        {CM Sans}/cmss,
        {CM Sans Serif}/cmss,
        {CM Typewriter}/cmtt,
        {CM Typewriter Light}/cmtl,
        {Computer Modern Bright}/cmbr,
        {Computer Modern Roman}/cmr,
        {Computer Modern Sans}/cmss,
        {Computer Modern Sans Serif}/cmss,
        {Computer Modern Typewriter}/cmtt,
        {Computer Modern Typewriter Light}/cmtl,
        {Courier}/pcr,
        {Fourier}/put,
        {Helvetica}/phv,
        {ITC Bookman}/pbk,
        {ITC Avant Garde Gothic}/pag,
        {Latin Modern Dunhill}/lmdh,
        {Latin Modern Roman}/lmr,
        {Latin Modern Sans Serif}/lmss,
        {Latin Modern Sans Typewriter}/lmtt,
        {LM Dunhill}/lmdh,
        {LM Roman}/lmr,
        {LM Sans Serif}/lmss,
        {LM Sans Typewriter}/lmtt,
        {New Century Schoolbook}/pnc,
        {Palatino}/ppl,
        {TEX Gyre Termes}/qtm,
        {TEX Gyre Pagella}/qpl,
        {TEX Gyre Bonum}/qbk,
        {TEX Gyre Schola}/qcs,
        {TEX Gyre Adventor}/qag,
        {TEX Gyre Heros}/qhv,
        {TEX Gyre Cursor}/qcr,
        {Times}/ptm,
        {URW Classico}/uop,
        {Utopia}/put
}
%------------------------------------------------------------------------------------------------------------------------------%
\gdef\@known@ss@fontname@fontcode@pairs%
{
        {CM Sans}/cmss,
        {CM Sans Serif}/cmss,
        {Computer Modern Sans}/cmss,
        {Computer Modern Sans Serif}/cmss,
        {Latin Modern Sans Serif}/lmss,
        {LM Sans Serif}/lmss
}
%------------------------------------------------------------------------------------------------------------------------------%
\gdef\@known@tt@fontname@fontcode@pairs%
{
        {CM Typewriter}/cmtt,
        {CM Typewriter Light}/cmtl,
        {Computer Modern Typewriter}/cmtt,
        {Computer Modern Typewriter Light}/cmtl,
        {Latin Modern Sans Typewriter}/lmtt,
        {LM Sans Typewriter}/lmtt
}
%Mathematical Formula Fonts
%Abbreviation    Font Name
%cmm     Computer Modern (math italic)
%cmsy    Computer Modern (math symbols)
%zplm    Palatino (math)
%------------------------------------------------------------------------------------------------------------------------------%
\gdef\@known@font@encodings{OT1,OT2,OT3,OT4,OT6,T1,T2A,T2B,T2C,TS1,TS3,X2,OML,OMS,OMX,LY1,LV1,LG3,PD1,PU,U}
\gdef\@known@font@series{l,m,b,bx}
\gdef\@known@font@shapes{n,it,sl,sc}
\gdef\@known@size@clo@defs{10,11,12}
%------------------------------------------------------------------------------------------------------------------------------%
%******************************************************************************************************************************%
%******************************************************** Package Body ********************************************************%
%******************************************************************************************************************************%
%------------------------------------------------------------------------------------------------------------------------------%
\newcommand\RequirePackageOnce[1]
{%
        \@ifpackageloaded{#1}{}%
        {%
                \RequirePackage{#1}%
                \@add@to@deflist{#1}{\@loaded@packages}
        }%
}
%------------------------------------------------------------------------------------------------------------------------------%
\newcommand\RequirePackageList[1]{\@for\next:=#1\do{\expandafter\RequirePackageOnce\expandafter{\next}}}
%******************************************************************************************************************************%
%******************************************************** Package Body ********************************************************%
%******************************************************************************************************************************%
\newcommand\DeclareChoiceOptionMessage[2][\KVO@prefix]%
{%\DeclareChoiceOptionMessage[<prefix>]{<key>}
        \gdef\msgtext{\string\DeclareChoiceOption\space Error%
        \MessageBreak Invalid choice '#1#2\space=\space\@nameuse{#1#2}'}%
}
%------------------------------------------------------------------------------------------------------------------------------%
\newcommand\DeclareChoiceOptionHelp[2][\KVO@prefix]%
{%\DeclareChoiceOptionHelp[<prefix>]{<key>}
        \gdef\hlptext{\string\DeclareChoiceOption\space Help:%
        \IndentedMessageBreak Valid '#1#2' Options:%
        \MessageBreak\IndentedMessageBreak #2\space=\space{\@nameuse{@#1valid@#2@choice@options}}}%
}
%------------------------------------------------------------------------------------------------------------------------------%
\newcommand\DeclareChoiceOptionError[2][\KVO@prefix]%
{%\DeclareChoiceOptionError[<prefix>]{<key>}
        \DeclareChoiceOptionMessage[#1]{#2}%
        \DeclareChoiceOptionHelp[#1]{#2}%
        \@PackageError\pkgname\msgtext\hlptext%
}%
%------------------------------------------------------------------------------------------------------------------------------%
\newcommand\DeclareChoiceValOptionMessage[2][\KVO@prefix]%
{%\DeclareChoiceOptionMessage[<prefix>]{<key>}
        \gdef\msgtext{\string\DeclareChoiceValOption\space Error%
        \MessageBreak Invalid choice '#1#2\space=\space\@nameuse{#1#2}'}%
}
%------------------------------------------------------------------------------------------------------------------------------%
\newcommand\DeclareChoiceValOptionHelp[2][\KVO@prefix]%
{%\DeclareChoiceOptionHelp[<prefix>]{<key>}
        \gdef\hlptext{\string\DeclareChoiceValOption\space Help:%
        \IndentedMessageBreak Valid '#1#2' Options:%
        \MessageBreak\IndentedMessageBreak #2\space=\space{\@nameuse{#1valid@#2@choiceval@options}}}%
}
%------------------------------------------------------------------------------------------------------------------------------%
\newcommand\DeclareChoiceValOptionError[2][\KVO@prefix]%
{%\DeclareChoiceOptionError[<prefix>]{<key>}
        \DeclareChoiceValOptionMessage[#1]{#2}%
        \DeclareChoiceValOptionHelp[#1]{#2}%
        \@PackageError\pkgname\msgtext\hlptext%
}%
%~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~%
%~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~%
%~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~%
\newcommand\DeclareBoolOptionPair[2][false]%
{%\DeclareBoolOptionPair[<init>]{<key>} --> \ifmylatex@#2, \ifmylatex@no#2, \ifmylatex@#2off
       % \ifstrempty{#1}
%                {\def\@current@prefix{\KVO@prefix}}%
%                {\def\@current@prefix{#1}}%
        \DeclareBoolOption[#1]{#2}
        \DeclareComplementaryOption{#2off}{#2}
        \DeclareComplementaryOption{no#2}{#2}
        \@add@to@deflist{#2}{\@defined@Bool@Option@Pairs}
}
%~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~%
%~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~%
%~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~%
%------------------------------------------------------------------------------------------------------------------------------%
\def\DeclareChoiceOption{\@ifnextchar(\@DeclareChoiceOption\@DeclareChoiceOption(\KVO@prefix)}%
%------------------------------------------------------------------------------------------------------------------------------%
\def\@DeclareChoiceOption(#1)#2[#3]#4
{%\DeclareChoiceOption<*>(<prefix>){<key>}[<default>]{<valid key values>}
        \ifstrempty{#1}
                {\def\@current@prefix{\KVO@prefix}}%
                {\def\@current@prefix{#1}}%
        \ifstrempty{#3}
                {\DeclareStringOption{#2}}%
                {\DeclareStringOption[#3]{#2}[#3]}%
        \@add@to@deflist{#2}{\@defined@Choice@Options}
        \xp@newif{if\@current@prefix#2}%->\if<prefix><key>
        \xp@gdef{@\@current@prefix valid@#2@choice@options}{#4}%
        \xp@xdef{@#2@prefix}{\@current@prefix}%
}
%------------------------------------------------------------------------------------------------------------------------------%
\newcommand\ProcessChoiceOption[2][\KVO@prefix]%
{%\ProcessChoiceOption[<prefix>]{<key>}
        \validatedfalse
        \xp@ifdefempty{#1#2}%
                {}{\@nameuse{#1#2true}}%
        \@nameuse{if\@nameuse{@\next @prefix}\next}%
                \ValidateChoiceCS%
                        {\csuse{#1#2}}%
                        {@#1valid@#2@choice@options}%
                        {}{\DeclareChoiceOptionError[#1]{#2}}%
        \fi%
}
%------------------------------------------------------------------------------------------------------------------------------%
\newcommand\ProcessChoiceOptions{\@for\next:=\@defined@Choice@Options\do{\ProcessChoiceOption[\@csname{@\next @prefix}]{\next}}}
%~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~%
%~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~%
%~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~%
\def\DeclareChoiceValOption{\@ifnextchar({\@DeclareChoiceValOption}{\@DeclareChoiceValOption(\KVO@prefix)}}%
%------------------------------------------------------------------------------------------------------------------------------%
\def\@DeclareChoiceValOption(#1)#2[#3]#4%
{%\DeclareChoiceValOption<*>(<prefix>){<key>}[<default>]{<valid key values>}
        \xp@xdef{\@current@prefix#2@default@choice}{#3}
        \xp@xdef{\@current@prefix valid@#2@choiceval@options}{#4}
        \ifstrempty{#1}
                {\def\@current@prefix{\KVO@prefix}}%
                {\def\@current@prefix{#1}}%
        \ifstrempty{#3}
                {\DeclareStringOption{#2}}%
                {\DeclareStringOption[#3]{#2}[#3]}%
        \ValidateChoicePair{1}{#3}{#4}%
        {%
                \xp@xdef{\@current@prefix#2@default@val}{\@validated@index@value}%
                \xp@xdef{\@current@prefix#2@choiceval@value}{\@validated@index@value}%
        }{}%
        \@add@to@deflist{#2}{\@defined@ChoiceVal@Options}
        \xp@newif{if\@current@prefix#2}%->\if<prefix><key>
        \xp@xdef{@#2@prefix}{\@current@prefix}%
}
%------------------------------------------------------------------------------------------------------------------------------%
\newcommand\ProcessChoiceValOption[2][\KVO@prefix]%
{%\ProcessChoiceValOption[<prefix>]{<key>}
        \validatedfalse%
        \xp@ifdefempty{#1#2}%
                {}{\@nameuse{#1#2true}}%
        \@nameuse{if\@nameuse{@\next @prefix}\next}%
                \xdef\@valid@choiceval@options{\@nameuse{#1valid@#2@choiceval@options}}%
                \xdef\@current@choiceval@option{\csname mylatex@#2\endcsname}
                \ValidateChoicePair{1}{\@current@choiceval@option}{\@valid@choiceval@options}%
                        {\xp@xdef{\@current@prefix#2@choiceval@value}{\@validated@index@value}}%
                        {\DeclareChoiceValOptionError[#1]{#2}}%
        \fi%
}
%------------------------------------------------------------------------------------------------------------------------------%
\newcommand\ProcessChoiceValOptions%
        {\@for\next:=\@defined@ChoiceVal@Options\do{\ProcessChoiceValOption[\csname @\next @prefix\endcsname]{\next}}}
%------------------------------------------------------------------------------------------------------------------------------%
\newcommand\ProcessPackageOptions[1][]%
{%\ProcessPackageOptions[family]
        \xdef\pkgopts@family{\KVO@family}
        \xdef\pkgopts@prefix{\KVO@prefix}
        \global\let\pkgopts@setkeys=\KVO@setkeys
        %\gdef\pkgopts@prefix{mylatex@}
        \ifstrempty{#1}%
                {\ProcessKeyvalOptions*}%
                {\ProcessKeyvalOptions{#1}}%
        \ProcessChoiceValOptions%
        \ProcessChoiceOptions%
}
%------------------------------------------------------------------------------------------------------------------------------%
%------------------------------------------------------------------------------------------------------------------------------%
%------------------------------------------------------------------------------------------------------------------------------%
\newcommand\PrintChoiceInfo[2][]%
{%\ProcessChoiceOption[<prefix>]{<key>}
        \ifstrempty{#1}%
                {\def\@choicekey@prefix{\@nameuse{@#2@prefix}}}%
                {\def\@choicekey@prefix{#1}}%
        \item \@choicekey@prefix#2 (family@key)\\
        \indent\indent \underline{Acceptable Choices} = %
        \fullyexpand{\@nameuse{@\@choicekey@prefix valid@#2@choice@options}}\\%
        \@nameuse{if\@choicekey@prefix#2}%
                \indent\indent \underline{Provided} = true\\%
                \indent\indent \underline{Selected Choice} = \@nameuse{\@choicekey@prefix#2}
        \else%
                \indent\indent \underline{Provided} = false%
        \fi%
}
%------------------------------------------------------------------------------------------------------------------------------%
\newcommand\PrintChoicesInfo%
{%
        \noindent \underline{Defined Choice Keys} : \@defined@Choice@Options%
        \begin{enumerate}%
        \@for\next:=\@defined@Choice@Options%
                \do{\PrintChoiceInfo[\@nameuse{@\next @prefix}]{\next}}%
        \end{enumerate}
}
%------------------------------------------------------------------------------------------------------------------------------%
\newcommand\PrintBoolOptionPairInfo[2][]%
{%\ProcessChoiceOption[<prefix>]{<key>}
        %\ifstrempty{#1}
%                {\def\@boolpairkey@prefix{\@nameuse{@#2@prefix}}}
%                {\def\@boolpairkey@prefix{#1}}
        \indent \underline{Bool Option Pair key (family@key)} : mylatex@#2\\
        \value{\@nameuse{ifmylatex@#2}}%
        \value{\@nameuse{ifmylatex@#2off}}%
        \value{\@nameuse{ifmylatex@no#2}}%
         %       \indent\indent \underline{Provided} = true\\%
         %       \indent\indent \underline{Acceptable Choices} = %
          %      \indent\indent \underline{Selected Choice} = \@nameuse{\KVO@prefix#2}\\
        %\else%
        %        \indent\indent \underline{Provided} = false\\%
        %\fi%
}
%\DeclareComplementaryOption{#2off}{#2}
%        \DeclareComplementaryOption{no#2}{#2}
%------------------------------------------------------------------------------------------------------------------------------%
\newcommand\PrintBoolOptionPairsInfo%
{%
        \noindent \underline{Defined Bool Pair Keys} : \@defined@Bool@Option@Pairs\\%
        \@for\next:=\@defined@Bool@Option@Pairs%
                \do{\PrintBoolOptionPairInfo{\next}}%
}

%------------------------------------------------------------------------------------------------------------------------------%
\newcommand\PrintPackageList{\noindent \underline{Loaded Packages} : \@loaded@packages}
%******************************************************************************************************************************%
%******************************************************** Package Body ********************************************************%
%******************************************************************************************************************************%
\newcommand\SetDocumentClass[1][\pkgopts@prefix]%
{%\SetDocumentClass[<prefix>]
        \ifstrempty{\@nameuse{#1documentclass}}
                {\def\thedocumentclass{report}}%
                {\def\thedocumentclass{\@nameuse{#1documentclass}}}%
        \ifmylatex@article
                \def\thedocumentclass{article}
        \fi
        \ifmylatex@report
                \def\thedocumentclass{report}
        \fi
        %\PassOptionsToClass{landscape}{article}
        %\PassOptionsToClass{landscape}{report}
        \ifmylatex@standalone
                \documentclass[\the@doc@sizeX,class=\thedocumentclass, crop=false]{standalone}
        \else
                \documentclass{\the@doc@sizeX,\thedocumentclass}%
        \fi
}
\newcommand{\ValidateChoiceCS}[4]%
{%
        \validatedfalse%
        \xdef\@valid@choices{\csuse{#2}}%
        \xdef\@test@choice{#1}%
        \foreach \@current@choice [count=\@count] in \@valid@choices%
        {%
                %\ifcsstrequal{\@current@choice}{#1}%
                \ifdefequal{\@current@choice}{\@test@choice}%
                {%
                        \global\validatedtrue\breakforeach%
                        \xp@xdef{@validated@index}{\@count}%
                }{}%
        }%
        \ifvalidated#3\else#4\fi%
        %\ifvalidated Validated\else Not Validated\fi\\%
}
%------------------------------------------------------------------------------------------------------------------------------%
%\def\@known@font@series{l,m,b,bx}
\newcommand\ValidateChoiceDef[4]%
{%
        \validatedfalse%
        \xdef\@test@cs{#1}
        \foreach \@current@choice [count=\@count] in #2%
        {%
                %\ifcsstrequal{\@current@choice}{#1}%
                \ifdefequal{\@current@choice}{\@test@cs}%
                {%
                        \global\validatedtrue\breakforeach%
                        \xp@xdef{@validated@index}{\@count}%
                }{}%
        }%
        \ifvalidated#3\else#4\fi%
}
%------------------------------------------------------------------------------------------------------------------------------%
\newcommand{\ValidateChoicePair}[5]%
{%
        \validatedfalse%
        \xdef\@test@cs{#2}
        \foreach \@current@choice/\@current@choice@val [count=\@count] in #3%
        {%
                \ifnumcomp{#1}{=}{1}%
                {%
                        \ifdefequal{\@current@choice}{\@test@cs}%
                        {%
                                \global\validatedtrue\breakforeach%
                                \xp@xdef{@validated@index}{\@count}%
                                \xp@xdef{@validated@index@choice}{\@current@choice}%
                                \xp@xdef{@validated@index@value}{\@current@choice@val}%
                        }{}%
                }{}%
                \ifnumcomp{#1}{=}{2}%
                {%
                        \ifdefequal{\@current@choice@val}{\@test@cs}%
                        {%
                                \global\validatedtrue\breakforeach%
                                \xp@xdef{@validated@index}{\@count}%
                                \xp@xdef{@validated@index@choice}{\@current@choice}%
                                \xp@xdef{@validated@index@value}{\@current@choice@val}%
                        }{}%
                }{}%
        }
        \ifvalidated#4\else#5\fi%
}
%------------------------------------------------------------------------------------------------------------------------------%
\newcommand\SetDefaultFont%
{%
        \stripunits{\@doc@fontsize}[\@doc@fontsize@unitless]%\pgfmathresult\\
        \toint{\@doc@fontsize@unitless}[\@doc@fontsize@unitless@int]%\pgfmathresult\pgfmathresult\\
        \def\@doc@default@font
        {%
                \fontencoding{\@doc@fontencoding}%
                \fontfamily{\@doc@fontfamily}%
                \fontseries{\@doc@fontseries}%
                \fontshape{\@doc@fontshape}%
                \fontsize{\@doc@fontsize}{\baselineskip}%
                \selectfont%
                \renewcommand{\familydefault}{\@doc@fontfamily}
        }
        \fontcolor{current-coltext}%
        \renewcommand{\rm}{\@doc@default@font}%
        \gdef\f@halfsize{\pgfmathparse{0.5\@doc@fontsize}}
        %\setlength\f@halfheight{\f@halfsize pt}
        %\@doc@default@font%
}
\newcommand\SetDocFontSettings[1][\pkgopts@prefix]%
{%
        \xdef\@doc@fontencoding{\mylatex@fontencoding}
        \xdef\@doc@fontname{\mylatex@fontname}
        \ifdefempty{\mylatex@fontfamily}
                {\xdef\@doc@fontfamily{\mylatex@fontname@choiceval@value}}
                {\xdef\@doc@fontfamily{\mylatex@fontfamily}}
        \xdef\@doc@fontseries{\mylatex@fontseries}
        \xdef\@doc@fontshape{\mylatex@fontshape}
        %\xdef\@doc@fontsize{\mylatex@fontsize}
        \xdef\@doc@sizeX{\mylatex@sizeXdoc}
        \xdef\@fts{cmr\@doc@sizeX}%{qx-anttr}%{cmu10}
        \xdef\the@doc@sizeX{\@doc@sizeX pt}
        \ifmylatex@sizeXdoc
                \xdef\@doc@fontsize{\@doc@sizeX pt}
                %\xdef\f@halfsize{\pgfmathparse{0.5*\@doc@sizeX}}
        \else
                \xdef\@doc@fontsize{\mylatex@fontsize}
                %\xdef\f@halfsize{\pgfmathparse{0.5*\@doc@sizeX}}
        \fi
        \def\doctextsize{\dimexpr\f@size pt\relax}
}
%------------------------------------------------------------------------------------------------------------------------------%
%******************************************************************************************************************************%
%*********************************************** End of 'pkgopts.sty' package *************************************************%
%******************************************************************************************************************************%
%------------------------------------------------------------------------------------------------------------------------------%
\endinput 